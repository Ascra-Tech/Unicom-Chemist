[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item",
  "enabled": 1,
  "modified": "2026-01-14 12:50:20.017760",
  "module": "Unicom Chemist",
  "name": "Group filter in Item group",
  "script": "frappe.ui.form.on('Item', {\r\n    refresh(frm) {\r\n        if (frm.is_new()) {\r\n            setTimeout(() => {\r\n                if (frm.doc.item_group === \"All Item Groups\") {\r\n                    frm.set_value(\"item_group\", \"\");\r\n                }\r\n            }, 300);\r\n        }\r\n\r\n        // Tree filter (keep this here)\r\n        if (frm.fields_dict.item_group) {\r\n            frm.fields_dict.item_group.get_query = function () {\r\n                return {\r\n                    filters: {\r\n                        is_group: 0\r\n                    }\r\n                };\r\n            };\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 0,
  "modified": "2025-12-24 19:07:25.710361",
  "module": "Unicom Chemist",
  "name": "Sales Invoice Naming Series",
  "script": "// Written by Parmeshwar\n\nfrappe.ui.form.on('Sales Invoice', {\n    onload: function(frm) {\n        apply_series(frm);\n    },\n    custom_branch: function(frm) {\n        apply_series(frm);\n    }\n});\n\nfunction apply_series(frm) {\n    if (!frm.doc.custom_branch) return;\n\n    // Mapping: Branch â†’ Naming Series\n    let series_map = {\n        \"Centralized Branch\": [\"CB-ACC-SINV-.YYYY.-\"],\n        \"Republic Retail\": [\"RR-ACC-SINV-.YYYY.-\"],\n        \"Dansoman Roundabout Retail\": [\"DRR-ACC-SINV-.YYYY.-\"],\n        \"Dansoman Market Retail\": [\"DMR-ACC-SINV-.YYYY.-\"],\n        \"Dansoman Market Wholesale\": [\"DMW-ACC-SINV-.YYYY.-\"],\n        \"Osu Wholesale\": [\"OW-ACC-SINV-.YYYY.-\"],\n        \"Mallam Wholesale\": [\"MW-ACC-SINV-.YYYY.-\"],\n        \"Akukor Foto Wholesale\": [\"AFW-ACC-SINV-.YYYY.-\"],\n        \"Kasoa Amanfrom Wholesale\": [\"KAW-ACC-SINV-.YYYY.-\"],\n        \"Mallam Retail\": [\"MR-ACC-SINV-.YYYY.-\"],\n        \"Osu Retail\": [\"OR-ACC-SINV-.YYYY.-\"],\n        \"Tantra\": [\"T-ACC-SINV-.YYYY.-\"]\n    };\n\n    let series_list = series_map[frm.doc.custom_branch] || [];\n\n    // Update naming_series dropdown\n    frm.set_df_property(\"naming_series\", \"options\", series_list.join(\"\\n\"));\n\n    // Auto-select\n    if (series_list.length) {\n        frm.set_value(\"naming_series\", series_list[0]);\n    }\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Invoice",
  "enabled": 0,
  "modified": "2025-12-24 19:07:25.871555",
  "module": "Unicom Chemist",
  "name": "Serial No fetch PR to PI",
  "script": "    frappe.ui.form.on(\"Purchase Invoice Item\", \"item_code\", function(frm, cdt, cdn) {\n        var row = locals[cdt][cdn];\n        if (row.item_code) {\n            frappe.db.get_value(\"Purchase Receipt Item\", {\n                \"parent_type\": \"Purchase Receipt\",\n                \"item_code\": row.item_code,\n                \"parent\": frm.doc.purchase_receipt // Assuming Purchase Receipt is linked to Purchase Invoice\n            }, \"serial_no\", function(value) {\n                if (value && value.serial_no) {\n                    frappe.model.set_value(cdt, cdn, \"serial_no_from_pr\", value.serial_no);\n                } else {\n                    frappe.model.set_value(cdt, cdn, \"serial_no_from_pr\", \"\"); // Clear if no match\n                }\n            });\n        }\n    });",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item",
  "enabled": 0,
  "modified": "2025-12-29 18:49:27.770958",
  "module": "Unicom Chemist",
  "name": "Item naming series",
  "script": "frappe.ui.form.on('Item', {\n    item_group: function(frm) {\n        // Only set naming_series for NEW documents\n        if (!frm.doc.__islocal) return;\n        if (!frm.doc.item_group) return;\n\n        frappe.db.get_value('Item Group', frm.doc.item_group, 'name')\n            .then(r => {\n                if (r.message && r.message.name) {\n                    frm.set_value(\n                        'naming_series',\n                        `${r.message.name}-.#####`\n                    );\n                } else {\n                    frappe.msgprint(__('Branch Code not found'));\n                }\n            });\n    },\n\n    onload: function(frm) {\n        // Only trigger for new documents that haven't been saved yet\n        if (frm.doc.__islocal && frm.doc.item_group && !frm.doc.naming_series) {\n            frm.trigger('item_group');\n        }\n    },\n    \n    refresh: function(frm) {\n        // Also check on refresh for new documents\n        if (frm.doc.__islocal && frm.doc.item_group && !frm.doc.naming_series) {\n            frm.trigger('item_group');\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Serial and Batch Bundle",
  "enabled": 1,
  "modified": "2026-01-09 16:31:41.806946",
  "module": "Unicom Chemist",
  "name": "Fetch Batch Expiry",
  "script": "// Client Script for: Serial and Batch Bundle\n// Syncs batch expiry date from child table to parent field with auto-save\n\nfrappe.ui.form.on(\"Serial and Batch Bundle\", {\n    refresh(frm) {\n        update_bundle_batch_expiry_date(frm);\n    },\n    \n    // Auto-save when expiry date changes manually\n    custom_batch_expiry_date(frm) {\n        // Only auto-save if document exists and field has a value\n        if (frm.doc.name && frm.doc.custom_batch_expiry_date !== undefined) {\n            // Use debounce to prevent rapid successive saves\n            clearTimeout(frm._expiry_save_timeout);\n            frm._expiry_save_timeout = setTimeout(() => {\n                if (!frm.is_dirty()) return; // Skip if already saved\n                frm.save().then(() => {\n                    frappe.show_alert({\n                        message: __('Batch Expiry Updated'),\n                        indicator: 'green'\n                    }, 3);\n                });\n            }, 300);\n        }\n    }\n});\n\nfrappe.ui.form.on(\"Serial and Batch Entry\", {\n    batch_no(frm, cdt, cdn) {\n        // Wait for fetch_from to complete\n        setTimeout(() => update_bundle_batch_expiry_date(frm), 600);\n    },\n    \n    custom_batch_expiry(frm, cdt, cdn) {\n        update_bundle_batch_expiry_date(frm);\n    },\n    \n    // Handle row removal\n    entries_remove(frm, cdt, cdn) {\n        update_bundle_batch_expiry_date(frm);\n    }\n});\n\nfunction update_bundle_batch_expiry_date(frm) {\n    const entries = frm.doc.entries || [];\n    \n    // Clear expiry if no entries\n    if (!entries.length) {\n        if (frm.doc.custom_batch_expiry_date) {\n            frm.set_value(\"custom_batch_expiry_date\", null);\n        }\n        return;\n    }\n    \n    // Get expiry from first entry with a value\n    let expiry_date = null;\n    for (let entry of entries) {\n        if (entry.custom_batch_expiry) {\n            expiry_date = entry.custom_batch_expiry;\n            break;\n        }\n    }\n    \n    // Only update if value changed\n    const current_value = frm.doc.custom_batch_expiry_date;\n    if (current_value !== expiry_date) {\n        frm.set_value(\"custom_batch_expiry_date\", expiry_date);\n        \n        // Auto-save with debounce\n        clearTimeout(frm._bundle_save_timeout);\n        frm._bundle_save_timeout = setTimeout(() => {\n            // Check if document is saveable\n            if (!frm.doc.name || frm.doc.__islocal || !frm.is_dirty()) {\n                return;\n            }\n            \n            frm.save().then(() => {\n                frappe.show_alert({\n                    message: __('Batch Expiry Synced'),\n                    indicator: 'blue'\n                }, 3);\n            }).catch((err) => {\n                // Silent fail - user can save manually if needed\n                console.warn('Auto-save failed:', err);\n            });\n        }, 1200);\n    }\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Material Request",
  "enabled": 1,
  "modified": "2026-01-03 10:21:52.967241",
  "module": "Unicom Chemist",
  "name": "Material Request filter script",
  "script": "frappe.ui.form.on('Material Request', {\n    onload: function(frm) {\n        // Set warehouse filter and default on form load\n        set_warehouse_permissions(frm);\n    },\n    \n    refresh: function(frm) {\n        // Set warehouse filter and default on form refresh\n        set_warehouse_permissions(frm);\n    }\n});\n\nfunction set_warehouse_permissions(frm) {\n    // Get user permissions for warehouses\n    frappe.call({\n        method: 'frappe.client.get_list',\n        args: {\n            doctype: 'User Permission',\n            filters: {\n                user: frappe.session.user,\n                allow: 'Warehouse'\n            },\n            fields: ['for_value', 'is_default']\n        },\n        callback: function(r) {\n            if (r.message && r.message.length > 0) {\n                let permitted_warehouses = [];\n                let default_warehouse = null;\n                \n                // Extract warehouse names and find default\n                r.message.forEach(function(permission) {\n                    permitted_warehouses.push(permission.for_value);\n                    \n                    // Check if this is the default warehouse\n                    if (permission.is_default === 1) {\n                        default_warehouse = permission.for_value;\n                    }\n                });\n                \n                // Set filter for Set Target Warehouse field\n                frm.set_query('set_warehouse', function() {\n                    return {\n                        filters: {\n                            name: ['in', permitted_warehouses]\n                        }\n                    };\n                });\n                \n                // Set filter for Set Source Warehouse field (for Material Transfer)\n                frm.set_query('set_from_warehouse', function() {\n                    return {\n                        filters: {\n                            name: ['in', permitted_warehouses]\n                        }\n                    };\n                });\n                \n                // Auto-set default warehouse if found and field is empty\n                if (default_warehouse && !frm.doc.set_warehouse) {\n                    frm.set_value('set_warehouse', default_warehouse);\n                }\n                \n                // Also apply filter to warehouse field in items table\n                frm.set_query('warehouse', 'items', function() {\n                    return {\n                        filters: {\n                            name: ['in', permitted_warehouses]\n                        }\n                    };\n                });\n                \n                // Also apply filter to source warehouse field in items table (for Material Transfer)\n                frm.set_query('s_warehouse', 'items', function() {\n                    return {\n                        filters: {\n                            name: ['in', permitted_warehouses]\n                        }\n                    };\n                });\n                \n                console.log('Warehouse permissions applied:', permitted_warehouses);\n                if (default_warehouse) {\n                    console.log('Default warehouse set:', default_warehouse);\n                }\n            } else {\n                console.log('No warehouse permissions found for user:', frappe.session.user);\n                // If no permissions found, user can see all warehouses (fallback)\n            }\n        }\n    });\n}\n\n// Additional script to handle when items are added to ensure warehouse filtering\nfrappe.ui.form.on('Material Request Item', {\n    items_add: function(frm, cdt, cdn) {\n        // Apply warehouse filter when new item row is added\n        set_warehouse_permissions(frm);\n    }\n});\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Receipt",
  "enabled": 1,
  "modified": "2026-01-03 10:21:52.903785",
  "module": "Unicom Chemist",
  "name": "Purchase Reciept batch script",
  "script": "frappe.ui.form.on('Purchase Receipt', {\n    after_submit: function(frm) {\n        // Wait a moment for batch creation, then show batch info\n        setTimeout(function() {\n            show_auto_created_batches(frm);\n        }, 1500);\n    }\n});\n\nfunction show_auto_created_batches(frm) {\n    console.log('Checking for auto-created batches for:', frm.doc.name);\n    \n    frappe.call({\n        method: 'frappe.client.get_list',\n        args: {\n            doctype: 'Batch',\n            filters: {\n                'reference_doctype': 'Purchase Receipt',\n                'reference_name': frm.doc.name\n            },\n            fields: ['name', 'batch_id', 'item', 'manufacturing_date', 'expiry_date'],\n            order_by: 'creation asc'\n        },\n        callback: function(response) {\n            if (response.message && response.message.length > 0) {\n                let batches = response.message;\n                console.log('Found batches:', batches);\n                \n                // Create mapping of item to batch for Purchase Receipt items\n                let item_batch_map = {};\n                batches.forEach(function(batch) {\n                    item_batch_map[batch.item] = batch.batch_id;\n                });\n                \n                // Create display table\n                let html = '<div style=\"margin: 15px;\">';\n                html += '<h4 style=\"color: #1976d2; margin-bottom: 15px;\">âœ… Auto-Created Batch Numbers</h4>';\n                html += '<table class=\"table table-bordered\" style=\"margin-bottom: 20px;\">';\n                html += '<thead style=\"background-color: #f8f9fa;\"><tr>';\n                html += '<th style=\"padding: 8px;\">Item Code</th>';\n                html += '<th style=\"padding: 8px;\">Batch ID</th>';\n                html += '<th style=\"padding: 8px;\">Manufacturing Date</th>';\n                html += '<th style=\"padding: 8px;\">Expiry Date</th>';\n                html += '</tr></thead><tbody>';\n                \n                batches.forEach(function(batch) {\n                    html += `<tr>\n                        <td style=\"padding: 8px;\"><strong>${batch.item}</strong></td>\n                        <td style=\"padding: 8px; background-color: #e8f5e8;\"><code>${batch.batch_id}</code></td>\n                        <td style=\"padding: 8px;\">${batch.manufacturing_date || 'Not set'}</td>\n                        <td style=\"padding: 8px;\">${batch.expiry_date || 'Not set'}</td>\n                    </tr>`;\n                });\n                \n                html += '</tbody></table>';\n                \n                // Add summary for Purchase Receipt items\n                html += '<h5 style=\"margin-top: 20px;\">ðŸ“‹ Item â†’ Batch Mapping:</h5>';\n                html += '<div style=\"background-color: #f8f9fa; padding: 10px; border-radius: 5px;\">';\n                \n                frm.doc.items.forEach(function(item) {\n                    let batch_id = item_batch_map[item.item_code] || 'Not found';\n                    let color = batch_id !== 'Not found' ? '#28a745' : '#dc3545';\n                    html += `<div style=\"margin: 5px 0;\">\n                        <strong>${item.item_code}</strong> â†’ \n                        <span style=\"color: ${color}; font-family: monospace;\">${batch_id}</span>\n                    </div>`;\n                });\n                \n                html += '</div>';\n                html += '<div style=\"margin-top: 15px; font-size: 12px; color: #6c757d;\">';\n                html += '<em>ðŸ’¡ Tip: You can copy these batch IDs for your records</em>';\n                html += '</div></div>';\n                \n                // Show in a dialog\n                let dialog = new frappe.ui.Dialog({\n                    title: 'Batch Information Created',\n                    fields: [\n                        {\n                            fieldname: 'batch_info',\n                            fieldtype: 'HTML',\n                            options: html\n                        }\n                    ],\n                    primary_action_label: 'Copy Batch Info',\n                    primary_action: function() {\n                        // Create text for copying\n                        let copy_text = `Batch Information for ${frm.doc.name}:\\n\\n`;\n                        batches.forEach(function(batch) {\n                            copy_text += `${batch.item}: ${batch.batch_id}\\n`;\n                        });\n                        \n                        // Copy to clipboard\n                        navigator.clipboard.writeText(copy_text).then(function() {\n                            frappe.show_alert({\n                                message: 'Batch information copied to clipboard!',\n                                indicator: 'green'\n                            });\n                        });\n                    }\n                });\n                \n                dialog.show();\n                \n                // Also show a quick alert\n                frappe.show_alert({\n                    message: `âœ… ${batches.length} batch(es) created successfully`,\n                    indicator: 'green'\n                });\n                \n            } else {\n                console.log('No batches found yet, may still be creating...');\n                frappe.show_alert({\n                    message: 'Batch creation in progress... Check manually if needed',\n                    indicator: 'orange'\n                });\n            }\n        },\n        error: function(err) {\n            console.error('Error fetching batch info:', err);\n            frappe.show_alert({\n                message: 'Error retrieving batch information',\n                indicator: 'red'\n            });\n        }\n    });\n}\n\n// Add manual button to check batch info anytime\nfrappe.ui.form.on('Purchase Receipt', {\n    refresh: function(frm) {\n        if (frm.doc.docstatus === 1) {\n            frm.add_custom_button(__('View Batch Info'), function() {\n                show_auto_created_batches(frm);\n            }, __('Actions'));\n        }\n    }\n});\n\n// Quick batch info in the form itself (optional)\nfrappe.ui.form.on('Purchase Receipt', {\n    refresh: function(frm) {\n        if (frm.doc.docstatus === 1) {\n            // Add a small info section to the form\n            setTimeout(function() {\n                add_batch_info_to_form(frm);\n            }, 2000);\n        }\n    }\n});\n\nfunction add_batch_info_to_form(frm) {\n    frappe.call({\n        method: 'frappe.client.get_list',\n        args: {\n            doctype: 'Batch',\n            filters: {\n                'reference_doctype': 'Purchase Receipt',\n                'reference_name': frm.doc.name\n            },\n            fields: ['batch_id', 'item'],\n            limit: 10\n        },\n        callback: function(response) {\n            if (response.message && response.message.length > 0) {\n                let batches = response.message;\n                \n                // Create a small summary\n                let batch_summary = batches.map(b => `${b.item}: ${b.batch_id}`).join(' | ');\n                \n                // Add to the form (if not already added)\n                if (!frm.fields_dict.batch_info_html) {\n                    frm.add_custom_button(__('ðŸ“¦ Batches: ') + batches.length, function() {\n                        show_auto_created_batches(frm);\n                    }, __('Info'));\n                }\n            }\n        }\n    });\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Account",
  "enabled": 1,
  "modified": "2026-01-03 10:21:52.928667",
  "module": "Unicom Chemist",
  "name": "Read only set for account code",
  "script": "// Written by Parmeshwar\n\nfrappe.ui.form.on('Account', {\n    refresh(frm) {\n        // if value exists = lock the field\n        if (frm.doc.custom_account_code) {\n            frm.set_df_property('custom_account_code', 'read_only', 1);\n        } else {\n            // allow user to enter for first time\n            frm.set_df_property('custom_account_code', 'read_only', 0);\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item",
  "enabled": 1,
  "modified": "2026-01-03 10:21:52.950578",
  "module": "Unicom Chemist",
  "name": "Barcode auto set in item master",
  "script": "// frappe.ui.form.on(\"Item\", {\n//     after_save(frm) {\n//         if (!frm.doc.barcodes || frm.doc.barcodes.length === 0) {\n\n//             // Generate 7-digit base\n//             let base = String(Math.floor(1000000 + Math.random() * 9000000));\n\n//             // Calculate checksum\n//             const calc_checksum = (code) => {\n//                 let sum = 0;\n//                 for (let i = 0; i < 7; i++) {\n//                     let digit = parseInt(code[i]);\n//                     sum += (i % 2 === 0) ? digit * 3 : digit;\n//                 }\n//                 return (10 - (sum % 10)) % 10;\n//             };\n\n//             let checksum = calc_checksum(base);\n//             let barcode = base + checksum;\n\n//             // Add child row AFTER save\n//             frappe.call({\n//                 method: \"frappe.client.set_value\",\n//                 args: {\n//                     doctype: \"Item\",\n//                     name: frm.doc.name,\n//                     fieldname: \"barcodes\",\n//                     value: [{\n//                         \"barcode\": barcode,\n//                         \"barcode_type\": \"EAN-8\"\n//                     }]\n//                 },\n//                 callback() {\n//                     frm.reload_doc();\n//                 }\n//             });\n//         }\n//     }\n// });\n\n\n\n\nfrappe.ui.form.on(\"Item\", {\n    refresh(frm) {\n        frm.set_query(\"custom_parent_item_group\", () => {\n            return {\n                filters: {\n                    \"is_group\": 1\n                }\n            };\n        });\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2026-01-03 10:21:53.016407",
  "module": "Unicom Chemist",
  "name": "Shelf filter Stock entry",
  "script": "frappe.ui.form.on('Stock Entry', {\r\n    onload(frm) {\r\n        apply_shelf_filters(frm);\r\n    },\r\n    refresh(frm) {\r\n        apply_shelf_filters(frm);\r\n    }\r\n});\r\n\r\nfunction apply_shelf_filters(frm) {\r\n\r\n    // SOURCE SHELF â†’ Source Warehouse\r\n    frm.fields_dict.items.grid.get_field('shelf').get_query =\r\n        function (doc, cdt, cdn) {\r\n            let row = locals[cdt][cdn];\r\n\r\n            return {\r\n                filters: {\r\n                    warehouse: row.s_warehouse || doc.from_warehouse\r\n                }\r\n            };\r\n        };\r\n\r\n    // TARGET SHELF â†’ Target Warehouse\r\n    frm.fields_dict.items.grid.get_field('to_shelf').get_query =\r\n        function (doc, cdt, cdn) {\r\n            let row = locals[cdt][cdn];\r\n\r\n            return {\r\n                filters: {\r\n                    warehouse: row.t_warehouse || doc.to_warehouse\r\n                }\r\n            };\r\n        };\r\n}\r\nfrappe.ui.form.on('Stock Entry Detail', {\r\n\r\n    // Source warehouse changed â†’ clear source shelf\r\n    s_warehouse(frm, cdt, cdn) {\r\n        frappe.model.set_value(cdt, cdn, 'shelf', null);\r\n    },\r\n\r\n    // Target warehouse changed â†’ clear target shelf\r\n    t_warehouse(frm, cdt, cdn) {\r\n        frappe.model.set_value(cdt, cdn, 'to_shelf', null);\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Receipt",
  "enabled": 1,
  "modified": "2026-01-03 10:21:52.999633",
  "module": "Unicom Chemist",
  "name": "Shelf filter Purchase receipt",
  "script": "frappe.ui.form.on('Purchase Receipt', {\r\n    onload(frm) {\r\n        apply_pr_shelf_filters(frm);\r\n    },\r\n    refresh(frm) {\r\n        apply_pr_shelf_filters(frm);\r\n    }\r\n});\r\n\r\nfunction apply_pr_shelf_filters(frm) {\r\n\r\n    // TARGET / ACCEPTED SHELF\r\n    frm.fields_dict.items.grid.get_field('shelf').get_query =\r\n        function (doc, cdt, cdn) {\r\n            let row = locals[cdt][cdn];\r\n            return {\r\n                filters: {\r\n                    warehouse: row.warehouse\r\n                }\r\n            };\r\n        };\r\n\r\n    // REJECTED SHELF\r\n    frm.fields_dict.items.grid.get_field('rejected_shelf').get_query =\r\n        function (doc, cdt, cdn) {\r\n            let row = locals[cdt][cdn];\r\n            return {\r\n                filters: {\r\n                    warehouse: row.rejected_warehouse\r\n                }\r\n            };\r\n        };\r\n}\r\n\r\nfrappe.ui.form.on('Purchase Receipt Item', {\r\n    warehouse(frm, cdt, cdn) {\r\n        frappe.model.set_value(cdt, cdn, 'shelf', null);\r\n    },\r\n    rejected_warehouse(frm, cdt, cdn) {\r\n        frappe.model.set_value(cdt, cdn, 'rejected_shelf', null);\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Purchase Invoice",
  "enabled": 1,
  "modified": "2026-01-03 10:21:52.983631",
  "module": "Unicom Chemist",
  "name": "Shelf filter Purchase Invoice",
  "script": "frappe.ui.form.on('Purchase Invoice', {\r\n    onload(frm) {\r\n        apply_pi_shelf_filters(frm);\r\n    },\r\n    refresh(frm) {\r\n        apply_pi_shelf_filters(frm);\r\n    }\r\n});\r\n\r\nfunction apply_pi_shelf_filters(frm) {\r\n\r\n    // TARGET / ACCEPTED SHELF\r\n    frm.fields_dict.items.grid.get_field('shelf').get_query =\r\n        function (doc, cdt, cdn) {\r\n            let row = locals[cdt][cdn];\r\n            return {\r\n                filters: {\r\n                    warehouse: row.warehouse\r\n                }\r\n            };\r\n        };\r\n\r\n    // REJECTED SHELF\r\n    frm.fields_dict.items.grid.get_field('rejected_shelf').get_query =\r\n        function (doc, cdt, cdn) {\r\n            let row = locals[cdt][cdn];\r\n            return {\r\n                filters: {\r\n                    warehouse: row.rejected_warehouse\r\n                }\r\n            };\r\n        };\r\n}\r\nfrappe.ui.form.on('Purchase Invoice Item', {\r\n    warehouse(frm, cdt, cdn) {\r\n        frappe.model.set_value(cdt, cdn, 'shelf', null);\r\n    },\r\n    rejected_warehouse(frm, cdt, cdn) {\r\n        frappe.model.set_value(cdt, cdn, 'rejected_shelf', null);\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Reconciliation",
  "enabled": 1,
  "modified": "2026-01-03 10:21:53.033973",
  "module": "Unicom Chemist",
  "name": "Shelf filter for Stock Reco",
  "script": "frappe.ui.form.on('Stock Reconciliation', {\r\n    onload(frm) {\r\n        apply_sr_shelf_filter(frm);\r\n    },\r\n    refresh(frm) {\r\n        apply_sr_shelf_filter(frm);\r\n    }\r\n});\r\n\r\nfunction apply_sr_shelf_filter(frm) {\r\n    frm.fields_dict.items.grid.get_field('shelf').get_query =\r\n        function (doc, cdt, cdn) {\r\n\r\n            let row = locals[cdt][cdn];\r\n\r\n            return {\r\n                filters: {\r\n                    warehouse: row.warehouse || doc.warehouse\r\n                }\r\n            };\r\n        };\r\n}\r\nfrappe.ui.form.on('Stock Reconciliation Item', {\r\n    warehouse(frm, cdt, cdn) {\r\n        frappe.model.set_value(cdt, cdn, 'shelf', null);\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 0,
  "modified": "2026-01-09 15:18:15.977965",
  "module": "Unicom Chemist",
  "name": "Naming Invoice Script",
  "script": "frappe.ui.form.on('Sales Invoice', {\r\n    branch: function(frm) {\r\n        if (!frm.doc.branch) return;\r\n\r\n        frappe.db.get_value('Branch', frm.doc.branch, 'custom_abbr')\r\n            .then(r => {\r\n                if (r.message && r.message.custom_abbr) {\r\n                    frm.set_value(\r\n                        'naming_series',\r\n                        `SINV-${r.message.custom_abbr}-.YYYY.-.#####`\r\n                    );\r\n                } else {\r\n                    frappe.msgprint(__('Branch Code not found'));\r\n                }\r\n            });\r\n    },\r\n\r\n    onload: function(frm) {\r\n        if (frm.doc.branch && !frm.doc.naming_series) {\r\n            frm.trigger('branch');\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "User",
  "enabled": 1,
  "modified": "2026-01-20 12:17:40.703238",
  "module": null,
  "name": "UI for user",
  "script": "frappe.ui.form.on('User', {\r\n    after_render: function() {\r\n        apply_custom_theme();\r\n    },\r\n    refresh: function() {\r\n        apply_custom_theme();\r\n    }\r\n});\r\n\r\nfunction apply_custom_theme() {\r\n    if (!document.getElementById('custom-desk-style')) {\r\n        const style = document.createElement('style');\r\n        style.id = 'custom-desk-style';\r\n        style.innerHTML = `\r\n            /* 1. AWESOME BAR (Search Bar) - Light Sky Blue */\r\n            .search-bar {\r\n                background-color: #f0f8ff !important; \r\n                border: 1px solid #cce0f5 !important;\r\n                border-radius: 10px !important;\r\n                box-shadow: 0 2px 8px rgba(135, 206, 235, 0.3) !important;\r\n                margin-top: 4px !important;\r\n                transition: all 0.2s ease;\r\n            }\r\n            .search-bar:hover {\r\n                box-shadow: 0 2px 12px rgba(135, 206, 235, 0.5) !important;\r\n            }\r\n\r\n            /* 2. DASHBOARD WIDGETS - White with Light Sky Blue Shadow */\r\n            .widget, .widget-group .widget, .number-widget-box, .stat-card {\r\n                background-color: #ffffff !important;\r\n                border: 1px solid #e2e8f0 !important;\r\n                border-radius: 12px !important;\r\n                box-shadow: 0 8px 20px rgba(135, 206, 235, 0.2) !important;\r\n                transition: all 0.3s ease !important;\r\n            }\r\n            .widget:hover, .number-widget-box:hover {\r\n                transform: translateY(-4px);\r\n                box-shadow: 0 12px 25px rgba(135, 206, 235, 0.4) !important;\r\n                border-color: #add8e6 !important;\r\n            }\r\n\r\n            /* 3. SIDEBAR SELECTION - Matching your Sky Blue Theme */\r\n            /* This targets the grey highlight in your image */\r\n            .sidebar-item-container.active, \r\n            .sidebar-item-container:hover {\r\n                background-color: rgba(135, 206, 235, 0.2) !important; /* Light Sky Blue Tint */\r\n                color: #2c3e50 !important;\r\n                border-radius: 8px !important;\r\n                margin: 0 8px !important;\r\n            }\r\n\r\n            .sidebar-item-container.active .sidebar-item-label,\r\n            .sidebar-item-container:hover .sidebar-item-label {\r\n                font-weight: 600 !important;\r\n                color: #007bff !important; /* Deeper blue text for the active item */\r\n            }\r\n\r\n            /* 4. NAVBAR & SIDEBAR BACKGROUND */\r\n            .navbar.navbar-light {\r\n                background-color: #ffffff !important;\r\n                border-bottom: 1px solid #d1d8dd !important;\r\n            }\r\n            .desk-sidebar {\r\n                background-color: #f8fafc !important;\r\n                border-right: 1px solid #e2e8f0 !important;\r\n            }\r\n        `;\r\n        document.head.appendChild(style);\r\n    }\r\n}\r\n\r\n// Ensure it runs on Page Load\r\n$(document).ready(function() {\r\n    apply_custom_theme();\r\n});\r\n\r\n// v15 Observer to keep the theme active during navigation\r\nconst themeObserver = new MutationObserver(() => {\r\n    apply_custom_theme();\r\n});\r\nthemeObserver.observe(document.documentElement, { childList: true, subtree: true });",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2026-01-28 12:23:27.724007",
  "module": null,
  "name": "Search Filter",
  "script": "frappe.ui.form.on('Stock Entry', {\r\n    refresh(frm) {\r\n\r\n        // Patch search only once\r\n        if (frappe.ui.form.MultiSelectDialog.__patched) return;\r\n        frappe.ui.form.MultiSelectDialog.__patched = true;\r\n\r\n        const original_get_results =\r\n            frappe.ui.form.MultiSelectDialog.prototype.get_results;\r\n\r\n        frappe.ui.form.MultiSelectDialog.prototype.get_results = function () {\r\n            let me = this;\r\n\r\n            // force \"contains\" search instead of \"starts with\"\r\n            me.args.txt = \"%\" + (me.args.txt || \"\") + \"%\";\r\n\r\n            return original_get_results.apply(this, arguments);\r\n        };\r\n    }\r\n});\r\n",
  "view": "Form"
 }
]