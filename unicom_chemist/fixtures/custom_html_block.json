[
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div class=\"ucl-container\">\r\n \r\n\r\n  <div class=\"ucl-grid\">\r\n\r\n    <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','Material Request Status Report')\">\r\n      <div>\r\n        <div class=\"ucl-icon\">üìÑ</div>\r\n        <div class=\"ucl-title\">Material Request Status Report</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','UCL Item-wise Purchase History')\">\r\n      <div>\r\n        <div class=\"ucl-icon\">üì¶</div>\r\n        <div class=\"ucl-title\">UCL Item-wise Purchase History</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','UCL Item-wise Sales History')\">\r\n      <div>\r\n        <div class=\"ucl-icon\">üõí</div>\r\n        <div class=\"ucl-title\">UCL Item-wise Sales History</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','UCL Purchase Order Analysis')\">\r\n      <div>\r\n        <div class=\"ucl-icon\">üìä</div>\r\n        <div class=\"ucl-title\">UCL Purchase Order Analysis</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','UCL Purchase Order Trends')\">\r\n      <div>\r\n        <div class=\"ucl-icon\">üìà</div>\r\n        <div class=\"ucl-title\">UCL Purchase Order Trends</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','UCL Sales Person Commission Summary')\">\r\n      <div>\r\n        <div class=\"ucl-icon\">üíº</div>\r\n        <div class=\"ucl-title\">UCL Sales Person Commission Summary</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','UCL Stock Balance')\">\r\n      <div>\r\n        <div class=\"ucl-icon\">üè¨</div>\r\n        <div class=\"ucl-title\">UCL Stock Balance</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','UCL Stock Ageing')\">\r\n      <div>\r\n        <div class=\"ucl-icon\">‚è≥</div>\r\n        <div class=\"ucl-title\">UCL Stock Ageing</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','UCL Stock Ledger')\">\r\n      <div>\r\n        <div class=\"ucl-icon\">üìò</div>\r\n        <div class=\"ucl-title\">UCL Stock Ledger</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','POS Invoice Report UCL')\">\r\n      <div>\r\n        <div class=\"ucl-icon\">üßæ</div>\r\n        <div class=\"ucl-title\">UCL POS Invoice Report</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','Sales Invoice Report UCL')\">\r\n      <div>\r\n        <div class=\"ucl-icon\">üßÆ</div>\r\n        <div class=\"ucl-title\">UCL Sales Invoice Report</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','UCL Central Only Stock Report')\">\r\n      <div>\r\n        <div class=\"ucl-icon\">üè¢</div>\r\n        <div class=\"ucl-title\">UCL Central Only Stock Report</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','Batch-Wise Balance History')\">\r\n      <div>\r\n        <div class=\"ucl-icon\">üß™</div>\r\n        <div class=\"ucl-title\">Batch-Wise Balance History</div>\r\n      </div>\r\n    </div>\r\n\r\n  </div>\r\n</div>\r\n",
  "modified": "2026-01-19 15:03:57.931668",
  "name": "UCL Reports",
  "private": 0,
  "roles": [],
  "script": "",
  "style": "\r\n.ucl-container {\r\n  padding: 10px;\r\n}\r\n\r\n.ucl-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\r\n  gap: 18px;\r\n}\r\n\r\n.ucl-card {\r\n  aspect-ratio: 1 / 1;\r\n  background:#FFFFFF;\r\n  border-radius: 14px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  text-align: center;\r\n  cursor: pointer;\r\n  transition: all 0.25s ease;\r\n  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.08);\r\n}\r\n\r\n.ucl-card:hover {\r\n  transform: translateY(-6px);\r\n  box-shadow: 0 12px 26px rgba(0, 0, 0, 0.14);\r\n  background: linear-gradient(90deg, #667eea, #764ba2);\r\n}\r\n\r\n.ucl-title {\r\n  font-size: 15px;\r\n  font-weight: 600;\r\n  color:linear-gradient(90deg, #667eea, #764ba2) ;\r\n}\r\n.ucl-title:hover {\r\n  \r\n  color:#FFFFFF ;\r\n}\r\n\r\n.ucl-icon {\r\n  font-size: 28px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.ucl-section-title {\r\n  margin: 20px 0 12px;\r\n  font-size: 18px;\r\n  font-weight: 700;\r\n  color: linear-gradient(90deg, #667eea, #764ba2);\r\n}\r\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<!-- Batch Item Expiry Status Dashboard - Full Detailed View -->\n<div class=\"batch-expiry-dashboard\">\n    <div class=\"dashboard-header\">\n        <div class=\"header-title-row\">\n            <h2 class=\"dashboard-title\">‚è∞ Batch Item Expiry Analysis</h2>\n            <div class=\"header-actions\">\n                <div class=\"filter-group\" style=\"display: inline-block; margin-right: 10px;\">\n                    <input type=\"text\" id=\"item-filter\" class=\"form-control\" placeholder=\"All Item...\" style=\"width: 200px;\" />\n                </div>\n                <div class=\"filter-group\" style=\"display: inline-block; margin-right: 10px;\">\n                    <input type=\"text\" id=\"warehouse-filter\" class=\"form-control\" placeholder=\"All Warehouse...\" style=\"width: 200px;\" />\n                </div>\n                <button class=\"btn btn-success\" id=\"refresh-all-batches\" title=\"Refresh batch data\">\n                    <i class=\"fa fa-refresh\"></i> Refresh\n                </button>\n            </div>\n        </div>\n        <div class=\"dashboard-subtitle\">Comprehensive expiry tracking for all batch items across warehouses with color-coded status indicators</div>\n    </div>\n    \n    <!-- Loading State for Dashboard -->\n    <div class=\"dashboard-loading\" id=\"dashboard-loading\" style=\"display: block;\">\n        <div class=\"loading-content\">\n            <div class=\"loading-spinner\"></div>\n            <div class=\"loading-title\">Loading Batch Expiry Analysis</div>\n            <div class=\"loading-message\" id=\"loading-message\">Initializing dashboard...</div>\n            <div class=\"loading-progress\">\n                <div class=\"progress-bar\">\n                    <div class=\"progress-fill\" id=\"progress-fill\"></div>\n                </div>\n                <div class=\"progress-text\" id=\"progress-text\">0%</div>\n            </div>\n        </div>\n    </div>\n\n    <!-- All Status Summary Cards -->\n    <div class=\"expiry-summary-section\" id=\"summary-cards\" style=\"display: none;\">\n        <div class=\"expiry-summary-card expired-card\">\n            <div class=\"summary-icon\">üî¥</div>\n            <div class=\"summary-content\">\n                <div class=\"summary-value\" id=\"expired-count\">-</div>\n                <div class=\"summary-label\">Expired</div>\n                <div class=\"summary-description\">Items that have passed expiry date</div>\n            </div>\n        </div>\n        \n        <div class=\"expiry-summary-card use-immediately-card\">\n            <div class=\"summary-icon\">üü†</div>\n            <div class=\"summary-content\">\n                <div class=\"summary-value\" id=\"use-immediately-count\">-</div>\n                <div class=\"summary-label\">Use Immediately</div>\n                <div class=\"summary-description\">Less than 6 months to expiry</div>\n            </div>\n        </div>\n        \n        <div class=\"expiry-summary-card near-expiry-card\">\n            <div class=\"summary-icon\">üü°</div>\n            <div class=\"summary-content\">\n                <div class=\"summary-value\" id=\"near-expiry-count\">-</div>\n                <div class=\"summary-label\">Near Expiry</div>\n                <div class=\"summary-description\">6 months to 1 year remaining</div>\n            </div>\n        </div>\n        \n        <div class=\"expiry-summary-card healthy-card\">\n            <div class=\"summary-icon\">üü¢</div>\n            <div class=\"summary-content\">\n                <div class=\"summary-value\" id=\"healthy-count\">-</div>\n                <div class=\"summary-label\">Healthy</div>\n                <div class=\"summary-description\">2+ years remaining</div>\n            </div>\n        </div>\n    </div>\n    \n    <!-- Batch Items Section -->\n    <div class=\"batch-items-section\" id=\"batch-items-section\" style=\"display: none;\">\n        <div class=\"section-header\">\n            <h3 class=\"section-title\">üìã All Batch Items Details</h3>\n            <div class=\"section-actions\">\n                <select id=\"expiry-status-filter\" class=\"form-control\" style=\"width: 180px; display: inline-block; margin-right: 10px;\">\n                    <option value=\"\">All Status</option>\n                    <option value=\"expired\">Expired</option>\n                    <option value=\"use-immediately\">Use Immediately</option>\n                    <option value=\"near-expiry\">Near Expiry</option>\n                    <option value=\"healthy\">Healthy</option>\n                </select>\n                <button class=\"btn btn-sm btn-default\" id=\"export-batch-items\" title=\"Export to Excel\">\n                    <i class=\"fa fa-download\"></i> Export\n                </button>\n            </div>\n        </div>\n        \n        <!-- Loading State -->\n        <div class=\"batch-items-loading\" id=\"batch-items-loading\" style=\"display: none;\">\n            <div class=\"loading-content\">\n                <div class=\"loading-spinner\"></div>\n                <div class=\"loading-text\">Loading batch items...</div>\n            </div>\n        </div>\n        \n        <!-- Empty State -->\n        <div class=\"batch-items-empty\" id=\"batch-items-empty\" style=\"display: none;\">\n            <div class=\"empty-state\">\n                <div class=\"empty-icon\">üì¶</div>\n                <div class=\"empty-title\">No Batch Items Found</div>\n                <div class=\"empty-text\">No batch items found with expiry dates in your inventory.</div>\n            </div>\n        </div>\n        \n        <!-- All Batch Items Table (Scrollable) -->\n        <div class=\"batch-items-table-container\" id=\"batch-items-table-container\" style=\"display: none;\">\n            <div class=\"table-wrapper\">\n                <table class=\"table table-striped batch-items-table\">\n                    <thead>\n                        <tr>\n                            <th>Item Code</th>\n                            <th>Item Name</th>\n                            <th>Status</th>\n                            <th>Stock UOM</th>\n                            <th>Batch No.</th>\n                            <th class=\"text-right\">Total Available Quantity</th>\n                            <th>Warehouse</th>\n                            <th>Expires On</th>\n                            <th class=\"text-right\">Expiry In Days</th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"batch-items-tbody\">\n                        <!-- All batch items will be populated here -->\n                    </tbody>\n                </table>\n            </div>\n        </div>\n    </div>\n    \n</div>",
  "modified": "2026-01-22 14:31:09.344796",
  "name": "Batch Expiry Dashboard",
  "private": 0,
  "roles": [],
  "script": "// Batch Item Expiry Dashboard - Full Detailed View\n// Complete implementation for comprehensive batch expiry tracking\n\n// Global variables\nlet batchExpiryData = {};\nlet allBatchItems = [];\nlet filteredBatchItems = [];\n\n// ERPNext provides root_element by default in custom HTML blocks\n// No need to declare it - it's automatically available\n\n// Configurable expiry thresholds (in days) - Client requirements\nlet expiryThresholds = {\n    expired: 0,           // Red = Expired (Less than 0 days)\n    useImmediately: 180,  // Orange = Use Immediately (Less than 6 months)\n    nearExpiry: 365,      // Yellow = Near Expiry (6 months to 1 year)  \n    healthy: 730          // Green = Healthy (2 years and above)\n};\n\n// Status color mapping\nconst statusColors = {\n    'Expired': '#dc3545',           // Red\n    'Use Immediately': '#fd7e14',   // Orange  \n    'Near Expiry': '#ffc107',       // Yellow\n    'Healthy': '#28a745'            // Green\n};\n\n// Initialize dashboard when DOM is loaded\n$(document).ready(function() {\n    console.log('Initializing Batch Expiry Dashboard...');\n    initializeBatchExpiryDashboard();\n});\n\n// Global variables for filters\nlet selectedWarehouse = '';\nlet selectedItem = '';\n\n// Loading state management\nlet loadingProgress = 0;\nconst loadingSteps = [\n    { message: \"Initializing dashboard...\", progress: 10 },\n    { message: \"Loading warehouses...\", progress: 20 },\n    { message: \"Fetching batch data...\", progress: 40 },\n    { message: \"Getting item details...\", progress: 60 },\n    { message: \"Processing batch quantities...\", progress: 80 },\n    { message: \"Calculating expiry status...\", progress: 90 },\n    { message: \"Finalizing display...\", progress: 100 }\n];\n\n// Loading state functions\nfunction showLoading() {\n    const loadingEl = root_element.querySelector('#dashboard-loading');\n    const summaryEl = root_element.querySelector('#summary-cards');\n    const batchItemsEl = root_element.querySelector('#batch-items-section');\n    \n    if (loadingEl) loadingEl.style.display = 'block';\n    if (summaryEl) summaryEl.style.display = 'none';\n    if (batchItemsEl) batchItemsEl.style.display = 'none';\n}\n\nfunction hideLoading() {\n    const loadingEl = root_element.querySelector('#dashboard-loading');\n    const summaryEl = root_element.querySelector('#summary-cards');\n    const batchItemsEl = root_element.querySelector('#batch-items-section');\n    \n    if (loadingEl) loadingEl.style.display = 'none';\n    if (summaryEl) {\n        summaryEl.style.display = 'block';\n        // Force grid layout for cards\n        fixCardLayout();\n    }\n    if (batchItemsEl) batchItemsEl.style.display = 'block';\n}\n\n// Fix card layout to ensure horizontal display\nfunction fixCardLayout() {\n    const summarySection = root_element.querySelector('.expiry-summary-section');\n    if (summarySection) {\n        // Force grid properties via JavaScript\n        summarySection.style.display = 'grid';\n        summarySection.style.gridTemplateColumns = 'repeat(4, 1fr)';\n        summarySection.style.gap = '20px';\n        summarySection.style.width = '100%';\n        summarySection.style.maxWidth = 'none';\n        \n        console.log('Card layout fixed - forcing horizontal grid display');\n        \n        // Check if grid is working, fallback to flexbox\n        setTimeout(() => {\n            const cards = summarySection.querySelectorAll('.expiry-summary-card');\n            if (cards.length > 0) {\n                const firstCard = cards[0];\n                const rect = firstCard.getBoundingClientRect();\n                \n                // If cards are too narrow (less than 150px), switch to flexbox\n                if (rect.width < 150) {\n                    console.log('Grid layout not working, switching to flexbox fallback');\n                    summarySection.style.display = 'flex';\n                    summarySection.style.flexWrap = 'wrap';\n                    summarySection.style.justifyContent = 'space-between';\n                    \n                    cards.forEach(card => {\n                        card.style.flex = '1 1 calc(25% - 15px)';\n                        card.style.minWidth = '200px';\n                    });\n                }\n            }\n        }, 100);\n    }\n}\n\nfunction updateLoadingProgress(stepIndex) {\n    if (stepIndex >= 0 && stepIndex < loadingSteps.length) {\n        const step = loadingSteps[stepIndex];\n        const messageEl = root_element.querySelector('#loading-message');\n        const progressFillEl = root_element.querySelector('#progress-fill');\n        const progressTextEl = root_element.querySelector('#progress-text');\n        \n        if (messageEl) messageEl.textContent = step.message;\n        if (progressFillEl) progressFillEl.style.width = step.progress + '%';\n        if (progressTextEl) progressTextEl.textContent = step.progress + '%';\n        \n        console.log(`Loading progress: ${step.progress}% - ${step.message}`);\n    }\n}\n\n// Main initialization function\nfunction initializeBatchExpiryDashboard() {\n    showLoading();\n    updateLoadingProgress(0);\n    \n    // Initialize components with proper timing and progress updates\n    setTimeout(() => {\n        updateLoadingProgress(1);\n        bindBatchExpiryEventHandlers();\n        \n        setTimeout(() => {\n            updateLoadingProgress(2);\n            loadItems();\n            loadWarehouses();\n            \n            setTimeout(() => {\n                loadAllBatchExpiryData();\n            }, 300);\n        }, 300);\n    }, 500);\n    \n    console.log('Batch Expiry Dashboard initialized successfully');\n}\n\n// Load items for filter dropdown (batch-enabled items only)\nfunction loadItems() {\n    const itemInput = root_element.querySelector('#item-filter');\n    \n    if (itemInput && !itemInput.awesomplete) {\n        // Setup awesomplete for item filter with inline autocomplete\n        itemInput.awesomplete = new Awesomplete(itemInput, {\n            minChars: 0,\n            maxItems: 50,\n            autoFirst: true\n        });\n        \n        // Load items on focus or input\n        let itemsCache = null;\n        \n        const loadItemOptions = function() {\n            if (itemsCache) {\n                itemInput.awesomplete.list = itemsCache;\n                return;\n            }\n            \n            frappe.call({\n                method: 'frappe.client.get_list',\n                args: {\n                    doctype: 'Item',\n                    fields: ['name', 'item_name'],\n                    filters: [\n                        ['has_batch_no', '=', 1],\n                        ['is_stock_item', '=', 1],\n                        ['disabled', '=', 0]\n                    ],\n                    order_by: 'item_name asc',\n                    limit_page_length: 500\n                },\n                callback: function(r) {\n                    if (r.message) {\n                        itemsCache = r.message.map(item => ({\n                            label: item.item_name || item.name,\n                            value: item.name\n                        }));\n                        itemInput.awesomplete.list = itemsCache;\n                    }\n                }\n            });\n        };\n        \n        // Prevent global search from triggering\n        $(itemInput).on('click focus', function(e) {\n            e.stopPropagation();\n            loadItemOptions();\n        });\n        \n        // Prevent keyboard shortcuts from triggering global search\n        $(itemInput).on('keydown', function(e) {\n            e.stopPropagation();\n        });\n        \n        // Handle selection\n        $(itemInput).on('awesomplete-selectcomplete', function(e) {\n            const originalEvent = e.originalEvent;\n            selectedItem = (originalEvent && originalEvent.text && originalEvent.text.value) || '';\n            console.log('Item filter changed to:', selectedItem);\n            loadAllBatchExpiryData();\n        });\n        \n        // Handle clear\n        $(itemInput).on('input', function(e) {\n            e.stopPropagation();\n            if (!this.value) {\n                selectedItem = '';\n                console.log('Item filter cleared');\n                loadAllBatchExpiryData();\n            }\n        });\n    }\n}\n\n// Load warehouses for filter dropdown (same as main dashboard)\nfunction loadWarehouses() {\n    const warehouseInput = root_element.querySelector('#warehouse-filter');\n    \n    if (warehouseInput && !warehouseInput.awesomplete) {\n        // Setup awesomplete for warehouse filter with inline autocomplete\n        warehouseInput.awesomplete = new Awesomplete(warehouseInput, {\n            minChars: 0,\n            maxItems: 50,\n            autoFirst: true\n        });\n        \n        // Load warehouses on focus or input\n        let warehousesCache = null;\n        \n        const loadWarehouseOptions = function() {\n            if (warehousesCache) {\n                warehouseInput.awesomplete.list = warehousesCache;\n                return;\n            }\n            \n            frappe.call({\n                method: 'frappe.client.get_list',\n                args: {\n                    doctype: 'Warehouse',\n                    fields: ['name', 'warehouse_name'],\n                    filters: [['is_group', '=', 0]],\n                    order_by: 'warehouse_name asc',\n                    limit_page_length: 500\n                },\n                callback: function(r) {\n                    if (r.message) {\n                        warehousesCache = r.message.map(wh => ({\n                            label: wh.warehouse_name || wh.name,\n                            value: wh.name\n                        }));\n                        warehouseInput.awesomplete.list = warehousesCache;\n                    }\n                }\n            });\n        };\n        \n        // Prevent global search from triggering\n        $(warehouseInput).on('click focus', function(e) {\n            e.stopPropagation();\n            loadWarehouseOptions();\n        });\n        \n        // Prevent keyboard shortcuts from triggering global search\n        $(warehouseInput).on('keydown', function(e) {\n            e.stopPropagation();\n        });\n        \n        // Handle selection\n        $(warehouseInput).on('awesomplete-selectcomplete', function(e) {\n            const originalEvent = e.originalEvent;\n            selectedWarehouse = (originalEvent && originalEvent.text && originalEvent.text.value) || '';\n            console.log('Warehouse filter changed to:', selectedWarehouse);\n            loadAllBatchExpiryData();\n        });\n        \n        // Handle clear\n        $(warehouseInput).on('input', function(e) {\n            e.stopPropagation();\n            if (!this.value) {\n                selectedWarehouse = '';\n                console.log('Warehouse filter cleared');\n                loadAllBatchExpiryData();\n            }\n        });\n    }\n}\n\n// Bind event handlers for batch expiry dashboard\nfunction bindBatchExpiryEventHandlers() {\n    // Refresh button\n    $('#refresh-all-batches').click(function() {\n        console.log('Refreshing all batch data...');\n        loadAllBatchExpiryData();\n    });\n    \n    // Note: Item and Warehouse filter change handlers are now in the \n    // frappe.ui.form.make_control onchange callbacks in loadItems() and loadWarehouses()\n    \n    // Status filter change - use root_element for proper scoping\n    const statusFilter = root_element.querySelector('#expiry-status-filter');\n    if (statusFilter) {\n        statusFilter.addEventListener('change', function() {\n            const filterValue = this.value;\n            console.log('Filtering batch items by status:', filterValue);\n            filterBatchItemsByStatus(filterValue);\n        });\n    }\n    \n    // Export batch items - use root_element for proper scoping\n    const exportButton = root_element.querySelector('#export-batch-items');\n    if (exportButton) {\n        exportButton.addEventListener('click', function() {\n            console.log('Exporting batch items...');\n            exportBatchItemsToExcel();\n        });\n    }\n    \n    // Action buttons\n    $('#mark-expired-disposal').click(function() {\n        console.log('Marking expired items for disposal...');\n        markExpiredItemsForDisposal();\n    });\n    \n    $('#generate-expiry-report').click(function() {\n        console.log('Generating expiry report...');\n        generateExpiryReport();\n    });\n    \n    $('#export-all-data').click(function() {\n        console.log('Exporting all batch data...');\n        exportAllBatchData();\n    });\n}\n\n// Load all batch expiry data using ERPNext's get_batch_qty function\nfunction loadAllBatchExpiryData() {\n    console.log('=== Loading comprehensive batch expiry data ===');\n    updateLoadingProgress(3);\n    \n    // Show loading state\n    $('#batch-items-loading').show();\n    $('#batch-items-table-container').hide();\n    $('#batch-items-empty').hide();\n    \n    // First, get all batches with expiry dates\n    console.log('Step 1: Fetching all batches with expiry dates...');\n    console.log('Active filters - Item:', selectedItem || 'All Items', 'Warehouse:', selectedWarehouse || 'All Warehouses');\n    \n    const batchFilters = {\n        'disabled': 0\n    };\n    \n    // Apply item filter if selected\n    if (selectedItem) {\n        batchFilters['item'] = selectedItem;\n        console.log('Applying item filter:', selectedItem);\n    }\n    \n    frappe.db.get_list('Batch', {\n        filters: batchFilters,\n        fields: ['name', 'item', 'expiry_date'],\n        limit: 0\n    }).then(allActiveBatches => {\n        console.log('All active batches:', allActiveBatches.length);\n        \n        // Filter batches that have expiry dates\n        const batchesWithExpiry = allActiveBatches.filter(batch => \n            batch.expiry_date && batch.expiry_date !== '' && batch.expiry_date !== null\n        );\n        \n        console.log('Batches with expiry dates:', batchesWithExpiry.length);\n        \n        if (batchesWithExpiry.length === 0) {\n            console.log('No batches with expiry dates found');\n            $('#batch-items-loading').hide();\n            $('#batch-items-empty').show();\n            updateAllExpiryStatsCards({ expired: 0, useImmediately: 0, nearExpiry: 0, healthy: 0 });\n            return;\n        }\n        \n        console.log('Step 2: Fetching item details for', batchesWithExpiry.length, 'batches...');\n        updateLoadingProgress(4);\n        \n        // Get unique item codes\n        const itemCodes = [...new Set(batchesWithExpiry.map(batch => batch.item))];\n        console.log('Unique items to fetch:', itemCodes.length);\n        \n        return frappe.db.get_list('Item', {\n            filters: {\n                'name': ['in', itemCodes]\n            },\n            fields: ['name', 'item_name', 'stock_uom'],\n            limit_page_length: 0\n        }).then(items => {\n            console.log('Items loaded:', items.length);\n            \n            // Create item lookup\n            const itemLookup = {};\n            items.forEach(item => {\n                itemLookup[item.name] = item;\n            });\n            \n            // Use ERPNext's proper batch-warehouse relationship via get_batch_qty\n            console.log('Step 3: Getting batch quantities using ERPNext get_batch_qty function...');\n            updateLoadingProgress(5);\n            \n            // Process each batch to get warehouse-wise quantities using ERPNext function\n            const batchPromises = batchesWithExpiry.map(batch => {\n                return frappe.call({\n                    method: 'erpnext.stock.doctype.batch.batch.get_batch_qty',\n                    args: {\n                        batch_no: batch.name,\n                        item_code: batch.item,\n                        for_stock_levels: true, // Include all batches (expired and non-expired)\n                        consider_negative_batches: false\n                    }\n                }).then(response => {\n                    const batchQtyData = response.message || [];\n                    console.log('Batch qty data for', batch.name, ':', batchQtyData.length, 'warehouses');\n                    \n                    // Only include warehouses with positive quantities\n                    const filteredData = batchQtyData.filter(d => d.qty > 0);\n                    \n                    return {\n                        batch: batch,\n                        item: itemLookup[batch.item],\n                        warehouseData: filteredData\n                    };\n                });\n            });\n            \n            return Promise.all(batchPromises).then(batchResults => {\n                console.log('All batch results processed:', batchResults.length);\n                \n                console.log('Step 4: Processing comprehensive batch data...');\n                updateLoadingProgress(6);\n                \n                const processedData = processAllBatchDataFromBatchQty(batchResults, batchesWithExpiry, itemLookup);\n                \n                // Update UI with processed data\n                updateLoadingProgress(7);\n                allBatchItems = processedData.items;\n                filteredBatchItems = processedData.items;\n                updateAllExpiryStatsCards(processedData.stats);\n                populateAllBatchItemsTable(processedData.items);\n                \n                // Hide loading and show dashboard\n                setTimeout(() => {\n                    hideLoading();\n                    $('#batch-items-loading').hide();\n                    $('#batch-items-table-container').show();\n                }, 500);\n            });\n        });\n    }).catch(error => {\n        console.error('Error loading batch expiry data:', error);\n        $('#batch-items-loading').hide();\n        $('#batch-items-empty').show();\n        updateAllExpiryStatsCards({ expired: 0, useImmediately: 0, nearExpiry: 0, healthy: 0 });\n    });\n}\n\n// Process batch data from separate API calls (full detailed version)\nfunction processAllBatchDataFromLists(batches, itemLookup, stockEntries) {\n    const stats = {\n        expired: 0,\n        useImmediately: 0,\n        nearExpiry: 0,\n        healthy: 0\n    };\n    \n    // Group stock entries by batch (or by item if batch_no is null)\n    const stockByBatch = {};\n    const stockByItem = {};\n    \n    stockEntries.forEach(entry => {\n        if (entry.batch_no) {\n            // Regular batch-specific stock entry\n            if (!stockByBatch[entry.batch_no]) {\n                stockByBatch[entry.batch_no] = [];\n            }\n            stockByBatch[entry.batch_no].push(entry);\n        } else if (entry.item_code) {\n            // Fallback: stock entry by item (from Bin)\n            if (!stockByItem[entry.item_code]) {\n                stockByItem[entry.item_code] = [];\n            }\n            stockByItem[entry.item_code].push(entry);\n        }\n    });\n    \n    const items = [];\n    const today = new Date();\n    \n    batches.forEach(batch => {\n        const item = itemLookup[batch.item];\n        if (!item) return;\n        \n        // Calculate days to expiry\n        const expiryDate = new Date(batch.expiry_date);\n        const timeDiff = expiryDate.getTime() - today.getTime();\n        const daysToExpiry = Math.ceil(timeDiff / (1000 * 3600 * 24));\n        \n        // Get stock entries for this batch (try batch-specific first, then item-based fallback)\n        let batchStockEntries = stockByBatch[batch.name] || [];\n        \n        // If no batch-specific entries, use item-based entries as fallback\n        if (batchStockEntries.length === 0) {\n            batchStockEntries = stockByItem[batch.item] || [];\n        }\n        \n        // Group by warehouse and calculate total qty per warehouse\n        const warehouseQty = {};\n        batchStockEntries.forEach(entry => {\n            if (!warehouseQty[entry.warehouse]) {\n                warehouseQty[entry.warehouse] = 0;\n            }\n            warehouseQty[entry.warehouse] += entry.actual_qty || 0;\n        });\n        \n        // If still no stock entries, create a default entry to show the batch exists\n        if (Object.keys(warehouseQty).length === 0) {\n            warehouseQty['Unknown Warehouse'] = 1; // Show batch with minimal qty\n        }\n        \n        // Create entries for each warehouse with positive stock\n        Object.keys(warehouseQty).forEach(warehouse => {\n            const qty = warehouseQty[warehouse];\n            if (qty > 0) {\n                const batchItem = {\n                    batch_no: batch.name,\n                    item_code: batch.item,\n                    item_name: item.item_name,\n                    stock_uom: item.stock_uom,\n                    expiry_date: batch.expiry_date,\n                    days_to_expiry: daysToExpiry,\n                    warehouse: warehouse,\n                    available_qty: qty\n                };\n                \n                // Determine status based on days to expiry\n                if (daysToExpiry < expiryThresholds.expired) {\n                    batchItem.status = 'expired';\n                    batchItem.statusLabel = 'EXPIRED';\n                    batchItem.statusClass = 'status-expired';\n                    stats.expired++;\n                } else if (daysToExpiry < expiryThresholds.useImmediately) {\n                    batchItem.status = 'use-immediately';\n                    batchItem.statusLabel = 'USE IMMEDIATELY';\n                    batchItem.statusClass = 'status-use-immediately';\n                    stats.useImmediately++;\n                } else if (daysToExpiry < expiryThresholds.nearExpiry) {\n                    batchItem.status = 'near-expiry';\n                    batchItem.statusLabel = 'NEAR EXPIRY';\n                    batchItem.statusClass = 'status-near-expiry';\n                    stats.nearExpiry++;\n                } else {\n                    batchItem.status = 'healthy';\n                    batchItem.statusLabel = 'HEALTHY';\n                    batchItem.statusClass = 'status-healthy';\n                    stats.healthy++;\n                }\n                \n                items.push(batchItem);\n            }\n        });\n    });\n    \n    // Sort by days to expiry (most urgent first)\n    items.sort((a, b) => a.days_to_expiry - b.days_to_expiry);\n    \n    console.log('Processed all batch data:', { totalItems: items.length, stats });\n    \n    return { items, stats };\n}\n\n// Update all expiry stats cards (using ERPNext's provided root_element)\nfunction updateAllExpiryStatsCards(stats) {\n    // Use ERPNext's provided root_element\n    const expiredCountEl = root_element.querySelector('#expired-count');\n    const useImmediatelyCountEl = root_element.querySelector('#use-immediately-count');\n    const nearExpiryCountEl = root_element.querySelector('#near-expiry-count');\n    const healthyCountEl = root_element.querySelector('#healthy-count');\n    \n    if (expiredCountEl) expiredCountEl.textContent = stats.expired;\n    if (useImmediatelyCountEl) useImmediatelyCountEl.textContent = stats.useImmediately;\n    if (nearExpiryCountEl) nearExpiryCountEl.textContent = stats.nearExpiry;\n    if (healthyCountEl) healthyCountEl.textContent = stats.healthy;\n    \n    console.log('All expiry stats updated:', stats);\n}\n\n// Populate all batch items table with enhanced color-coded status (using ERPNext's provided root_element)\nfunction populateAllBatchItemsTable(items) {\n    console.log('=== populateAllBatchItemsTable called with', items.length, 'items ===');\n    \n    // Use ERPNext's provided root_element\n    const tbody = root_element.querySelector('#batch-items-tbody');\n    console.log('Found tbody element:', tbody ? 'YES' : 'NO');\n    \n    if (tbody) {\n        tbody.innerHTML = ''; // Clear existing content\n    }\n    \n    if (items.length === 0) {\n        console.log('No items to display, showing empty state');\n        const tableContainer = root_element.querySelector('#batch-items-table-container');\n        const emptyState = root_element.querySelector('#batch-items-empty');\n        \n        if (tableContainer) tableContainer.style.display = 'none';\n        if (emptyState) emptyState.style.display = 'block';\n        return;\n    }\n    \n    console.log('Populating table with', items.length, 'items');\n    \n    // Show table container and hide empty state\n    const tableContainer = root_element.querySelector('#batch-items-table-container');\n    const emptyState = root_element.querySelector('#batch-items-empty');\n    \n    if (emptyState) emptyState.style.display = 'none';\n    if (tableContainer) tableContainer.style.display = 'block';\n    \n    console.log('Table container visibility updated');\n    \n    items.forEach(batch => {\n        // Determine expiry days color class based on status\n        let daysClass = 'safe';\n        if (batch.status === 'Expired') {\n            daysClass = 'expired';\n        } else if (batch.status === 'Use Immediately') {\n            daysClass = 'use-immediately';\n        } else if (batch.status === 'Near Expiry') {\n            daysClass = 'near-expiry';\n        } else {\n            daysClass = 'healthy';\n        }\n        \n        // Format expiry date\n        const expiryDate = batch.expires_on ? frappe.datetime.str_to_user(batch.expires_on) : '-';\n        \n        // Format expiry in days with proper sign\n        const expiryDaysText = batch.expiry_in_days >= 0 ? \n            `${batch.expiry_in_days} days` : \n            `${Math.abs(batch.expiry_in_days)} days overdue`;\n        \n        // Create table row using native DOM methods\n        const row = document.createElement('tr');\n        row.setAttribute('data-status', batch.status);\n        \n        row.innerHTML = `\n            <td>\n                <a href=\"/app/item/${batch.item_code}\" target=\"_blank\">${batch.item_code}</a>\n            </td>\n            <td>${batch.item_name || '-'}</td>\n            <td>\n                <span class=\"status-badge\" style=\"background-color: ${batch.status_color}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.85em; font-weight: 500;\">\n                    ${batch.status}\n                </span>\n            </td>\n            <td>${batch.stock_uom || '-'}</td>\n            <td>\n                <a href=\"/app/batch/${batch.batch_no}\" target=\"_blank\">${batch.batch_no}</a>\n            </td>\n            <td style=\"text-align: right;\">${(batch.total_available_qty || 0).toFixed(2)}</td>\n            <td>${batch.warehouse || '-'}</td>\n            <td>${expiryDate}</td>\n            <td class=\"expiry-days ${daysClass}\" style=\"text-align: right;\">\n                ${expiryDaysText}\n            </td>\n        `;\n        \n        // Append row using native DOM methods\n        if (tbody) {\n            tbody.appendChild(row);\n        }\n    });\n    \n    console.log('Enhanced batch items table populated with', items.length, 'items');\n}\n\n// Filter batch items by status\nfunction filterBatchItemsByStatus(status) {\n    if (!status) {\n        // Show all items\n        filteredBatchItems = allBatchItems;\n        populateAllBatchItemsTable(filteredBatchItems);\n        console.log('Showing all batch items:', filteredBatchItems.length);\n        return;\n    }\n    \n    // Map HTML dropdown values to actual status values\n    const statusMapping = {\n        'expired': 'Expired',\n        'use-immediately': 'Use Immediately',\n        'near-expiry': 'Near Expiry',\n        'healthy': 'Healthy'\n    };\n    \n    const actualStatus = statusMapping[status] || status;\n    \n    // Filter items by status\n    filteredBatchItems = allBatchItems.filter(item => item.status === actualStatus);\n    populateAllBatchItemsTable(filteredBatchItems);\n    \n    console.log('Filtered batch items by status:', actualStatus, 'Count:', filteredBatchItems.length);\n}\n\n// Show expiry threshold configuration dialog\nfunction showExpiryThresholdDialog() {\n    const dialog = new frappe.ui.Dialog({\n        title: 'Configure Expiry Thresholds',\n        fields: [\n            {\n                fieldname: 'info',\n                fieldtype: 'HTML',\n                options: '<p style=\"margin-bottom: 15px;\">Configure the number of days for each expiry status category. Days are calculated from today\\'s date.</p>'\n            },\n            {\n                label: 'Use Immediately (Orange)',\n                fieldname: 'use_immediately',\n                fieldtype: 'Int',\n                default: expiryThresholds.useImmediately,\n                description: 'Items expiring in less than this many days'\n            },\n            {\n                label: 'Near Expiry (Yellow)',\n                fieldname: 'near_expiry',\n                fieldtype: 'Int',\n                default: expiryThresholds.nearExpiry,\n                description: 'Items expiring between Use Immediately and this value'\n            },\n            {\n                label: 'Healthy (Green)',\n                fieldname: 'healthy',\n                fieldtype: 'Int',\n                default: expiryThresholds.healthy,\n                description: 'Items expiring in more than this many days'\n            },\n            {\n                fieldname: 'example',\n                fieldtype: 'HTML',\n                options: `\n                    <div style=\"margin-top: 15px; padding: 12px; background: #f0f4f8; border-radius: 6px;\">\n                        <strong>Current Settings:</strong><br>\n                        üî¥ Expired: Less than 0 days<br>\n                        üü† Use Immediately: Less than ${expiryThresholds.useImmediately} days (${Math.round(expiryThresholds.useImmediately/30)} months)<br>\n                        üü° Near Expiry: ${expiryThresholds.useImmediately} to ${expiryThresholds.nearExpiry} days (${Math.round(expiryThresholds.useImmediately/30)}-${Math.round(expiryThresholds.nearExpiry/30)} months)<br>\n                        üü¢ Healthy: More than ${expiryThresholds.healthy} days (${Math.round(expiryThresholds.healthy/365)} years)\n                    </div>\n                `\n            }\n        ],\n        primary_action_label: 'Save & Refresh',\n        primary_action: function(values) {\n            // Update thresholds\n            expiryThresholds.useImmediately = values.use_immediately || 180;\n            expiryThresholds.nearExpiry = values.near_expiry || 365;\n            expiryThresholds.healthy = values.healthy || 730;\n            \n            console.log('Expiry thresholds updated:', expiryThresholds);\n            \n            // Reload data with new thresholds\n            loadAllBatchExpiryData();\n            \n            dialog.hide();\n            \n            frappe.show_alert({\n                message: 'Expiry thresholds updated successfully',\n                indicator: 'green'\n            });\n        }\n    });\n    \n    dialog.show();\n}\n\n// Export batch items to Excel using ERPNext's export functionality\nfunction exportBatchItemsToExcel() {\n    if (!filteredBatchItems || filteredBatchItems.length === 0) {\n        frappe.show_alert({\n            message: 'No batch items to export',\n            indicator: 'orange'\n        });\n        return;\n    }\n    \n    console.log('Preparing data for export...', filteredBatchItems.length, 'items');\n    \n    // Prepare data for export with proper column headers\n    const exportData = filteredBatchItems.map(item => {\n        return {\n            'Item Code': item.item_code || '',\n            'Item Name': item.item_name || '',\n            'Status': item.status || '',\n            'Stock UOM': item.stock_uom || '',\n            'Batch No': item.batch_no || '',\n            'Total Available Quantity': (item.total_available_qty || 0).toFixed(2),\n            'Warehouse': item.warehouse || '',\n            'Expires On': item.expires_on || '',\n            'Expiry In Days': item.expiry_in_days || 0\n        };\n    });\n    \n    // Use ERPNext's CSV export functionality (which Excel can open)\n    try {\n        // Create CSV content\n        const headers = Object.keys(exportData[0]);\n        let csvContent = headers.join(',') + '\\n';\n        \n        exportData.forEach(row => {\n            const values = headers.map(header => {\n                let value = row[header] || '';\n                // Escape commas and quotes in CSV\n                if (typeof value === 'string' && (value.includes(',') || value.includes('\"'))) {\n                    value = '\"' + value.replace(/\"/g, '\"\"') + '\"';\n                }\n                return value;\n            });\n            csvContent += values.join(',') + '\\n';\n        });\n        \n        // Create and download file\n        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\n        const link = document.createElement('a');\n        const url = URL.createObjectURL(blob);\n        link.setAttribute('href', url);\n        link.setAttribute('download', `batch_expiry_analysis_${frappe.datetime.now_date()}.csv`);\n        link.style.visibility = 'hidden';\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        \n        frappe.show_alert({\n            message: `${filteredBatchItems.length} batch items exported successfully to CSV`,\n            indicator: 'green'\n        });\n        \n        console.log('Export completed successfully');\n        \n    } catch (error) {\n        console.error('Export error:', error);\n        frappe.show_alert({\n            message: 'Export failed: ' + error.message,\n            indicator: 'red'\n        });\n    }\n}\n\n// Mark expired items for disposal\nfunction markExpiredItemsForDisposal() {\n    const expiredItems = allBatchItems.filter(item => item.status === 'expired');\n    \n    if (expiredItems.length === 0) {\n        frappe.show_alert({\n            message: 'No expired items found to mark for disposal',\n            indicator: 'orange'\n        });\n        return;\n    }\n    \n    frappe.confirm(\n        `Mark ${expiredItems.length} expired items for disposal?`,\n        function() {\n            // Here you would implement the disposal marking logic\n            // For now, just show a success message\n            frappe.show_alert({\n                message: `${expiredItems.length} expired items marked for disposal`,\n                indicator: 'green'\n            });\n            \n            console.log('Expired items marked for disposal:', expiredItems);\n        }\n    );\n}\n\n// Generate expiry report\nfunction generateExpiryReport() {\n    frappe.show_alert({\n        message: 'Generating comprehensive expiry report...',\n        indicator: 'blue'\n    });\n    \n    // Here you would implement report generation logic\n    console.log('Generating expiry report for', allBatchItems.length, 'items');\n}\n\n// Export all batch data\nfunction exportAllBatchData() {\n    if (allBatchItems.length === 0) {\n        frappe.show_alert({\n            message: 'No batch data to export',\n            indicator: 'orange'\n        });\n        return;\n    }\n    \n    exportBatchItemsToExcel();\n}\n\n// Process comprehensive batch data from get_batch_qty results (proper ERPNext way)\nfunction processAllBatchDataFromBatchQty(batchResults) {\n    const allItems = [];\n    const stats = { expired: 0, useImmediately: 0, nearExpiry: 0, healthy: 0 };\n    const today = new Date();\n    \n    batchResults.forEach(result => {\n        const { batch, item, warehouseData } = result;\n        \n        if (!item || !warehouseData || warehouseData.length === 0) {\n            return;\n        }\n        \n        // Calculate expiry status and days\n        const expiryDate = new Date(batch.expiry_date);\n        const timeDiff = expiryDate.getTime() - today.getTime();\n        const expiryInDays = Math.ceil(timeDiff / (1000 * 3600 * 24));\n        \n        // Determine status based on configurable thresholds\n        let status = 'Healthy';\n        if (expiryInDays < expiryThresholds.expired) {\n            status = 'Expired';\n        } else if (expiryInDays < expiryThresholds.useImmediately) {\n            status = 'Use Immediately';\n        } else if (expiryInDays < expiryThresholds.nearExpiry) {\n            status = 'Near Expiry';\n        } else if (expiryInDays >= expiryThresholds.healthy) {\n            status = 'Healthy';\n        }\n        \n        // Calculate total quantity across all warehouses for this batch\n        const totalQty = warehouseData.reduce((sum, w) => sum + (w.qty || 0), 0);\n        \n        // Create entries for each warehouse with stock (filter by selected warehouse if any)\n        warehouseData.forEach(warehouseEntry => {\n            if (warehouseEntry.qty > 0) {\n                // Apply warehouse filter if selected\n                if (selectedWarehouse && warehouseEntry.warehouse !== selectedWarehouse) {\n                    return; // Skip this warehouse entry\n                }\n                \n                const batchItem = {\n                    item_code: batch.item,\n                    item_name: item.item_name,\n                    stock_uom: item.stock_uom,\n                    batch_no: batch.name,\n                    total_available_qty: selectedWarehouse ? warehouseEntry.qty : totalQty,\n                    warehouse: warehouseEntry.warehouse,\n                    warehouse_qty: warehouseEntry.qty,\n                    expires_on: batch.expiry_date,\n                    expiry_in_days: expiryInDays,\n                    status: status,\n                    status_color: statusColors[status]\n                };\n                \n                allItems.push(batchItem);\n            }\n        });\n        \n        // Update stats based on warehouse filtering\n        let shouldCountBatch = false;\n        \n        if (selectedWarehouse) {\n            // When warehouse filter is applied, count only if batch has stock in that warehouse\n            const warehouseEntry = warehouseData.find(w => w.warehouse === selectedWarehouse && w.qty > 0);\n            shouldCountBatch = !!warehouseEntry;\n        } else {\n            // When no warehouse filter, count if batch has any stock\n            shouldCountBatch = totalQty > 0;\n        }\n        \n        if (shouldCountBatch) {\n            console.log('Counting batch:', batch.name, 'Status:', status, 'Warehouse Filter:', selectedWarehouse || 'All');\n            // Map status to correct stats keys\n            if (status === 'Expired') {\n                stats.expired++;\n            } else if (status === 'Use Immediately') {\n                stats.useImmediately++;\n            } else if (status === 'Near Expiry') {\n                stats.nearExpiry++;\n            } else if (status === 'Healthy') {\n                stats.healthy++;\n            }\n        }\n    });\n    \n    // Sort by expiry date (most critical first)\n    allItems.sort((a, b) => {\n        // First by status priority (Expired > Use Immediately > Near Expiry > Healthy)\n        const statusPriority = { 'Expired': 4, 'Use Immediately': 3, 'Near Expiry': 2, 'Healthy': 1 };\n        const priorityDiff = statusPriority[b.status] - statusPriority[a.status];\n        if (priorityDiff !== 0) return priorityDiff;\n        \n        // Then by expiry date (earliest first)\n        return a.expiry_in_days - b.expiry_in_days;\n    });\n    \n    console.log('Processed comprehensive batch items:', allItems.length);\n    console.log('Stats breakdown (warehouse filtered):', stats);\n    console.log('Warehouse filter applied:', selectedWarehouse || 'All Warehouses');\n    \n    return {\n        items: allItems,\n        stats: stats\n    };\n}\n\nconsole.log('Batch Expiry Dashboard JavaScript loaded successfully');",
  "style": "/* ============================================\n   BATCH EXPIRY DASHBOARD - FULL DETAILED VIEW\n   ============================================ */\n\n/* Dashboard Container */\n.batch-expiry-dashboard {\n    width: 100%;\n    margin: 0;\n    padding: 20px;\n    background: #f8fafc;\n    min-height: 100vh;\n}\n\n/* Dashboard Header */\n.dashboard-header {\n    background: white;\n    border-radius: 12px;\n    padding: 24px;\n    margin-bottom: 24px;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.header-title-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 12px;\n}\n\n.dashboard-title {\n    margin: 0;\n    font-size: 1.8rem;\n    font-weight: 700;\n    color: #1f2937;\n}\n\n.header-actions {\n    display: flex;\n    gap: 12px;\n    align-items: center;\n}\n\n/* Filter input styling */\n.header-actions .filter-group {\n    position: relative;\n}\n\n.header-actions .filter-group input {\n    width: 150px !important;\n    max-width: 150px !important;\n}\n\n/* Awesomplete dropdown styling */\n.header-actions .awesomplete {\n    display: inline-block !important;\n    width: 150px !important;\n    position: relative !important;\n}\n\n.header-actions .awesomplete > ul {\n    width: 150px !important;\n    max-width: 150px !important;\n    position: absolute !important;\n    left: 0 !important;\n    top: 100% !important;\n    margin-top: 2px !important;\n}\n\n.dashboard-subtitle {\n    font-size: 1rem;\n    color: #6b7280;\n    margin: 0;\n}\n\n/* Summary Cards Section - Fixed grid layout */\n.expiry-summary-section {\n    display: grid !important;\n    grid-template-columns: repeat(4, 1fr) !important;\n    gap: 20px;\n    margin-bottom: 30px;\n    width: 100% !important;\n    max-width: none !important;\n    box-sizing: border-box;\n}\n\n@media (max-width: 1200px) {\n    .expiry-summary-section {\n        grid-template-columns: repeat(2, 1fr) !important;\n    }\n}\n\n@media (max-width: 768px) {\n    .expiry-summary-section {\n        grid-template-columns: 1fr !important;\n        gap: 15px;\n    }\n}\n\n/* Force horizontal layout with flexbox fallback */\n.batch-expiry-dashboard .expiry-summary-section {\n    display: grid !important;\n    grid-template-columns: repeat(4, 1fr) !important;\n    width: 100% !important;\n}\n\n/* Alternative flexbox approach if grid fails */\n.expiry-summary-section.flex-fallback {\n    display: flex !important;\n    flex-wrap: wrap !important;\n    justify-content: space-between !important;\n}\n\n.expiry-summary-section.flex-fallback .expiry-summary-card {\n    flex: 1 1 calc(25% - 15px) !important;\n    min-width: 200px !important;\n}\n\n.expiry-summary-card {\n    background: white;\n    border-radius: 12px;\n    padding: 20px;\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n    transition: transform 0.2s ease, box-shadow 0.2s ease;\n    min-height: 100px;\n    width: 100%;\n}\n\n.expiry-summary-card:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);\n}\n\n.summary-icon {\n    font-size: 2.5rem;\n    flex-shrink: 0;\n}\n\n.summary-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.summary-value {\n    font-size: 2rem;\n    font-weight: 700;\n    margin-bottom: 4px;\n    line-height: 1.2;\n}\n\n.summary-label {\n    font-size: 1rem;\n    font-weight: 600;\n    margin-bottom: 2px;\n    white-space: nowrap;\n}\n\n.summary-description {\n    font-size: 0.875rem;\n    color: #6b7280;\n    line-height: 1.3;\n}\n\n/* Status-specific card colors */\n.expired-card {\n    border-left: 4px solid #dc2626;\n}\n\n.expired-card .summary-value {\n    color: #dc2626;\n}\n\n.expired-card .summary-label {\n    color: #991b1b;\n}\n\n.use-immediately-card {\n    border-left: 4px solid #ea580c;\n}\n\n.use-immediately-card .summary-value {\n    color: #ea580c;\n}\n\n.use-immediately-card .summary-label {\n    color: #c2410c;\n}\n\n.near-expiry-card {\n    border-left: 4px solid #d97706;\n}\n\n.near-expiry-card .summary-value {\n    color: #d97706;\n}\n\n.near-expiry-card .summary-label {\n    color: #92400e;\n}\n\n.healthy-card {\n    border-left: 4px solid #16a34a;\n}\n\n.healthy-card .summary-value {\n    color: #16a34a;\n}\n\n.healthy-card .summary-label {\n    color: #15803d;\n}\n\n/* Batch Items Section */\n.batch-items-section {\n    background: white;\n    border-radius: 12px;\n    padding: 16px;\n    margin-bottom: 20px;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.section-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 12px;\n    padding-bottom: 10px;\n    border-bottom: 1px solid #f3f4f6;\n}\n\n.section-title {\n    margin: 0;\n    font-size: 1.2rem;\n    font-weight: 600;\n    color: #1f2937;\n}\n\n.section-actions {\n    display: flex;\n    gap: 12px;\n    align-items: center;\n}\n\n/* Loading State */\n.batch-items-loading {\n    text-align: center;\n    padding: 60px 20px;\n}\n\n.loading-content {\n    display: inline-block;\n}\n\n.loading-spinner {\n    width: 40px;\n    height: 40px;\n    border: 4px solid #f3f4f6;\n    border-top: 4px solid #3b82f6;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin: 0 auto 16px;\n}\n\n@keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\n.loading-text {\n    font-size: 1.1rem;\n    color: #6b7280;\n    font-weight: 500;\n}\n\n/* Empty State */\n.batch-items-empty {\n    text-align: center;\n    padding: 60px 20px;\n}\n\n.empty-state {\n    max-width: 400px;\n    margin: 0 auto;\n}\n\n.empty-icon {\n    font-size: 4rem;\n    margin-bottom: 16px;\n    opacity: 0.6;\n}\n\n.empty-title {\n    font-size: 1.3rem;\n    font-weight: 600;\n    color: #374151;\n    margin-bottom: 8px;\n}\n\n.empty-text {\n    font-size: 1rem;\n    color: #6b7280;\n}\n\n/* Scrollable Table Container */\n.batch-items-table-container {\n    border: 1px solid #e5e7eb;\n    border-radius: 8px;\n    overflow: hidden;\n    background: white;\n}\n\n.table-wrapper {\n    max-height: 450px;\n    overflow-y: auto;\n    overflow-x: auto;\n}\n\n/* Table Styling */\n.batch-items-table {\n    width: 100%;\n    margin: 0;\n    border-collapse: collapse;\n    min-width: 1000px;\n}\n\n.batch-items-table thead th {\n    position: sticky;\n    top: 0;\n    background: #f9fafb;\n    z-index: 10;\n    border-bottom: 2px solid #e5e7eb;\n    font-weight: 600;\n    color: #374151;\n    padding: 8px 6px;\n    text-align: left;\n    font-size: 0.8rem;\n}\n\n.batch-items-table tbody tr {\n    border-bottom: 1px solid #f3f4f6;\n    transition: background-color 0.2s ease;\n}\n\n.batch-items-table tbody tr:hover {\n    background: #f9fafb;\n}\n\n.batch-items-table tbody td {\n    padding: 8px 6px;\n    vertical-align: middle;\n    font-size: 0.8rem;\n    line-height: 1.3;\n}\n\n/* Status Badges - Compact */\n.status-badge {\n    padding: 3px 6px;\n    border-radius: 8px;\n    font-size: 0.7rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.3px;\n}\n\n.status-expired {\n    background: #fef2f2;\n    color: #dc2626;\n    border: 1px solid #fca5a5;\n}\n\n.status-use-immediately {\n    background: #fff7ed;\n    color: #ea580c;\n    border: 1px solid #fdba74;\n}\n\n.status-near-expiry {\n    background: #fffbeb;\n    color: #d97706;\n    border: 1px solid #fcd34d;\n}\n\n.status-healthy {\n    background: #f0fdf4;\n    color: #16a34a;\n    border: 1px solid #86efac;\n}\n\n/* Expiry Days Styling */\n.expiry-days {\n    font-weight: 600;\n}\n\n.expiry-days.negative {\n    color: #dc2626;\n}\n\n.expiry-days.warning {\n    color: #ea580c;\n}\n\n.expiry-days.caution {\n    color: #d97706;\n}\n\n.expiry-days.safe {\n    color: #16a34a;\n}\n\n/* Action Buttons */\n.dashboard-actions {\n    display: flex;\n    gap: 12px;\n    justify-content: center;\n    padding: 24px;\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.dashboard-actions .btn {\n    padding: 10px 20px;\n    font-weight: 600;\n    border-radius: 8px;\n    transition: all 0.2s ease;\n}\n\n.dashboard-actions .btn:hover {\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n/* Loading State Styles */\n.dashboard-loading {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    min-height: 400px;\n    background: white;\n    border-radius: 12px;\n    margin: 20px 0;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.loading-content {\n    text-align: center;\n    max-width: 400px;\n    padding: 40px 20px;\n}\n\n.loading-spinner {\n    width: 60px;\n    height: 60px;\n    border: 4px solid #f3f4f6;\n    border-top: 4px solid #3b82f6;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin: 0 auto 20px;\n}\n\n@keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\n.loading-title {\n    font-size: 1.5rem;\n    font-weight: 600;\n    color: #1f2937;\n    margin-bottom: 10px;\n}\n\n.loading-message {\n    font-size: 1rem;\n    color: #6b7280;\n    margin-bottom: 20px;\n    min-height: 24px;\n}\n\n.loading-progress {\n    margin-top: 20px;\n}\n\n.progress-bar {\n    width: 100%;\n    height: 8px;\n    background-color: #e5e7eb;\n    border-radius: 4px;\n    overflow: hidden;\n    margin-bottom: 8px;\n}\n\n.progress-fill {\n    height: 100%;\n    background: linear-gradient(90deg, #3b82f6, #1d4ed8);\n    border-radius: 4px;\n    width: 0%;\n    transition: width 0.3s ease;\n}\n\n.progress-text {\n    font-size: 0.875rem;\n    color: #6b7280;\n    font-weight: 500;\n}\n\n/* Responsive Design */\n@media (max-width: 1200px) {\n    .batch-expiry-dashboard {\n        padding: 16px;\n    }\n    \n    .dashboard-header {\n        padding: 20px;\n    }\n    \n    .batch-items-section {\n        padding: 20px;\n    }\n}\n\n@media (max-width: 768px) {\n    .header-title-row {\n        flex-direction: column;\n        gap: 16px;\n    }\n    \n    .expiry-summary-section {\n        grid-template-columns: 1fr;\n        gap: 15px;\n    }\n    \n    .header-title-row {\n        flex-direction: column;\n        align-items: flex-start;\n        gap: 15px;\n    }\n    \n    .header-actions {\n        width: 100%;\n        justify-content: flex-start;\n    }\n    \n    .dashboard-actions {\n        flex-direction: column;\n        gap: 10px;\n    }\n    \n    .dashboard-actions .btn {\n        width: 100%;\n    }\n    \n    .status-badge {\n        min-width: 80px;\n        font-size: 0.75em;\n    }\n    \n    .batch-items-table thead th,\n    .batch-items-table tbody td {\n        padding: 8px 6px;\n        font-size: 0.8rem;\n    }\n    \n    .batch-items-table {\n        min-width: 800px;\n    }\n    \n    .dashboard-actions {\n        flex-direction: column;\n        gap: 8px;\n    }\n    \n    .dashboard-actions .btn {\n        width: 100%;\n    }\n}\n\n@media (max-width: 480px) {\n    .batch-expiry-dashboard {\n        padding: 12px;\n    }\n    \n    .dashboard-header {\n        padding: 16px;\n    }\n    \n    .batch-items-section {\n        padding: 16px;\n    }\n    \n    .expiry-summary-card {\n        padding: 16px;\n        gap: 12px;\n    }\n    \n    .summary-icon {\n        font-size: 2rem;\n    }\n    \n    .summary-value {\n        font-size: 1.5rem;\n    }\n    \n    .table-wrapper {\n        max-height: 300px;\n    }\n}"
 },
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div class=\"ucl-container\">\r\n\r\n  <!-- Tabs -->\r\n  <input type=\"radio\" name=\"ucl-tabs\" id=\"tab-sales\" checked>\r\n  <input type=\"radio\" name=\"ucl-tabs\" id=\"tab-procurement\">\r\n  <input type=\"radio\" name=\"ucl-tabs\" id=\"tab-masters\">\r\n  <input type=\"radio\" name=\"ucl-tabs\" id=\"tab-crm\">\r\n\r\n  <div class=\"ucl-tabs\">\r\n    <label for=\"tab-sales\" class=\"ucl-tab\">ü©∑ Sales</label>\r\n    <label for=\"tab-procurement\" class=\"ucl-tab\">üì¶ Procurement</label>\r\n   <label for=\"tab-masters\" class=\"ucl-tab\">üóÇÔ∏è Masters</label>\r\n    <label for=\"tab-crm\" class=\"ucl-tab\">üåêÔ∏è CRM</label>\r\n  </div>\r\n\r\n  <!-- Sales Tab -->\r\n  <div class=\"ucl-tab-content sales\" >\r\n    <div class=\"ucl-grid\">\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Quotation')\">\r\n        <div><div class=\"ucl-icon\">üìù</div><div class=\"ucl-title\">Quotation</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Sales Order')\">\r\n        <div><div class=\"ucl-icon\">üì¶</div><div class=\"ucl-title\">Sales Order</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('Report','Sales Invoice')\">\r\n        <div><div class=\"ucl-icon\">üßæ</div><div class=\"ucl-title\">Sales Invoice</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('Report','POS Invoice')\">\r\n        <div><div class=\"ucl-icon\">üßæ</div><div class=\"ucl-title\">POS Invoice</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('point-of-sale')\">\r\n        <div><div class=\"ucl-icon\">üõí</div><div class=\"ucl-title\">Point Of Sale</div></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Procurement Tab -->\r\n  <div class=\"ucl-tab-content procurement\">\r\n    <div class=\"ucl-grid\">\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Material Request')\">\r\n        <div><div class=\"ucl-icon\">üìÑ</div><div class=\"ucl-title\">Product Request</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Stock Entry')\">\r\n        <div><div class=\"ucl-icon\">üè∑Ô∏è</div><div class=\"ucl-title\">Stock Entry</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Purchase Order')\">\r\n        <div><div class=\"ucl-icon\">üß∫</div><div class=\"ucl-title\">Purchase Order</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Purchase Receipt')\">\r\n        <div><div class=\"ucl-icon\">üßæ</div><div class=\"ucl-title\">Purchase Receipt</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Purchase Invoice')\">\r\n        <div><div class=\"ucl-icon\">üí≥</div><div class=\"ucl-title\">Purchase Invoice</div></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Masters Tab -->\r\n  <div class=\"ucl-tab-content masters\">\r\n    <div class=\"ucl-grid\">\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Item')\">\r\n        <div><div class=\"ucl-icon\">ñ£ò</div><div class=\"ucl-title\">Item</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Supplier')\">\r\n        <div><div class=\"ucl-icon\">üë•</div><div class=\"ucl-title\">Supplier</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Customer')\">\r\n        <div><div class=\"ucl-icon\">üë§</div><div class=\"ucl-title\">Customer</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Branch')\">\r\n        <div><div class=\"ucl-icon\">üåê</div><div class=\"ucl-title\">Branch</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Warehouse')\">\r\n        <div><div class=\"ucl-icon\">ñ†ø</div><div class=\"ucl-title\">Warehouse</div></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n<!-- CRM Tab -->\r\n  <div class=\"ucl-tab-content crm\">\r\n    <div class=\"ucl-grid\">\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Lead')\">\r\n        <div><div class=\"ucl-icon\">‚ÜîÔ∏è</div><div class=\"ucl-title\">Lead</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Opportunity')\">\r\n        <div><div class=\"ucl-icon\">üë•</div><div class=\"ucl-title\">Opportunity</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Customer')\">\r\n        <div><div class=\"ucl-icon\">üë§</div><div class=\"ucl-title\">Customer</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Appointment')\">\r\n        <div><div class=\"ucl-icon\">üìû</div><div class=\"ucl-title\">Appointment</div></div>\r\n      </div>\r\n\r\n     \r\n    </div>\r\n  </div>\r\n\r\n</div>\r\n",
  "modified": "2026-01-29 17:20:00.312140",
  "name": "UCL Dashboard",
  "private": 0,
  "roles": [],
  "script": "",
  "style": "\r\n.ucl-container {\r\n  padding: 10px;\r\n}\r\n\r\n.ucl-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\r\n  gap: 18px;\r\n}\r\n\r\n.ucl-card {\r\n  aspect-ratio: 1 / 1;\r\n  background:#FFFFFF; /* baby pink */\r\n  border-radius: 14px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  text-align: center;\r\n  cursor: pointer;\r\n  transition: all 0.25s ease;\r\n  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.08);\r\n}\r\n\r\n.ucl-card:hover {\r\n  transform: translateY(-6px);\r\n  box-shadow: 0 12px 26px rgba(0, 0, 0, 0.14);\r\n  background: linear-gradient(90deg, #667eea, #764ba2);\r\n  color: #FFFFFF;\r\n}\r\n\r\n.ucl-title {\r\n  font-size: 15px;\r\n  font-weight: 600;\r\n  color: #831843;\r\n}\r\n.ucl-title:hover {\r\n \r\n  color: #FFFFFF;\r\n}\r\n\r\n.ucl-icon {\r\n  font-size: 28px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.ucl-section-title {\r\n  margin: 20px 0 12px;\r\n  font-size: 18px;\r\n  font-weight: 700;\r\n  color: #FFFFFF;\r\n}\r\n/* Hide radio buttons */\r\ninput[name=\"ucl-tabs\"] {\r\n  display: none;\r\n}\r\n\r\n.ucl-tabs {\r\n  display: flex;\r\n  gap: 12px;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.ucl-tab {\r\n  padding: 10px 18px;\r\n  border-radius: 20px;\r\n  background: #FFFFFF;\r\n  cursor: pointer;\r\n  font-weight: 600;\r\n}\r\n\r\n/* Active tab */\r\n#tab-sales:checked ~ .ucl-tabs label[for=\"tab-sales\"],\r\n#tab-procurement:checked ~ .ucl-tabs label[for=\"tab-procurement\"],\r\n#tab-masters:checked ~ .ucl-tabs label[for=\"tab-masters\"], \r\n#tab-crm:checked ~ .ucl-tabs label[for=\"tab-crm\"]{\r\n  background: linear-gradient(90deg, #667eea, #764ba2);\r\n  color:#FFFFFF;\r\n}\r\n\r\n/* Hide all content */\r\n.ucl-tab-content {\r\n  display: none;\r\n}\r\n\r\n/* Show active content */\r\n#tab-sales:checked ~ .sales {\r\n  display: block;\r\n}\r\n\r\n#tab-procurement:checked ~ .procurement {\r\n  display: block;\r\n}\r\n\r\n#tab-masters:checked ~ .masters {\r\n  display: block;\r\n}\r\n#tab-crm:checked ~ .crm {\r\n  display: block;\r\n}\r\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div class=\"complete-executive-dashboard\">\n    <!-- KPI Cards Section -->\n    <div class=\"executive-dashboard-kpis\">\n        <div class=\"dashboard-header\">\n            <h3 class=\"dashboard-title\">üíä Pharmacy Dashboard - Branch Analytics</h3>\n            <div class=\"dashboard-controls\">\n                <select id=\"period-selector\" class=\"form-control\" style=\"width: 140px; display: inline-block; margin-right: 10px;\">\n                    <option value=\"daily\">Daily</option>\n                    <option value=\"monthly\" selected>Monthly</option>\n                    <option value=\"quarterly\">Quarterly</option>\n                    <option value=\"yearly\">Yearly</option>\n                </select>\n                <select id=\"branch-selector\" class=\"form-control\" style=\"width: 180px; display: inline-block; margin-right: 10px;\">\n                    <option value=\"\">All Branches</option>\n                </select>\n                <button class=\"btn btn-primary btn-sm\" id=\"refresh-dashboard\">üîÑ Refresh</button>\n            </div>\n        </div>\n        \n        <div class=\"kpi-cards-container\">\n            <div class=\"kpi-card clickable-card\" id=\"prescription-card\" data-report=\"sales-invoice\">\n                <div class=\"kpi-icon\">üìã</div>\n                <div class=\"kpi-content\">\n                    <div class=\"kpi-value\" id=\"prescription-value\">-</div>\n                    <div class=\"kpi-label\" id=\"prescription-label\">Monthly Invoices</div>\n                    <div class=\"kpi-growth\" id=\"prescription-growth\">-</div>\n                </div>\n            </div>\n            \n            <div class=\"kpi-card clickable-card\" id=\"sales-card\" data-report=\"sales-invoice\">\n                <div class=\"kpi-icon\">üí∞</div>\n                <div class=\"kpi-content\">\n                    <div class=\"kpi-value\" id=\"sales-value\">-</div>\n                    <div class=\"kpi-label\" id=\"sales-label\">Monthly Sales</div>\n                    <div class=\"kpi-growth\" id=\"sales-growth\">-</div>\n                </div>\n            </div>\n            \n            <div class=\"kpi-card clickable-card\" id=\"inventory-card\" data-report=\"stock-balance\">\n                <div class=\"kpi-icon\">üì¶</div>\n                <div class=\"kpi-content\">\n                    <div class=\"kpi-value\" id=\"inventory-value\">-</div>\n                    <div class=\"kpi-label\" id=\"inventory-label\">Inventory</div>\n                    <div class=\"kpi-growth\" id=\"inventory-growth\">-</div>\n                </div>\n            </div>\n            \n            <div class=\"kpi-card clickable-card\" id=\"customer-card\" data-report=\"customer-list\">\n                <div class=\"kpi-icon\">üë•</div>\n                <div class=\"kpi-content\">\n                    <div class=\"kpi-value\" id=\"customer-value\">-</div>\n                    <div class=\"kpi-label\" id=\"customer-label\">Monthly Customers</div>\n                    <div class=\"kpi-growth\" id=\"customer-growth\">-</div>\n                </div>\n            </div>\n            \n            <div class=\"kpi-card\" id=\"item-movement-card\">\n                <div class=\"kpi-content-split\">\n                    <div class=\"kpi-section fast-moving-section\">\n                        <div class=\"kpi-icon\">üöÄ</div>\n                        <div class=\"kpi-content\">\n                            <div class=\"kpi-value\" id=\"fast-moving-value\">-</div>\n                            <div class=\"kpi-label\" id=\"fast-moving-label\">Fast Moving</div>\n                            <div class=\"kpi-growth\" id=\"fast-moving-growth\">-</div>\n                        </div>\n                    </div>\n                    <div class=\"kpi-divider\"></div>\n                    <div class=\"kpi-section slow-moving-section\">\n                        <div class=\"kpi-icon\">üêå</div>\n                        <div class=\"kpi-content\">\n                            <div class=\"kpi-value\" id=\"slow-moving-value\">-</div>\n                            <div class=\"kpi-label\" id=\"slow-moving-label\">Slow Moving</div>\n                            <div class=\"kpi-growth\" id=\"slow-moving-growth\">-</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <div class=\"kpi-card clickable-card\" id=\"opportunities-card\" data-report=\"opportunity-list\">\n                <div class=\"kpi-icon\">üéØ</div>\n                <div class=\"kpi-content\">\n                    <div class=\"kpi-value\" id=\"opportunities-value\">-</div>\n                    <div class=\"kpi-label\" id=\"opportunities-label\">Converted Opportunities</div>\n                    <div class=\"kpi-growth\" id=\"opportunities-growth\">-</div>\n                </div>\n            </div>\n            \n            <div class=\"kpi-card clickable-card\" id=\"purchase-revenue-card\" data-report=\"purchase-order-trends\">\n                <div class=\"kpi-icon\">üí∏</div>\n                <div class=\"kpi-content\">\n                    <div class=\"kpi-value\" id=\"purchase-revenue-value\">-</div>\n                    <div class=\"kpi-label\" id=\"purchase-revenue-label\">Purchase Revenue</div>\n                    <div class=\"kpi-growth\" id=\"purchase-revenue-growth\">-</div>\n                </div>\n            </div>\n            \n            <div class=\"kpi-card clickable-card\" id=\"suppliers-card\" data-report=\"supplier-list\">\n                <div class=\"kpi-icon\">üè™</div>\n                <div class=\"kpi-content\">\n                    <div class=\"kpi-value\" id=\"suppliers-value\">-</div>\n                    <div class=\"kpi-label\" id=\"suppliers-label\">Active Suppliers</div>\n                    <div class=\"kpi-growth\" id=\"suppliers-growth\">-</div>\n                </div>\n            </div>\n            \n            <div class=\"kpi-card clickable-card\" id=\"sales-outstanding-card\" data-report=\"sales-invoice\">\n                <div class=\"kpi-icon\">üí∞</div>\n                <div class=\"kpi-content\">\n                    <div class=\"kpi-value\" id=\"sales-outstanding-value\">-</div>\n                    <div class=\"kpi-label\" id=\"sales-outstanding-label\">Sales Outstanding</div>\n                    <div class=\"kpi-growth\" id=\"sales-outstanding-growth\">-</div>\n                </div>\n            </div>\n            \n        </div>\n    </div>\n\n    <!-- Centralized Warehouse Items Section -->\n    <div class=\"warehouse-items-section\">\n        <div class=\"section-header\">\n            <div class=\"section-title-row\">\n                <h3 class=\"section-title\">üè¢ Centralized Warehouse Inventory</h3>\n                <span class=\"warehouse-badge\">Centralized Warehouse - UCL</span>\n            </div>\n            <div class=\"section-subtitle\">Real-time inventory tracking for centralized warehouse items</div>\n        </div>\n        \n        <div class=\"warehouse-stats-row\">\n            <div class=\"warehouse-stat-card\">\n                <div class=\"stat-icon\">üì¶</div>\n                <div class=\"stat-content\">\n                    <div class=\"stat-value\" id=\"warehouse-total-items\">-</div>\n                    <div class=\"stat-label\">Total Items</div>\n                </div>\n            </div>\n            <div class=\"warehouse-stat-card\">\n                <div class=\"stat-icon\">üí∞</div>\n                <div class=\"stat-content\">\n                    <div class=\"stat-value\" id=\"warehouse-total-value\">-</div>\n                    <div class=\"stat-label\">Total Stock Value</div>\n                </div>\n            </div>\n            <div class=\"warehouse-stat-card\">\n                <div class=\"stat-icon\">üìä</div>\n                <div class=\"stat-content\">\n                    <div class=\"stat-value\" id=\"warehouse-total-qty\">-</div>\n                    <div class=\"stat-label\">Total Quantity</div>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"warehouse-items-container\">\n            <div class=\"warehouse-items-loading\" id=\"warehouse-items-loading\">\n                <div class=\"loading-spinner\"></div>\n                <span>Loading warehouse inventory...</span>\n            </div>\n            \n            <div class=\"warehouse-items-table-wrapper\" id=\"warehouse-items-table-wrapper\" style=\"display: none;\">\n                <table class=\"warehouse-items-table\">\n                    <thead>\n                        <tr>\n                            <th>Item Code</th>\n                            <th>Item Name</th>\n                            <th>Item Group</th>\n                            <th class=\"text-right\">Quantity</th>\n                            <th class=\"text-right\">Reserved</th>\n                            <th class=\"text-right\">Available</th>\n                            <th class=\"text-right\">Value</th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"warehouse-items-tbody\">\n                    </tbody>\n                </table>\n            </div>\n            \n            <div class=\"warehouse-items-empty\" id=\"warehouse-items-empty\" style=\"display: none;\">\n                <div class=\"empty-state\">\n                    <div class=\"empty-icon\">üì¶</div>\n                    <div class=\"empty-text\">No items found in centralized warehouse</div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Batch Expiry Status Section - Expired Items Only -->\n    <div class=\"batch-expiry-section\">\n        <div class=\"section-header\">\n            <div class=\"section-title-row\">\n                <h3 class=\"section-title\">üî¥ Expired Batch Items Alert</h3>\n                <div class=\"header-actions\">\n                    <select id=\"warehouse-filter\" class=\"form-control\" style=\"width: 200px; display: inline-block; margin-right: 10px;\">\n                        <option value=\"\">All Warehouses</option>\n                    </select>\n                    <button class=\"btn btn-sm btn-default\" id=\"refresh-expired-only\" title=\"Refresh Expired Items\">\n                        <i class=\"fa fa-refresh\"></i> Refresh\n                    </button>\n                </div>\n            </div>\n            <div class=\"section-subtitle\">Critical alert - Items that have already expired and need immediate attention</div>\n        </div>\n        \n        <!-- Expired Items Summary Card -->\n        <div class=\"expired-only-stats\">\n            <div class=\"expired-alert-card\">\n                <div class=\"alert-icon\">ÔøΩ</div>\n                <div class=\"alert-content\">\n                    <div class=\"alert-value\" id=\"expired-count\">-</div>\n                    <div class=\"alert-label\">Expired Items Requiring Action</div>\n                    <div class=\"alert-description\">Items that have passed their expiry date</div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- Expired Items Table -->\n        <div class=\"expired-items-container\">\n            <div class=\"expired-items-header\">\n                <h4>Critical Expired Items (Scrollable List)</h4>\n                <div class=\"expired-actions\">\n                    <span class=\"expired-count-badge\" id=\"expired-items-badge\">0 items</span>\n                </div>\n            </div>\n            \n            <div class=\"batch-items-loading\" id=\"batch-items-loading\">\n                <div class=\"loading-spinner\"></div>\n                <div class=\"loading-text\">Loading expired items...</div>\n            </div>\n            \n            <div class=\"batch-items-table-wrapper\" id=\"batch-items-table-wrapper\" style=\"display: none;\">\n                <table class=\"table table-bordered batch-items-table\">\n                    <thead>\n                        <tr>\n                            <th>Item Code</th>\n                            <th>Item Name</th>\n                            <th>Stock UOM</th>\n                            <th>Batch No.</th>\n                            <th>Available Qty</th>\n                            <th>Warehouse</th>\n                            <th>Expires On</th>\n                            <th>Days Overdue</th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"batch-items-tbody\">\n                        <!-- Batch items will be populated here -->\n                    </tbody>\n                </table>\n            </div>\n            \n            <div class=\"batch-items-empty\" id=\"batch-items-empty\" style=\"display: none;\">\n                <div class=\"empty-state\">\n                    <div class=\"empty-icon\">üì¶</div>\n                    <div class=\"empty-text\">No batch items found with expiry dates</div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Performance Charts Section -->  \n    <div class=\"executive-dashboard-charts\">\n        <div class=\"charts-header\">\n            <h3 class=\"charts-title\">üìä Performance Analytics</h3>\n            <div class=\"charts-controls\">\n                <select id=\"charts-branch-selector\" class=\"form-control\" style=\"width: 180px; display: inline-block; margin-right: 10px;\">\n                    <option value=\"\">All Branches</option>\n                </select>\n                <button class=\"btn btn-primary btn-sm\" id=\"refresh-charts\">\n                    <i class=\"fa fa-refresh\"></i> Refresh\n                </button>\n            </div>\n        </div>\n        \n        <div class=\"charts-grid\">\n            <div class=\"chart-card sales-trends-chart\">\n                <div class=\"chart-header\">\n                    <div class=\"chart-icon\">üìà</div>\n                    <div class=\"chart-title\">Sales Trends</div>\n                </div>\n                <div class=\"chart-container\" id=\"sales-trends-chart-container\">\n                    <div class=\"chart-loading\">Loading chart...</div>\n                </div>\n            </div>\n            \n            <div class=\"chart-card sales-chart\">\n                <div class=\"chart-header\">\n                    <div class=\"chart-icon\">üí∞</div>\n                    <div class=\"chart-title\">Sales Performance</div>\n                </div>\n                <div class=\"chart-container\" id=\"sales-chart-container\">\n                    <div class=\"chart-loading\">Loading chart...</div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n",
  "modified": "2026-01-28 19:55:32.643133",
  "name": "Unicom Dashboard",
  "private": 0,
  "roles": [],
  "script": "// Pharmacy Dashboard JavaScript - Unicom Chemist\n// Complete implementation for pharmacy business\n\n// Global variables\nlet dashboardData = {};\nlet chartInstances = {};\n\n// Initialize dashboard when DOM is loaded\n$(document).ready(function() {\n    console.log('Initializing Pharmacy Dashboard for Unicom Chemist');\n    initializeDashboard();\n});\n\n// Main initialization function\nfunction initializeDashboard() {\n    // Load Chart.js if not already loaded\n    if (typeof Chart === 'undefined') {\n        loadChartJS();\n    }\n    \n    // Initialize components with proper timing\n    setTimeout(() => {\n        loadBranches();\n        bindEventHandlers();\n        updatePeriodLabels();\n        loadDashboardData();\n        loadCentralizedWarehouseItems();\n        loadWarehouses();\n        loadExpiredItemsOnly();\n    }, 200);\n    \n    console.log('Pharmacy Dashboard initialized successfully');\n}\n\n// Function to open Sales Invoice Report with filters\nfunction openSalesInvoiceReport(cardId) {\n    console.log('Opening Sales Invoice Report for card:', cardId);\n    \n    // Get current dashboard filters\n    const selectedPeriod = $(root_element).find('#period-selector').val() || $('#period-selector').val() || 'monthly';\n    const selectedBranch = $(root_element).find('#branch-selector').val() || $('#branch-selector').val() || '';\n    \n    console.log('Current filters - Period:', selectedPeriod, 'Branch:', selectedBranch);\n    \n    // Calculate date range based on period\n    const dateRange = calculateDateRange(selectedPeriod);\n    \n    // Prepare filters for the report\n    const reportFilters = {\n        company: frappe.defaults.get_user_default(\"Company\") || \"Ascra Pharma\",\n        from_date: dateRange.from_date,\n        to_date: dateRange.to_date\n    };\n    \n    // Add branch filter if selected\n    if (selectedBranch) {\n        reportFilters.branch = selectedBranch;\n    }\n    \n    // Add specific filters based on card type\n    if (cardId === 'sales-outstanding-card') {\n        // For outstanding card, show only overdue invoices\n        reportFilters.status = 'Overdue';\n    }\n    \n    console.log('Opening report with filters:', reportFilters);\n    \n    // Navigate to the Sales Invoice Report\n    frappe.set_route('query-report', 'Sales Invoice Report UCL', reportFilters);\n}\n\n// Generic function to open reports/doctypes based on card type\nfunction openCardReport(cardId, reportType) {\n    console.log('Opening report for card:', cardId, 'Type:', reportType);\n    \n    // Get current dashboard filters\n    const selectedPeriod = $(root_element).find('#period-selector').val() || $('#period-selector').val() || 'monthly';\n    const selectedBranch = $(root_element).find('#branch-selector').val() || $('#branch-selector').val() || '';\n    \n    switch (reportType) {\n        case 'sales-invoice':\n            openSalesInvoiceReport(cardId);\n            break;\n            \n        case 'stock-balance':\n            // Open UCL Stock Balance report\n            const stockFilters = {\n                company: frappe.defaults.get_user_default(\"Company\") || \"Ascra Pharma\"\n            };\n            if (selectedBranch) {\n                stockFilters.warehouse = selectedBranch;\n            }\n            frappe.set_route('query-report', 'UCL Stock Balance', stockFilters);\n            break;\n            \n        case 'customer-list':\n            // Open Customer doctype list view\n            const customerFilters = {};\n            if (selectedBranch) {\n                customerFilters.territory = selectedBranch;\n            }\n            frappe.set_route('List', 'Customer', customerFilters);\n            break;\n            \n        case 'opportunity-list':\n            // Open Opportunity doctype list view\n            const dateRange = calculateDateRange(selectedPeriod);\n            const opportunityFilters = {\n                creation: ['between', [dateRange.from_date, dateRange.to_date]]\n            };\n            frappe.set_route('List', 'Opportunity', opportunityFilters);\n            break;\n            \n        case 'purchase-order-trends':\n            // Open Purchase Order Trends report\n            const purchaseRange = calculateDateRange(selectedPeriod);\n            const purchaseFilters = {\n                company: frappe.defaults.get_user_default(\"Company\") || \"Ascra Pharma\",\n                from_date: purchaseRange.from_date,\n                to_date: purchaseRange.to_date\n            };\n            frappe.set_route('query-report', 'Purchase Order Trends', purchaseFilters);\n            break;\n            \n        case 'supplier-list':\n            // Open Supplier doctype list view\n            const supplierFilters = {\n                disabled: 0\n            };\n            frappe.set_route('List', 'Supplier', supplierFilters);\n            break;\n            \n        default:\n            console.warn('Unknown report type:', reportType);\n            frappe.msgprint('Report not configured for this card');\n    }\n}\n\n// Function to calculate date range based on period\nfunction calculateDateRange(period) {\n    const today = new Date();\n    let fromDate, toDate;\n    \n    switch (period) {\n        case 'daily':\n            fromDate = new Date(today);\n            toDate = new Date(today);\n            break;\n            \n        case 'monthly':\n            fromDate = new Date(today.getFullYear(), today.getMonth(), 1);\n            toDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);\n            break;\n            \n        case 'quarterly':\n            const currentQuarter = Math.floor(today.getMonth() / 3);\n            fromDate = new Date(today.getFullYear(), currentQuarter * 3, 1);\n            toDate = new Date(today.getFullYear(), (currentQuarter + 1) * 3, 0);\n            break;\n            \n        case 'yearly':\n            fromDate = new Date(today.getFullYear(), 0, 1);\n            toDate = new Date(today.getFullYear(), 11, 31);\n            break;\n            \n        default:\n            // Default to monthly\n            fromDate = new Date(today.getFullYear(), today.getMonth(), 1);\n            toDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);\n    }\n    \n    // Format dates as YYYY-MM-DD for ERPNext\n    const formatDate = (date) => {\n        return date.getFullYear() + '-' + \n               String(date.getMonth() + 1).padStart(2, '0') + '-' + \n               String(date.getDate()).padStart(2, '0');\n    };\n    \n    return {\n        from_date: formatDate(fromDate),\n        to_date: formatDate(toDate)\n    };\n}\n\n// Load Chart.js library dynamically\nfunction loadChartJS() {\n    const script = document.createElement('script');\n    script.src = 'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js';\n    script.onload = function() {\n        console.log('Chart.js loaded successfully');\n        setTimeout(() => {\n            loadChartsData();\n        }, 500);\n    };\n    script.onerror = function() {\n        console.error('Failed to load Chart.js');\n    };\n    document.head.appendChild(script);\n}\n\n// Load branches for dropdown\nfunction loadBranches() {\n    console.log('Loading branches from Branch doctype...');\n    \n    // Load all branches from Branch doctype\n    frappe.call({\n        method: 'frappe.client.get_list',\n        args: {\n            doctype: 'Branch',\n            fields: ['name', 'branch'],\n            filters: {},\n            order_by: 'branch asc',\n            limit_page_length: 0\n        },\n        callback: function(response) {\n            console.log('Branches loaded from Branch doctype:', response.message?.length || 0, 'records');\n            if (response.message && response.message.length > 0) {\n                // Convert to branch list for dropdown\n                const branches = response.message.map(b => ({\n                    name: b.name,\n                    warehouse_name: b.branch || b.name\n                }));\n                \n                console.log('Total branches:', branches.length);\n                console.log('Sample branches:', branches.slice(0, 5).map(b => b.warehouse_name));\n                populateBranchDropdowns(branches);\n            } else {\n                console.log('No branches found, using demo branches');\n                populateBranchDropdowns(getDemoBranches());\n            }\n        },\n        error: function(error) {\n            console.error('Error loading branches:', error);\n            console.log('Using demo branches due to error');\n            populateBranchDropdowns(getDemoBranches());\n        }\n    });\n}\n\n// Get demo branches for fallback\nfunction getDemoBranches() {\n    return [\n        {name: 'main-store', warehouse_name: 'Main Store'},\n        {name: 'north-branch', warehouse_name: 'North Branch'},\n        {name: 'south-branch', warehouse_name: 'South Branch'},\n        {name: 'east-branch', warehouse_name: 'East Branch'},\n        {name: 'west-branch', warehouse_name: 'West Branch'}\n    ];\n}\n\n// Populate branch dropdown options\nfunction populateBranchDropdowns(branches) {\n    console.log('Populating branch dropdowns with:', branches);\n    const branchSelectors = ['#branch-selector', '#charts-branch-selector'];\n    \n    // Use setTimeout to ensure DOM is ready\n    setTimeout(() => {\n        branchSelectors.forEach(selector => {\n            // Use root_element for custom HTML block context\n            const dropdown = $(root_element).find(selector);\n            console.log(`Found dropdown ${selector}:`, dropdown.length > 0);\n            \n            if (dropdown.length > 0) {\n                // Clear existing options\n                dropdown.empty();\n                dropdown.append('<option value=\"\">All Branches</option>');\n                \n                // Add branch options\n                branches.forEach(branch => {\n                    const displayName = branch.warehouse_name || branch.name;\n                    const option = `<option value=\"${branch.name}\">${displayName}</option>`;\n                    dropdown.append(option);\n                    console.log(`Added branch option: ${displayName} (${branch.name})`);\n                });\n                \n                // Force refresh of the dropdown\n                dropdown.trigger('change');\n                console.log(`Dropdown ${selector} now has ${dropdown.find('option').length} options`);\n            } else {\n                console.error(`Dropdown ${selector} not found in DOM`);\n                // Try to find all select elements for debugging\n                console.log('Available select elements:', $(root_element).find('select').map(function() { return this.id; }).get());\n            }\n        });\n    }, 100);\n}\n\n// Bind event handlers\nfunction bindEventHandlers() {\n    // Use root_element for custom HTML block context\n    // Period selector change\n    $(root_element).find('#period-selector').change(function() {\n        console.log('=== PERIOD CHANGED ===');\n        console.log('Period changed to:', $(this).val());\n        updatePeriodLabels();\n        loadDashboardData();\n    });\n    \n    // Also try global selector for period change\n    $('#period-selector').change(function() {\n        console.log('=== PERIOD CHANGED (GLOBAL) ===');\n        console.log('Period changed (global) to:', $(this).val());\n        updatePeriodLabels();\n        loadDashboardData();\n    });\n    \n    // Refresh buttons\n    $(root_element).find('#refresh-dashboard').click(function() {\n        console.log('Refreshing dashboard data...');\n        loadDashboardData();\n    });\n    \n    $(root_element).find('#refresh-charts').click(function() {\n        console.log('Refreshing charts data...');\n        loadChartsData();\n    });\n    \n    // Filter changes - Fix: use #period-selector not #period-filter\n    $(root_element).find('#period-selector, #branch-selector').change(function() {\n        console.log('=== FILTER CHANGED (root_element) ===');\n        loadDashboardData();\n    });\n    \n    // Also bind to global selectors as fallback\n    $('#period-selector, #branch-selector').change(function() {\n        console.log('=== FILTER CHANGED (global) ===');\n        loadDashboardData();\n    });\n    \n    // Add click handlers for clickable KPI cards\n    $(root_element).find('.clickable-card').click(function() {\n        const reportType = $(this).data('report');\n        const cardId = $(this).attr('id');\n        console.log('Clicked card:', cardId, 'Report type:', reportType);\n        \n        openCardReport(cardId, reportType);\n    });\n    \n    // Also bind to global clickable cards as fallback\n    $('.clickable-card').click(function() {\n        const reportType = $(this).data('report');\n        const cardId = $(this).attr('id');\n        console.log('Clicked card (global):', cardId, 'Report type:', reportType);\n        \n        openCardReport(cardId, reportType);\n    });\n    \n    $(root_element).find('#charts-branch-selector').change(function() {\n        console.log('=== CHARTS BRANCH FILTER CHANGED ===');\n        console.log('Selected branch:', $(this).val());\n        loadChartsData();\n    });\n    \n    // Also bind to global selector as fallback\n    $('#charts-branch-selector').change(function() {\n        console.log('=== CHARTS BRANCH FILTER CHANGED (GLOBAL) ===');\n        console.log('Selected branch:', $(this).val());\n        loadChartsData();\n    });\n    \n    // Expired items only event handlers\n    $(root_element).find('#refresh-expired-only').click(function() {\n        console.log('Refreshing expired items only...');\n        loadExpiredItemsOnly();\n    });\n    \n    $(root_element).find('#warehouse-filter').change(function() {\n        console.log('Warehouse filter changed, refreshing expired items...');\n        loadExpiredItemsOnly();\n    });\n    \n    // Global event handlers\n    $('#refresh-expired-only').click(function() {\n        loadExpiredItemsOnly();\n    });\n    \n    $('#warehouse-filter').change(function() {\n        loadExpiredItemsOnly();\n    });\n}\n\n// Load main dashboard KPI data\nfunction loadDashboardData() {\n    showLoadingState();\n    \n    // Fix: HTML uses #period-selector, not #period-filter\n    const period = $(root_element).find('#period-selector').val() || $('#period-selector').val() || 'monthly';\n    const branch = $(root_element).find('#branch-selector').val() || $('#branch-selector').val() || '';\n    \n    console.log('=== LOADING DASHBOARD DATA ===');\n    console.log('Period:', period, 'Branch:', branch);\n    \n    // Get date range for the selected period\n    const dateRange = getDateRange(period);\n    console.log('Calculated date range:', dateRange);\n    \n    // Load pharmacy data using standard ERPNext APIs\n    loadPharmacyKPIData(dateRange, branch);\n}\n\n// Update KPI cards with data\nfunction updateKPICards(data) {\n    console.log('Updating KPI cards with data:', data);\n    \n    // Update prescription card\n    updateKPICard('prescription', data.prescriptions || { value: 0, growth: 0 });\n    \n    // Update sales card\n    updateKPICard('sales', data.sales || { value: 0, growth: 0 });\n    \n    // Update inventory card\n    updateKPICard('inventory', data.inventory || { value: 0, growth: 0 });\n    \n    \n    // Update customer card\n    updateKPICard('customer', data.customers || { value: 0, growth: 0 });\n    \n    // Update fast moving item card\n    updateKPICard('fast-moving', data.fast_moving || { value: '-', growth: 0 });\n    \n    // Update slow moving item card\n    updateKPICard('slow-moving', data.slow_moving || { value: '-', growth: 0 });\n    \n    // Update opportunities card\n    updateKPICard('opportunities', data.opportunities || { value: 0, growth: 0 });\n    \n    // Update purchase revenue card\n    console.log('=== UPDATING PURCHASE REVENUE CARD ===');\n    console.log('Purchase revenue data:', data.purchase_revenue);\n    updateKPICard('purchase-revenue', data.purchase_revenue || { value: 0, growth: 0 });\n    \n    // Update suppliers card\n    updateKPICard('suppliers', data.suppliers || { value: 0, growth: 0 });\n    \n    // Update sales outstanding card\n    updateKPICard('sales-outstanding', data.sales_outstanding || { value: 0, growth: 0 });\n    \n    // Update period labels dynamically\n    updatePeriodLabels();\n}\n\n// Update period labels based on selected filter\nfunction updatePeriodLabels() {\n    // Try multiple selectors to find the period selector\n    const periodSelector = $(root_element).find('#period-selector');\n    const fallbackSelector = $('#period-selector');\n    \n    const selectedPeriod = periodSelector.val() || fallbackSelector.val() || 'monthly';\n    \n    console.log('Period selector found:', periodSelector.length > 0);\n    console.log('Selected period:', selectedPeriod);\n    \n    let periodLabel;\n    switch(selectedPeriod.toLowerCase()) {\n        case 'daily':\n            periodLabel = 'Daily';\n            break;\n        case 'quarterly':\n            periodLabel = 'Quarterly';\n            break;\n        case 'yearly':\n            periodLabel = 'Yearly';\n            break;\n        case 'monthly':\n        default:\n            periodLabel = 'Monthly';\n            break;\n    }\n    \n    // Update all period-dependent labels with multiple approaches\n    const labels = [\n        { id: '#prescription-label', text: `${periodLabel} Invoices` },\n        { id: '#sales-label', text: `${periodLabel} Sales` },\n        { id: '#customer-label', text: `${periodLabel} Customers` }\n    ];\n    \n    labels.forEach(label => {\n        // Try root_element context first\n        const el = $(root_element).find(label.id);\n        if (el.length > 0) {\n            el.text(label.text);\n            console.log(`Updated ${label.id} to: ${label.text}`);\n        } else {\n            // Fallback to global selector\n            const fallbackEl = $(label.id);\n            if (fallbackEl.length > 0) {\n                fallbackEl.text(label.text);\n                console.log(`Updated ${label.id} (fallback) to: ${label.text}`);\n            } else {\n                console.log(`Could not find ${label.id}`);\n            }\n        }\n    });\n    \n    console.log(`Period labels updated to: ${periodLabel}`);\n}\n\n// Update individual KPI card\nfunction updateKPICard(cardType, data) {\n    console.log(`Updating KPI card: ${cardType}`, data);\n    \n    // Use root_element for custom HTML block context\n    const valueEl = $(root_element).find(`#${cardType}-value`);\n    const growthEl = $(root_element).find(`#${cardType}-growth`);\n    const valueElVanilla = root_element.querySelector(`#${cardType}-value`);\n    const growthElVanilla = root_element.querySelector(`#${cardType}-growth`);\n    \n    console.log(`Found elements for ${cardType}: jQuery value=${valueEl.length}, growth=${growthEl.length}`);\n    console.log(`Found elements for ${cardType}: Vanilla value=${!!valueElVanilla}, growth=${!!growthElVanilla}`);\n    \n    if (valueEl.length > 0 || valueElVanilla) {\n        let displayValue = data.value || 0;\n        \n        // Format value based on card type\n        let formattedValue;\n        if (cardType === 'sales' || cardType === 'revenue' || cardType === 'purchase-revenue' || cardType === 'sales-outstanding') {\n            formattedValue = `GH‚Çµ${displayValue.toLocaleString()}`;\n        } else if (cardType === 'fast-moving' || cardType === 'slow-moving') {\n            // For item names, don't format as numbers\n            formattedValue = displayValue;\n        } else {\n            formattedValue = displayValue.toLocaleString();\n        }\n        \n        console.log(`Setting ${cardType} value to:`, formattedValue);\n        \n        // Update using both methods to ensure it works\n        if (valueEl.length > 0) {\n            valueEl.text(formattedValue);\n            valueEl.removeClass('loading');\n            valueEl.css('color', '#1f2937'); // Ensure text is visible\n        }\n        \n        if (valueElVanilla) {\n            valueElVanilla.textContent = formattedValue;\n            valueElVanilla.style.color = '#1f2937';\n        }\n        \n        // Force visual update\n        setTimeout(() => {\n            const currentValue = valueEl.length > 0 ? valueEl.text() : valueElVanilla?.textContent;\n            console.log(`Verified ${cardType} value is now:`, currentValue);\n        }, 50);\n        \n    } else {\n        console.error(`Value element not found for ${cardType}: #${cardType}-value`);\n        // Try to find all elements with similar IDs for debugging\n        console.log('Available value elements:', $(root_element).find('[id$=\"-value\"]').map(function() { return this.id; }).get());\n    }\n    \n    if (growthEl.length > 0 || growthElVanilla) {\n        const growth = parseFloat(data.growth || 0);\n        const formattedGrowth = formatGrowth(growth);\n        console.log(`Setting ${cardType} growth to:`, formattedGrowth);\n        \n        // Update using both methods\n        if (growthEl.length > 0) {\n            growthEl.html(formattedGrowth);\n        }\n        \n        if (growthElVanilla) {\n            growthElVanilla.innerHTML = formattedGrowth;\n        }\n    } else {\n        console.error(`Growth element not found for ${cardType}: #${cardType}-growth`);\n        console.log('Available growth elements:', $(root_element).find('[id$=\"-growth\"]').map(function() { return this.id; }).get());\n    }\n}\n\n// Load charts data\nfunction loadChartsData() {\n    const branch = $(root_element).find('#charts-branch-selector').val() || $('#charts-branch-selector').val() || '';\n    \n    console.log('=== LOADING CHARTS DATA ===');\n    console.log('Branch:', branch || 'All branches');\n    \n    // Get date range for charts (use yearly for full year view)\n    const dateRange = getDateRange('yearly');\n    console.log('Date range for charts:', dateRange);\n    \n    // Load charts data using standard ERPNext APIs\n    loadPharmacyChartsData(dateRange, branch);\n}\n\n// Update charts with data\nfunction updateCharts(data) {\n    console.log('Updating charts with data:', data);\n    \n    // Update sales trends chart\n    updateSalesTrendsChart(data.salesTrends || getDemoSalesTrendsData());\n    \n    // Update sales performance chart\n    updateSalesChart(data.sales || getDemoChartsData().sales);\n}\n\n// Update sales performance chart\nfunction updateSalesChart(data) {\n    const container = root_element.querySelector('#sales-chart-container');\n    if (!container) {\n        console.log('Sales chart container not found');\n        return;\n    }\n    \n    console.log('=== UPDATING SALES PERFORMANCE CHART ===');\n    console.log('Chart data received:', data);\n    \n    // Destroy existing chart\n    if (chartInstances.salesChart) {\n        chartInstances.salesChart.destroy();\n    }\n    \n    // Clear container and create canvas\n    container.innerHTML = '<canvas></canvas>';\n    const canvas = container.querySelector('canvas');\n    \n    if (typeof Chart !== 'undefined') {\n        try {\n            // Use the datasets from processSalesPerformanceData, not hardcoded values\n            chartInstances.salesChart = new Chart(canvas, {\n                type: 'bar',\n                data: {\n                    labels: data.labels || [],\n                    datasets: data.datasets || [{\n                        label: 'Monthly Revenue (GH‚Çµ)',\n                        data: [],\n                        backgroundColor: '#22c55e',\n                        borderColor: '#16a34a',\n                        borderWidth: 1\n                    }]\n                },\n                options: {\n                    responsive: true,\n                    maintainAspectRatio: false,\n                    plugins: {\n                        legend: {\n                            display: false\n                        }\n                    },\n                    scales: {\n                        y: {\n                            beginAtZero: true,\n                            grid: {\n                                color: 'rgba(0, 0, 0, 0.1)'\n                            },\n                            ticks: {\n                                callback: function(value) {\n                                    return 'GH‚Çµ' + value.toLocaleString();\n                                }\n                            }\n                        },\n                        x: {\n                            grid: {\n                                display: false\n                            }\n                        }\n                    }\n                }\n            });\n            console.log('Sales chart created successfully');\n        } catch (error) {\n            console.error('Error creating sales chart:', error);\n            container.innerHTML = '<div class=\"chart-error\">Error loading chart</div>';\n        }\n    } else {\n        container.innerHTML = '<div class=\"chart-loading\">Loading Chart.js...</div>';\n    }\n}\n\n// Utility functions\nfunction formatCurrency(amount) {\n    const num = parseFloat(amount) || 0;\n    return 'GH‚Çµ' + num.toLocaleString('en-GH', {\n        minimumFractionDigits: 2,\n        maximumFractionDigits: 2\n    });\n}\n\nfunction formatNumber(num) {\n    return parseFloat(num || 0).toLocaleString('en-IN');\n}\n\nfunction formatGrowth(growth) {\n    const value = parseFloat(growth) || 0;\n    const sign = value >= 0 ? '+' : '';\n    const color = value >= 0 ? '#16a34a' : '#dc2626';\n    const icon = value >= 0 ? 'üìà' : 'üìâ';\n    return `<span style=\"color: ${color}\">${icon} ${sign}${value.toFixed(1)}%</span>`;\n}\n\nfunction showLoadingState() {\n    console.log('Showing loading state...');\n    $(root_element).find('.kpi-card').addClass('loading');\n    $(root_element).find('.kpi-value').text('...');\n    $(root_element).find('.kpi-growth').html('<span style=\"color: #6b7280\">...</span>');\n}\n\nfunction hideLoadingState() {\n    console.log('Hiding loading state...');\n    $(root_element).find('.kpi-card').removeClass('loading');\n    \n    // Force DOM update\n    setTimeout(() => {\n        $(root_element).find('.kpi-value').each(function() {\n            if ($(this).text() === '...' || $(this).text() === '-') {\n                console.log('Found element still showing loading:', $(this).attr('id'));\n            }\n        });\n    }, 100);\n}\n\n// Get date range based on period\nfunction getDateRange(period) {\n    const today = frappe.datetime.get_today();\n    let fromDate = today;\n    \n    switch(period) {\n        case 'daily':\n            fromDate = today;\n            break;\n        case 'monthly':\n            fromDate = frappe.datetime.add_months(today, -1);\n            break;\n        case 'quarterly':\n            fromDate = frappe.datetime.add_months(today, -3);\n            break;\n        case 'yearly':\n            fromDate = frappe.datetime.add_months(today, -12);\n            break;\n        default:\n            fromDate = frappe.datetime.add_months(today, -1);\n    }\n    \n    return {\n        from_date: fromDate,\n        to_date: today\n    };\n}\n\n// Load pharmacy KPI data using ERPNext APIs\nfunction loadPharmacyKPIData(dateRange, branch) {\n    // Load data in parallel\n    const promises = [\n        loadSalesData(dateRange, branch),\n        loadStockData(dateRange, branch),\n        loadCustomerData(dateRange, branch),\n        loadItemMovementData(dateRange, branch),\n        loadOpportunitiesData(dateRange, branch),\n        loadPurchaseRevenueData(dateRange, branch),\n        loadSuppliersData(dateRange, branch),\n        loadSalesOutstandingData(dateRange, branch)\n    ];\n    \n    Promise.allSettled(promises).then(results => {\n        const dashboardData = compileDashboardData(results);\n        updateKPICards(dashboardData);\n        hideLoadingState();\n    }).catch(error => {\n        console.error('Error loading dashboard data:', error);\n        updateKPICards(getDemoKPIData());\n        hideLoadingState();\n    });\n}\n\n// Load sales data from Sales Invoice\nfunction loadSalesData(dateRange, branch) {\n    return new Promise((resolve, reject) => {\n        console.log('Loading sales data for date range:', dateRange, 'branch:', branch);\n        \n        const filters = {\n            'posting_date': ['between', [dateRange.from_date, dateRange.to_date]],\n            'docstatus': 1\n        };\n        \n        // If branch is selected, get warehouses for that branch\n        if (branch) {\n            // First get warehouses for the selected branch\n            frappe.call({\n                method: 'frappe.client.get_list',\n                args: {\n                    doctype: 'Warehouse',\n                    fields: ['name'],\n                    filters: {\n                        'custom_branch': branch,\n                        'disabled': 0\n                    }\n                },\n                callback: function(warehouseResponse) {\n                    const warehouses = warehouseResponse.message || [];\n                    if (warehouses.length > 0) {\n                        const warehouseNames = warehouses.map(w => w.name);\n                        filters['set_warehouse'] = ['in', warehouseNames];\n                    }\n                    \n                    // Load sales invoices with warehouse filter\n                    loadSalesInvoices(filters, resolve);\n                },\n                error: function(error) {\n                    console.error('Error loading warehouses for branch:', error);\n                    loadSalesInvoices(filters, resolve);\n                }\n            });\n        } else {\n            loadSalesInvoices(filters, resolve);\n        }\n    });\n}\n\n// Helper function to load sales invoices\nfunction loadSalesInvoices(filters, resolve) {\n    frappe.call({\n        method: 'frappe.client.get_list',\n        args: {\n            doctype: 'Sales Invoice',\n            fields: ['name', 'grand_total', 'posting_date', 'customer', 'set_warehouse'],\n            filters: filters,\n            limit_page_length: 1000\n        },\n        callback: function(response) {\n            console.log('Sales data loaded:', response.message?.length || 0, 'records');\n            resolve(response.message || []);\n        },\n        error: function(error) {\n            console.error('Error loading sales data:', error);\n            resolve([]);\n        }\n    });\n}\n\n// Load stock data using Bin doctype - shows ALL items in inventory\nfunction loadStockData(dateRange, branch) {\n    return new Promise((resolve, reject) => {\n        console.log('Loading inventory data from Bin...');\n        \n        const filters = {\n            'actual_qty': ['>', 0]  // Only items with positive stock\n        };\n        \n        // If branch is specified, filter by warehouse\n        if (branch) {\n            filters['warehouse'] = ['like', `%${branch}%`];\n        }\n        \n        frappe.call({\n            method: 'frappe.client.get_list',\n            args: {\n                doctype: 'Bin',\n                fields: ['item_code', 'warehouse', 'actual_qty', 'stock_value', 'valuation_rate'],\n                filters: filters,\n                limit_page_length: 0  // Get all items\n            },\n            callback: function(response) {\n                const binData = response.message || [];\n                console.log('Bin data loaded:', binData.length, 'bin records');\n                \n                // Get unique item count\n                const uniqueItems = [...new Set(binData.map(bin => bin.item_code))];\n                console.log('Unique items in inventory:', uniqueItems.length);\n                \n                // Calculate totals\n                const totalQty = binData.reduce((sum, bin) => sum + (bin.actual_qty || 0), 0);\n                const totalValue = binData.reduce((sum, bin) => sum + (bin.stock_value || 0), 0);\n                \n                console.log('Total inventory quantity:', totalQty);\n                console.log('Total inventory value:', totalValue);\n                \n                // Return bin data (compileDashboardData expects array with item_code)\n                resolve(binData);\n            },\n            error: function(error) {\n                console.error('Error loading inventory data:', error);\n                resolve([]);\n            }\n        });\n    });\n}\n\n// Load customer data\nfunction loadCustomerData(dateRange, branch) {\n    return new Promise((resolve, reject) => {\n        const filters = {\n            'creation': ['between', [dateRange.from_date, dateRange.to_date]]\n        };\n        \n        frappe.call({\n            method: 'frappe.client.get_list',\n            args: {\n                doctype: 'Customer',\n                fields: ['name', 'creation'],\n                filters: filters,\n                limit_page_length: 1000\n            },\n            callback: function(response) {\n                resolve(response.message || []);\n            },\n            error: function(error) {\n                console.error('Error loading customer data:', error);\n                resolve([]);\n            }\n        });\n    });\n}\n\n// Load expiry data from Batch\nfunction loadExpiryData(branch) {\n    return new Promise((resolve, reject) => {\n        const today = frappe.datetime.get_today();\n        const nearExpiryDate = frappe.datetime.add_days(today, 30);\n        \n        const filters = {\n            'expiry_date': ['<=', nearExpiryDate],\n            'disabled': 0\n        };\n        \n        frappe.call({\n            method: 'frappe.client.get_list',\n            args: {\n                doctype: 'Batch',\n                fields: ['name', 'expiry_date', 'item'],\n                filters: filters,\n                limit_page_length: 1000\n            },\n            callback: function(response) {\n                resolve(response.message || []);\n            },\n            error: function(error) {\n                console.error('Error loading expiry data:', error);\n                resolve([]);\n            }\n        });\n    });\n}\n\n// Load Item Movement Data - wrapper function for item movement analysis\nfunction loadItemMovementData(dateRange, branch) {\n    return loadItemMovementAnalysis(dateRange, branch);\n}\n\n// Load Item Movement Analysis - Fast and Slow Moving Items\nfunction loadItemMovementAnalysis(dateRange, branch) {\n    return new Promise((resolve, reject) => {\n        console.log('=== STARTING REAL ITEM MOVEMENT ANALYSIS ===');\n        console.log('Date range:', dateRange, 'Branch:', branch);\n        \n        // Step 1: Get PAID Sales Invoices with filters\n        const filters = {\n            'posting_date': ['between', [dateRange.from_date, dateRange.to_date]],\n            'docstatus': 1,\n            'status': 'Paid'\n        };\n        \n        if (branch) {\n            filters['branch'] = branch;\n        }\n        \n        // Skip the Sales Analytics approach and go directly to item loading\n        console.log('Using direct item loading approach...');\n        loadItemsDirectly(filters, resolve);\n    });\n}\n\n// Helper function to load items directly from Sales Invoices\nfunction loadItemsDirectly(filters, resolve) {\n    console.log('Loading items directly from Sales Invoices...');\n    \n    // Get all paid invoices first\n    frappe.call({\n        method: 'frappe.client.get_list',\n        args: {\n            doctype: 'Sales Invoice',\n            fields: ['name'],\n            filters: filters,\n            limit_page_length: 100\n        },\n        callback: function(response) {\n            const invoices = response.message || [];\n            console.log('Found', invoices.length, 'paid invoices');\n            \n            if (invoices.length === 0) {\n                resolve({ fast_moving: null, slow_moving: null });\n                return;\n            }\n            \n            // Now get items from each invoice using a batch approach\n            const invoiceNames = invoices.map(inv => inv.name);\n            console.log('Getting items from invoices:', invoiceNames);\n            \n            // Use frappe.call to execute a server-side method that can access child tables\n            frappe.call({\n                method: 'frappe.client.get_list',\n                args: {\n                    doctype: 'Sales Invoice',\n                    fields: ['name', 'items'],\n                    filters: {\n                        'name': ['in', invoiceNames]\n                    },\n                    limit_page_length: 100\n                },\n                callback: function(docResponse) {\n                    console.log('Invoice documents response:', docResponse);\n                    \n                    // Try to get items using individual invoice document fetching\n                    console.log('Attempting to fetch individual invoice documents...');\n                    \n                    let allItems = [];\n                    let processedCount = 0;\n                    \n                    if (invoiceNames.length === 0) {\n                        resolve({ fast_moving: null, slow_moving: null });\n                        return;\n                    }\n                    \n                    // Process each invoice individually to get items\n                    invoiceNames.forEach(invoiceName => {\n                        frappe.call({\n                            method: 'frappe.client.get',\n                            args: {\n                                doctype: 'Sales Invoice',\n                                name: invoiceName\n                            },\n                            callback: function(singleDocResponse) {\n                                const doc = singleDocResponse.message;\n                                \n                                if (doc && doc.items && Array.isArray(doc.items)) {\n                                    doc.items.forEach(item => {\n                                        if (item.item_code && item.item_name) {\n                                            allItems.push({\n                                                item_code: item.item_code,\n                                                item_name: item.item_name,\n                                                qty: parseFloat(item.qty) || 0\n                                            });\n                                        }\n                                    });\n                                }\n                                \n                                processedCount++;\n                                \n                                // When all invoices are processed\n                                if (processedCount === invoiceNames.length) {\n                                    console.log('All invoices processed. Total items:', allItems.length);\n                                    \n                                    if (allItems.length === 0) {\n                                        resolve({ fast_moving: null, slow_moving: null });\n                                        return;\n                                    }\n                                    \n                                    // Perform the real analysis\n                                    const analysis = analyzeItemMovement(allItems);\n                                    resolve(analysis);\n                                }\n                            },\n                            error: function(singleDocError) {\n                                console.error('Error fetching invoice:', invoiceName, singleDocError);\n                                processedCount++;\n                                \n                                // Continue even if some invoices fail\n                                if (processedCount === invoiceNames.length) {\n                                    if (allItems.length === 0) {\n                                        resolve({ fast_moving: null, slow_moving: null });\n                                        return;\n                                    }\n                                    \n                                    const analysis = analyzeItemMovement(allItems);\n                                    resolve(analysis);\n                                }\n                            }\n                        });\n                    });\n                },\n                error: function(error) {\n                    console.error('Error getting invoice documents:', error);\n                    resolve({ fast_moving: null, slow_moving: null });\n                }\n            });\n        },\n        error: function(error) {\n            console.error('Error getting invoices:', error);\n            resolve({ fast_moving: null, slow_moving: null });\n        }\n    });\n}\n\n// Analyze item movement based on your logic\nfunction analyzeItemMovement(invoiceItems) {\n    console.log('Analyzing item movement for', invoiceItems.length, 'items');\n    \n    if (!invoiceItems || invoiceItems.length === 0) {\n        console.log('No items to analyze');\n        return { fast_moving: null, slow_moving: null };\n    }\n    \n    // Group items by item_code and calculate scores\n    const itemStats = {};\n    \n    invoiceItems.forEach(item => {\n        if (!item.item_code || !item.item_name) {\n            console.log('Skipping invalid item:', item);\n            return;\n        }\n        \n        const itemCode = item.item_code;\n        const qty = parseFloat(item.qty) || 0;\n        \n        if (!itemStats[itemCode]) {\n            itemStats[itemCode] = {\n                item_code: itemCode,\n                item_name: item.item_name,\n                item_score: 0,      // Number of times item appears in invoices\n                quantity_score: 0   // Total quantity sold\n            };\n        }\n        \n        itemStats[itemCode].item_score += 1;           // Count occurrences\n        itemStats[itemCode].quantity_score += qty;     // Sum quantities\n    });\n    \n    // Calculate item_qty_score for each item\n    const itemScores = Object.values(itemStats).map(item => ({\n        ...item,\n        item_qty_score: item.item_score * item.quantity_score\n    })).filter(item => item.item_qty_score > 0); // Only include items with valid scores\n    \n    console.log('Item scores calculated:', itemScores.length, 'unique items');\n    console.log('Top 3 items by score:', itemScores.slice(0, 3).map(i => ({name: i.item_name, score: i.item_qty_score})));\n    \n    if (itemScores.length === 0) {\n        console.log('No valid item scores calculated');\n        return { fast_moving: null, slow_moving: null };\n    }\n    \n    // Sort by item_qty_score (descending)\n    itemScores.sort((a, b) => b.item_qty_score - a.item_qty_score);\n    \n    const fastMoving = itemScores[0]; // Highest score\n    const slowMoving = itemScores[itemScores.length - 1]; // Lowest score\n    \n    console.log('Fast Moving Item:', fastMoving?.item_name, 'Score:', fastMoving?.item_qty_score);\n    console.log('Slow Moving Item:', slowMoving?.item_name, 'Score:', slowMoving?.item_qty_score);\n    \n    return {\n        fast_moving: fastMoving || null,\n        slow_moving: slowMoving || null\n    };\n}\n\n\n// Compile dashboard data from API responses\nfunction compileDashboardData(results) {\n    const [salesResult, stockResult, customerResult, itemMovementResult, opportunitiesResult, purchaseRevenueResult, suppliersResult, salesOutstandingResult] = results;\n    \n    const salesData = salesResult.status === 'fulfilled' ? salesResult.value : [];\n    const stockData = stockResult.status === 'fulfilled' ? stockResult.value : [];\n    const customerData = customerResult.status === 'fulfilled' ? customerResult.value : [];\n    const itemMovementData = itemMovementResult.status === 'fulfilled' ? itemMovementResult.value : { fast_moving: null, slow_moving: null };\n    const opportunitiesData = opportunitiesResult.status === 'fulfilled' ? opportunitiesResult.value : 0;\n    const purchaseRevenueData = purchaseRevenueResult.status === 'fulfilled' ? purchaseRevenueResult.value : 0;\n    const suppliersData = suppliersResult.status === 'fulfilled' ? suppliersResult.value : 0;\n    const salesOutstandingData = salesOutstandingResult.status === 'fulfilled' ? salesOutstandingResult.value : 0;\n    \n    // Calculate KPIs\n    const prescriptions = salesData.length;\n    const totalSales = salesData.reduce((sum, invoice) => sum + (invoice.grand_total || 0), 0);\n    const uniqueItems = [...new Set(stockData.map(item => item.item_code))].length;\n    const uniqueCustomers = [...new Set(salesData.map(invoice => invoice.customer))].length;\n    \n    // Debug logging\n    console.log('=== DASHBOARD DATA COMPILATION ===');\n    console.log('Sales invoices:', prescriptions);\n    console.log('Total sales:', totalSales);\n    console.log('Stock entries:', stockData.length);\n    console.log('Unique items:', uniqueItems);\n    console.log('Unique customers:', uniqueCustomers);\n    console.log('Opportunities:', opportunitiesData);\n    console.log('Purchase revenue:', purchaseRevenueData);\n    console.log('Suppliers:', suppliersData);\n    console.log('Sales Outstanding:', salesOutstandingData);\n    \n    // Calculate growth percentages (simplified for now)\n    const prescriptionGrowth = calculateGrowth(prescriptions, prescriptions * 0.9); // Mock: assume 10% growth\n    const salesGrowth = calculateGrowth(totalSales, totalSales * 0.85); // Mock: assume 15% growth\n    const inventoryGrowth = calculateGrowth(uniqueItems, uniqueItems * 0.95); // Mock: assume 5% growth\n    const customerGrowth = calculateGrowth(uniqueCustomers, uniqueCustomers * 0.8); // Mock: assume 20% growth\n    const opportunitiesGrowth = calculateGrowth(opportunitiesData, opportunitiesData * 0.9); // Mock: assume 10% growth\n    const purchaseRevenueGrowth = calculateGrowth(purchaseRevenueData, purchaseRevenueData * 0.85); // Mock: assume 15% growth\n    const suppliersGrowth = calculateGrowth(suppliersData, suppliersData * 0.95); // Mock: assume 5% growth\n    const salesOutstandingGrowth = calculateGrowth(salesOutstandingData, salesOutstandingData * 0.9); // Mock: assume 10% growth\n    \n    return {\n        prescriptions: { value: prescriptions, growth: prescriptionGrowth },\n        sales: { value: totalSales, growth: salesGrowth },\n        inventory: { value: uniqueItems, growth: inventoryGrowth },\n        customers: { value: uniqueCustomers, growth: customerGrowth },\n        fast_moving: { \n            value: (itemMovementData.fast_moving && itemMovementData.fast_moving.item_name) ? itemMovementData.fast_moving.item_name : 'No Data', \n            growth: 0 // Growth not applicable for item names\n        },\n        slow_moving: { \n            value: (itemMovementData.slow_moving && itemMovementData.slow_moving.item_name) ? itemMovementData.slow_moving.item_name : 'No Data', \n            growth: 0 // Growth not applicable for item names\n        },\n        opportunities: { value: opportunitiesData, growth: opportunitiesGrowth },\n        purchase_revenue: { value: purchaseRevenueData, growth: purchaseRevenueGrowth },\n        suppliers: { value: suppliersData, growth: suppliersGrowth },\n        sales_outstanding: { value: salesOutstandingData, growth: salesOutstandingGrowth }\n    };\n}\n\n// Calculate growth percentage\nfunction calculateGrowth(current, previous) {\n    if (previous === 0) return 0; // Avoid division by zero\n    \n    const growth = ((current - previous) / previous) * 100;\n    return Math.round(growth * 10) / 10; // Round to 1 decimal place\n}\n\n// Load pharmacy charts data using ERPNext APIs\nfunction loadPharmacyChartsData(dateRange, branch) {\n    // Load monthly sales data for charts\n    loadMonthlySalesChart(dateRange, branch);\n    loadSalesTrendsChart(dateRange, branch);\n}\n\n// Load monthly sales chart data - improved with last 6 months historical data\nfunction loadMonthlySalesChart(dateRange, branch) {\n    console.log('=== LOADING SALES PERFORMANCE CHART ===');\n    console.log('Branch parameter:', branch || 'All branches');\n    \n    // Calculate last 6 months date range\n    const today = new Date();\n    const sixMonthsAgo = new Date(today.getFullYear(), today.getMonth() - 5, 1);\n    const startDate = sixMonthsAgo.toISOString().split('T')[0];\n    const endDate = today.toISOString().split('T')[0];\n    \n    console.log('Date range (last 6 months):', startDate, 'to', endDate);\n    \n    const filters = {\n        'posting_date': ['between', [startDate, endDate]],\n        'docstatus': 1\n        // Removed 'status': 'Paid' filter to show all submitted invoices\n    };\n    \n    if (branch) {\n        filters['branch'] = branch;\n        console.log('Applying branch filter:', branch);\n    } else {\n        console.log('No branch filter - showing all branches');\n    }\n    \n    console.log('Final filters:', filters);\n    \n    frappe.call({\n        method: 'frappe.client.get_list',\n        args: {\n            doctype: 'Sales Invoice',\n            fields: ['posting_date', 'grand_total', 'total_qty', 'customer', 'branch'],\n            filters: filters,\n            order_by: 'posting_date asc',\n            limit_page_length: 2000\n        },\n        callback: function(response) {\n            const salesData = response.message || [];\n            console.log('=== SALES PERFORMANCE DATA RECEIVED ===');\n            console.log('Total records:', salesData.length);\n            \n            // Show branch distribution\n            const branchCounts = {};\n            salesData.forEach(inv => {\n                const b = inv.branch || 'No Branch';\n                branchCounts[b] = (branchCounts[b] || 0) + 1;\n            });\n            console.log('Records by branch:', branchCounts);\n            \n            const chartData = processSalesPerformanceData(salesData);\n            updateSalesChart(chartData);\n        },\n        error: function(error) {\n            console.error('Error loading Sales Performance data:', error);\n            updateSalesChart(getDemoSalesPerformanceData());\n        }\n    });\n}\n\n// Load Sales Trends chart data - improved with current year and better fields\nfunction loadSalesTrendsChart(dateRange, branch) {\n    console.log('Loading Sales Trends chart data...');\n    \n    // Use current year data\n    const currentYear = new Date().getFullYear();\n    const yearStart = `${currentYear}-01-01`;\n    const yearEnd = `${currentYear}-12-31`;\n    \n    const filters = {\n        'posting_date': ['between', [yearStart, yearEnd]],\n        'docstatus': 1,\n        'status': 'Paid' // Only include paid invoices\n    };\n    \n    if (branch) {\n        filters['branch'] = branch;\n    }\n    \n    frappe.call({\n        method: 'frappe.client.get_list',\n        args: {\n            doctype: 'Sales Invoice',\n            fields: ['posting_date', 'grand_total', 'total_qty', 'customer', 'branch'],\n            filters: filters,\n            order_by: 'posting_date asc',\n            limit_page_length: 2000\n        },\n        callback: function(response) {\n            console.log('Sales Trends data loaded:', response.message?.length || 0, 'records');\n            const salesData = response.message || [];\n            const chartData = processSalesTrendsData(salesData);\n            updateSalesTrendsChart(chartData);\n        },\n        error: function(error) {\n            console.error('Error loading Sales Trends data:', error);\n            updateSalesTrendsChart(getDemoSalesTrendsData());\n        }\n    });\n}\n\n// Process Sales Performance data for improved chart visualization\n// Shows last 6 months of historical data ending with current month\nfunction processSalesPerformanceData(salesData) {\n    const monthlyData = {};\n    const today = new Date();\n    const currentMonth = today.getMonth();\n    const currentYear = today.getFullYear();\n    \n    console.log('Processing Sales Performance data - Last 6 months ending:', today.toLocaleDateString());\n    console.log('Total sales records:', salesData.length);\n    \n    // Generate last 6 months including current month\n    const last6Months = [];\n    for (let i = 5; i >= 0; i--) {\n        const date = new Date(currentYear, currentMonth - i, 1);\n        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n        const displayLabel = `${monthNames[date.getMonth()]} ${date.getFullYear()}`;\n        \n        last6Months.push({\n            key: monthKey,\n            label: displayLabel,\n            year: date.getFullYear(),\n            month: date.getMonth()\n        });\n        \n        monthlyData[monthKey] = {\n            revenue: 0,\n            quantity: 0,\n            avgInvoiceValue: 0,\n            invoiceCount: 0\n        };\n    }\n    \n    console.log('Last 6 months:', last6Months.map(m => m.label));\n    \n    // Process sales data for last 6 months only\n    salesData.forEach(invoice => {\n        if (invoice.posting_date) {\n            const date = new Date(invoice.posting_date);\n            const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n            \n            if (monthlyData[monthKey] !== undefined) {\n                monthlyData[monthKey].revenue += invoice.grand_total || 0;\n                monthlyData[monthKey].quantity += invoice.total_qty || 0;\n                monthlyData[monthKey].invoiceCount += 1;\n            }\n        }\n    });\n    \n    // Calculate average invoice value\n    Object.keys(monthlyData).forEach(monthKey => {\n        if (monthlyData[monthKey].invoiceCount > 0) {\n            monthlyData[monthKey].avgInvoiceValue = monthlyData[monthKey].revenue / monthlyData[monthKey].invoiceCount;\n        }\n    });\n    \n    console.log('Monthly data processed:', monthlyData);\n    \n    // Convert to chart format\n    const chartData = {\n        labels: last6Months.map(m => m.label),\n        datasets: [\n            {\n                label: 'Monthly Revenue (GH‚Çµ)',\n                data: last6Months.map(m => Math.round(monthlyData[m.key].revenue)),\n                backgroundColor: '#10b981',  // Solid green color for bars\n                borderColor: '#059669',      // Darker green border\n                borderWidth: 2\n            }\n        ]\n    };\n    \n    return chartData;\n}\n\n// Process Sales Trends data for improved chart visualization\nfunction processSalesTrendsData(salesData) {\n    const monthlyData = {};\n    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n    const currentYear = new Date().getFullYear();\n    \n    // Initialize all months with 0 values\n    months.forEach(month => {\n        monthlyData[month] = {\n            count: 0,\n            revenue: 0,\n            quantity: 0,\n            customers: new Set()\n        };\n    });\n    \n    // Process sales data\n    salesData.forEach(invoice => {\n        if (invoice.posting_date) {\n            const date = new Date(invoice.posting_date);\n            if (date.getFullYear() === currentYear) {\n                const month = months[date.getMonth()];\n                \n                monthlyData[month].count += 1;\n                monthlyData[month].revenue += invoice.grand_total || 0;\n                monthlyData[month].quantity += invoice.total_qty || 0;\n                if (invoice.customer) {\n                    monthlyData[month].customers.add(invoice.customer);\n                }\n            }\n        }\n    });\n    \n    // Convert to chart format\n    const chartData = {\n        labels: months,\n        datasets: [\n            {\n                label: 'Invoice Count',\n                data: months.map(month => monthlyData[month].count),\n                borderColor: '#3b82f6',\n                backgroundColor: 'rgba(59, 130, 246, 0.1)',\n                tension: 0.4\n            },\n            {\n                label: 'Revenue (GH‚Çµ)',\n                data: months.map(month => Math.round(monthlyData[month].revenue)),\n                borderColor: '#10b981',\n                backgroundColor: 'rgba(16, 185, 129, 0.1)',\n                tension: 0.4,\n                yAxisID: 'y1'\n            },\n            {\n                label: 'Unique Customers',\n                data: months.map(month => monthlyData[month].customers.size),\n                borderColor: '#f59e0b',\n                backgroundColor: 'rgba(245, 158, 11, 0.1)',\n                tension: 0.4\n            }\n        ]\n    };\n    \n    return chartData;\n}\n\n// Process monthly data for charts\nfunction processMonthlyData(data, valueField) {\n    const monthlyData = {};\n    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n    \n    // Initialize all months with 0\n    months.forEach(month => {\n        monthlyData[month] = 0;\n    });\n    \n    // Process data\n    data.forEach(item => {\n        if (item.posting_date) {\n            const date = new Date(item.posting_date);\n            const month = months[date.getMonth()];\n            \n            if (valueField === 'count') {\n                monthlyData[month] += 1;\n            } else {\n                monthlyData[month] += item[valueField] || 0;\n            }\n        }\n    });\n    \n    return {\n        labels: months,\n        values: months.map(month => monthlyData[month])\n    };\n}\n\n// Demo data functions\nfunction getDemoKPIData() {\n    return {\n        prescriptions: { value: 1247, growth: 8.5 },\n        sales: { value: 245000, growth: 12.3 },\n        inventory: { value: 3420, growth: -2.1 },\n        expiry: { value: 23, growth: -15.4 },\n        customers: { value: 892, growth: 6.7 },\n        revenue: { value: 345000, growth: 9.8 }\n    };\n}\n\nfunction getDemoChartsData() {\n    return {\n        prescriptions: {\n            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],\n            values: [1120, 1135, 1150, 1140, 1165, 1247]\n        },\n        sales: {\n            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],\n            values: [195000, 210000, 225000, 235000, 240000, 245000]\n        }\n    };\n}\n\n// Error handling\nwindow.addEventListener('error', function(e) {\n    console.error('Dashboard error:', e.error);\n});\n\n// Export for global access\nwindow.PharmacyDashboard = {\n    refresh: loadDashboardData,\n    refreshCharts: loadChartsData,\n    updateKPICards: updateKPICards,\n    updateCharts: updateCharts,\n    updateSalesTrendsChart: updateSalesTrendsChart,\n    getDemoData: getDemoKPIData\n};\n\n// Update Sales Trends chart\nfunction updateSalesTrendsChart(data) {\n    const container = root_element.querySelector('#sales-trends-chart-container');\n    if (!container) {\n        console.error('Sales Trends chart container not found');\n        return;\n    }\n    \n    // Clear existing chart\n    container.innerHTML = '';\n    \n    // Create canvas\n    const canvas = document.createElement('canvas');\n    canvas.id = 'sales-trends-chart';\n    container.appendChild(canvas);\n    \n    // Create chart with dual Y-axis for better visualization\n    const ctx = canvas.getContext('2d');\n    new Chart(ctx, {\n        type: 'line',\n        data: data,\n        options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            interaction: {\n                mode: 'index',\n                intersect: false,\n            },\n            plugins: {\n                legend: {\n                    display: true,\n                    position: 'top'\n                },\n                title: {\n                    display: true,\n                    text: `Sales Trends - ${new Date().getFullYear()}`\n                }\n            },\n            scales: {\n                y: {\n                    type: 'linear',\n                    display: true,\n                    position: 'left',\n                    beginAtZero: true,\n                    title: {\n                        display: true,\n                        text: 'Count / Customers'\n                    }\n                },\n                y1: {\n                    type: 'linear',\n                    display: true,\n                    position: 'right',\n                    beginAtZero: true,\n                    title: {\n                        display: true,\n                        text: 'Revenue (GH‚Çµ)'\n                    },\n                    grid: {\n                        drawOnChartArea: false,\n                    },\n                }\n            }\n        }\n    });\n    \n    console.log('Sales Trends chart created successfully');\n}\n\n// Demo data for Sales Performance chart\nfunction getDemoSalesPerformanceData() {\n    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n    const currentMonth = new Date().getMonth();\n    \n    return {\n        labels: months,\n        datasets: [\n            {\n                label: 'Monthly Revenue (GH‚Çµ)',\n                data: months.map((_, index) => index <= currentMonth ? Math.floor(Math.random() * 80000) + 20000 : 0),\n                borderColor: '#10b981',\n                backgroundColor: 'rgba(16, 185, 129, 0.1)',\n                tension: 0.4,\n                fill: true\n            },\n            {\n                label: 'Total Quantity',\n                data: months.map((_, index) => index <= currentMonth ? Math.floor(Math.random() * 1000) + 200 : 0),\n                borderColor: '#3b82f6',\n                backgroundColor: 'rgba(59, 130, 246, 0.1)',\n                tension: 0.4,\n                yAxisID: 'y1'\n            },\n            {\n                label: 'Avg Invoice Value (GH‚Çµ)',\n                data: months.map((_, index) => index <= currentMonth ? Math.floor(Math.random() * 5000) + 1000 : 0),\n                borderColor: '#f59e0b',\n                backgroundColor: 'rgba(245, 158, 11, 0.1)',\n                tension: 0.4,\n                borderDash: [5, 5]\n            }\n        ]\n    };\n}\n\n// Demo data for Sales Trends chart\nfunction getDemoSalesTrendsData() {\n    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n    const currentMonth = new Date().getMonth();\n    \n    return {\n        labels: months,\n        datasets: [\n            {\n                label: 'Invoice Count',\n                data: months.map((_, index) => index <= currentMonth ? Math.floor(Math.random() * 50) + 20 : 0),\n                borderColor: '#3b82f6',\n                backgroundColor: 'rgba(59, 130, 246, 0.1)',\n                tension: 0.4\n            },\n            {\n                label: 'Revenue (GH‚Çµ)',\n                data: months.map((_, index) => index <= currentMonth ? Math.floor(Math.random() * 50000) + 10000 : 0),\n                borderColor: '#10b981',\n                backgroundColor: 'rgba(16, 185, 129, 0.1)',\n                tension: 0.4,\n                yAxisID: 'y1'\n            },\n            {\n                label: 'Unique Customers',\n                data: months.map((_, index) => index <= currentMonth ? Math.floor(Math.random() * 30) + 10 : 0),\n                borderColor: '#f59e0b',\n                backgroundColor: 'rgba(245, 158, 11, 0.1)',\n                tension: 0.4\n            }\n        ]\n    };\n}\n\n// Load Opportunities data - count of converted opportunities\nfunction loadOpportunitiesData(dateRange, branch) {\n    return new Promise((resolve, reject) => {\n        console.log('Loading opportunities data...');\n        \n        const filters = {\n            'status': 'Converted',\n            'transaction_date': ['between', [dateRange.from_date, dateRange.to_date]]\n        };\n        \n        frappe.call({\n            method: 'frappe.client.get_list',\n            args: {\n                doctype: 'Opportunity',\n                fields: ['name', 'status', 'opportunity_amount'],\n                filters: filters,\n                limit_page_length: 1000\n            },\n            callback: function(response) {\n                const opportunities = response.message || [];\n                console.log('Opportunities loaded:', opportunities.length);\n                resolve(opportunities.length);\n            },\n            error: function(error) {\n                console.error('Error loading opportunities:', error);\n                resolve(0);\n            }\n        });\n    });\n}\n\n// Load Purchase Revenue data - total from submitted purchase invoices\nfunction loadPurchaseRevenueData(dateRange, branch) {\n    return new Promise((resolve, reject) => {\n        console.log('=== LOADING PURCHASE REVENUE DATA ===');\n        console.log('Date range:', dateRange.from_date, 'to', dateRange.to_date);\n        console.log('Branch:', branch || 'All branches');\n        \n        const filters = {\n            'docstatus': 1, // Only submitted invoices\n            'posting_date': ['between', [dateRange.from_date, dateRange.to_date]]\n        };\n        \n        if (branch) {\n            filters['company'] = branch;\n        }\n        \n        frappe.call({\n            method: 'frappe.client.get_list',\n            args: {\n                doctype: 'Purchase Invoice',\n                fields: ['name', 'grand_total', 'is_return', 'supplier'],\n                filters: filters,\n                limit_page_length: 0  // Get all records, not just 1000\n            },\n            callback: function(response) {\n                const purchaseInvoices = response.message || [];\n                \n                // Calculate total expense: Add purchases, subtract returns\n                let totalExpense = 0;\n                let purchaseCount = 0;\n                let returnCount = 0;\n                let grossPurchases = 0;\n                let totalReturns = 0;\n                \n                purchaseInvoices.forEach(invoice => {\n                    const amount = invoice.grand_total || 0;\n                    \n                    if (invoice.is_return) {\n                        // Returns reduce total expense\n                        totalExpense -= amount;\n                        totalReturns += amount;\n                        returnCount++;\n                    } else {\n                        // Regular purchases add to total expense\n                        totalExpense += amount;\n                        grossPurchases += amount;\n                        purchaseCount++;\n                    }\n                });\n                \n                console.log('Purchase Revenue Calculation:');\n                console.log('- Total invoices:', purchaseInvoices.length);\n                console.log('- Purchase invoices:', purchaseCount);\n                console.log('- Return invoices:', returnCount);\n                console.log('- Gross purchases:', grossPurchases);\n                console.log('- Total returns:', totalReturns);\n                console.log('- Net purchase expense:', totalExpense);\n                \n                resolve(totalExpense);\n            },\n            error: function(error) {\n                console.error('Error loading purchase revenue:', error);\n                resolve(0);\n            }\n        });\n    });\n}\n\n// Load Suppliers data - count of enabled suppliers\nfunction loadSuppliersData(dateRange, branch) {\n    return new Promise((resolve, reject) => {\n        console.log('Loading suppliers data...');\n        \n        const filters = {\n            'disabled': 0 // Enabled suppliers (disabled = 0 means enabled)\n        };\n        \n        frappe.call({\n            method: 'frappe.client.get_list',\n            args: {\n                doctype: 'Supplier',\n                fields: ['name', 'supplier_name', 'disabled'],\n                filters: filters,\n                limit_page_length: 1000\n            },\n            callback: function(response) {\n                const suppliers = response.message || [];\n                console.log('Suppliers loaded:', suppliers.length);\n                resolve(suppliers.length);\n            },\n            error: function(error) {\n                console.error('Error loading suppliers:', error);\n                resolve(0);\n            }\n        });\n    });\n}\n\n// Load Sales Outstanding data - sum of outstanding_amount from Sales Invoices\nfunction loadSalesOutstandingData(dateRange, branch) {\n    return new Promise((resolve, reject) => {\n        console.log('Loading sales outstanding data for date range:', dateRange, 'branch:', branch);\n        \n        const filters = {\n            'posting_date': ['between', [dateRange.from_date, dateRange.to_date]],\n            'docstatus': 1,\n            'outstanding_amount': ['>', 0]\n        };\n        \n        // Apply branch filter if selected\n        if (branch) {\n            filters['branch'] = branch;\n        }\n        \n        frappe.call({\n            method: 'frappe.client.get_list',\n            args: {\n                doctype: 'Sales Invoice',\n                fields: ['name', 'outstanding_amount', 'posting_date', 'branch'],\n                filters: filters,\n                limit_page_length: 0\n            },\n            callback: function(response) {\n                const invoices = response.message || [];\n                const totalOutstanding = invoices.reduce((sum, inv) => sum + (inv.outstanding_amount || 0), 0);\n                console.log('Sales Outstanding loaded:', invoices.length, 'invoices, Total:', totalOutstanding);\n                console.log('Date range applied:', dateRange.from_date, 'to', dateRange.to_date);\n                console.log('Branch filter:', branch || 'All Branches');\n                resolve(totalOutstanding);\n            },\n            error: function(error) {\n                console.error('Error loading sales outstanding:', error);\n                resolve(0);\n            }\n        });\n    });\n}\n\n// Load Centralized Warehouse Items - ONLY items unique to this warehouse\nfunction loadCentralizedWarehouseItems() {\n    console.log('Loading unique Centralized Warehouse items...');\n    \n    const centralWarehouseName = 'Centralized Warehouse - UCL';\n    const companyName = 'Unicom Chemist Ltd';\n    \n    // Show loading state\n    $(root_element).find('#warehouse-items-loading').show();\n    $(root_element).find('#warehouse-items-table-wrapper').hide();\n    $(root_element).find('#warehouse-items-empty').hide();\n    \n    // Step 1: Get all warehouses for the company\n    frappe.call({\n        method: 'frappe.client.get_list',\n        args: {\n            doctype: 'Warehouse',\n            filters: {\n                'company': companyName\n            },\n            fields: ['name'],\n            limit_page_length: 0\n        },\n        callback: function(warehouseResponse) {\n            const allWarehouses = warehouseResponse.message || [];\n            console.log('Total warehouses for company:', allWarehouses.length);\n            \n            // Filter out the central warehouse to get \"other\" warehouses\n            const otherWarehouses = allWarehouses\n                .map(w => w.name)\n                .filter(name => name !== centralWarehouseName);\n            \n            console.log('Other warehouses:', otherWarehouses.length);\n            \n            if (otherWarehouses.length === 0) {\n                console.warn('No other warehouses found, showing all items in central warehouse');\n                loadAllCentralWarehouseItems();\n                return;\n            }\n            \n            // Step 2: Get items in Central Warehouse\n            frappe.call({\n                method: 'frappe.client.get_list',\n                args: {\n                    doctype: 'Bin',\n                    filters: {\n                        'warehouse': centralWarehouseName,\n                        'actual_qty': ['>', 0]\n                    },\n                    fields: ['item_code', 'actual_qty', 'reserved_qty', 'projected_qty', 'stock_value', 'valuation_rate'],\n                    limit_page_length: 0\n                },\n                callback: function(centralBinsResponse) {\n                    const centralBins = centralBinsResponse.message || [];\n                    console.log('Items in central warehouse:', centralBins.length);\n                    \n                    if (centralBins.length === 0) {\n                        $(root_element).find('#warehouse-items-loading').hide();\n                        $(root_element).find('#warehouse-items-empty').show();\n                        updateWarehouseStats(0, 0, 0);\n                        return;\n                    }\n                    \n                    const centralItemCodes = centralBins.map(bin => bin.item_code);\n                    \n                    // Step 3: Get items in OTHER warehouses\n                    frappe.call({\n                        method: 'frappe.client.get_list',\n                        args: {\n                            doctype: 'Bin',\n                            filters: {\n                                'warehouse': ['in', otherWarehouses],\n                                'actual_qty': ['>', 0]\n                            },\n                            fields: ['item_code'],\n                            limit_page_length: 0\n                        },\n                        callback: function(otherBinsResponse) {\n                            const otherBins = otherBinsResponse.message || [];\n                            console.log('Items in other warehouses:', otherBins.length);\n                            \n                            // Create a Set of item codes in other warehouses for fast lookup\n                            const otherWarehouseItemCodes = new Set(otherBins.map(bin => bin.item_code));\n                            console.log('Unique items in other warehouses:', otherWarehouseItemCodes.size);\n                            \n                            // Step 4: Filter to get ONLY items in central warehouse that are NOT in other warehouses\n                            const uniqueCentralItems = centralBins.filter(bin => \n                                !otherWarehouseItemCodes.has(bin.item_code)\n                            );\n                            \n                            console.log('Unique items ONLY in central warehouse:', uniqueCentralItems.length);\n                            \n                            if (uniqueCentralItems.length === 0) {\n                                $(root_element).find('#warehouse-items-loading').hide();\n                                $(root_element).find('#warehouse-items-empty').show();\n                                updateWarehouseStats(0, 0, 0);\n                                return;\n                            }\n                            \n                            // Step 5: Get Item details for unique items\n                            const uniqueItemCodes = uniqueCentralItems.map(bin => bin.item_code);\n                            \n                            frappe.call({\n                                method: 'frappe.client.get_list',\n                                args: {\n                                    doctype: 'Item',\n                                    filters: {\n                                        'name': ['in', uniqueItemCodes]\n                                    },\n                                    fields: ['name', 'item_name', 'item_group', 'stock_uom'],\n                                    limit_page_length: 0\n                                },\n                                callback: function(itemResponse) {\n                                    const items = itemResponse.message || [];\n                                    console.log('Item details loaded:', items.length);\n                                    \n                                    // Create item details map\n                                    const itemMap = {};\n                                    items.forEach(item => {\n                                        itemMap[item.name] = item;\n                                    });\n                                    \n                                    // Merge Bin data with Item details\n                                    const mergedData = uniqueCentralItems.map(bin => {\n                                        const itemDetails = itemMap[bin.item_code] || {};\n                                        return {\n                                            item_code: bin.item_code,\n                                            actual_qty: bin.actual_qty,\n                                            reserved_qty: bin.reserved_qty,\n                                            projected_qty: bin.projected_qty,\n                                            stock_value: bin.stock_value,\n                                            valuation_rate: bin.valuation_rate,\n                                            item_name: itemDetails.item_name || bin.item_code,\n                                            item_group: itemDetails.item_group || '-',\n                                            stock_uom: itemDetails.stock_uom || 'Nos'\n                                        };\n                                    });\n                                    \n                                    // Hide loading\n                                    $(root_element).find('#warehouse-items-loading').hide();\n                                    \n                                    // Calculate totals\n                                    let totalItems = mergedData.length;\n                                    let totalValue = 0;\n                                    let totalQty = 0;\n                                    \n                                    mergedData.forEach(item => {\n                                        totalValue += item.stock_value || 0;\n                                        totalQty += item.actual_qty || 0;\n                                    });\n                                    \n                                    // Update stats cards\n                                    updateWarehouseStats(totalItems, totalValue, totalQty);\n                                    \n                                    // Populate table\n                                    populateWarehouseItemsTable(mergedData);\n                                    \n                                    // Show table\n                                    $(root_element).find('#warehouse-items-table-wrapper').show();\n                                },\n                                error: function(error) {\n                                    console.error('Error loading item details:', error);\n                                    handleItemDetailsError(uniqueCentralItems);\n                                }\n                            });\n                        },\n                        error: function(error) {\n                            console.error('Error loading other warehouse items:', error);\n                            // If we can't get other warehouse items, show all central items\n                            loadAllCentralWarehouseItems();\n                        }\n                    });\n                },\n                error: function(error) {\n                    console.error('Error loading central warehouse items:', error);\n                    $(root_element).find('#warehouse-items-loading').hide();\n                    $(root_element).find('#warehouse-items-empty').show();\n                    updateWarehouseStats(0, 0, 0);\n                }\n            });\n        },\n        error: function(error) {\n            console.error('Error loading warehouses:', error);\n            // Fallback to showing all items in central warehouse\n            loadAllCentralWarehouseItems();\n        }\n    });\n}\n\n// Fallback function to load all items in central warehouse (if warehouse filtering fails)\nfunction loadAllCentralWarehouseItems() {\n    console.log('Fallback: Loading all central warehouse items...');\n    \n    const warehouseName = 'Centralized Warehouse - UCL';\n    \n    frappe.call({\n        method: 'frappe.client.get_list',\n        args: {\n            doctype: 'Bin',\n            filters: {\n                'warehouse': warehouseName,\n                'actual_qty': ['>', 0]\n            },\n            fields: ['item_code', 'actual_qty', 'reserved_qty', 'projected_qty', 'stock_value', 'valuation_rate'],\n            order_by: 'stock_value desc',\n            limit_page_length: 0\n        },\n        callback: function(response) {\n            const bins = response.message || [];\n            \n            if (bins.length === 0) {\n                $(root_element).find('#warehouse-items-loading').hide();\n                $(root_element).find('#warehouse-items-empty').show();\n                updateWarehouseStats(0, 0, 0);\n                return;\n            }\n            \n            const itemCodes = bins.map(bin => bin.item_code);\n            \n            frappe.call({\n                method: 'frappe.client.get_list',\n                args: {\n                    doctype: 'Item',\n                    filters: {\n                        'name': ['in', itemCodes]\n                    },\n                    fields: ['name', 'item_name', 'item_group', 'stock_uom'],\n                    limit_page_length: 0\n                },\n                callback: function(itemResponse) {\n                    const items = itemResponse.message || [];\n                    \n                    const itemMap = {};\n                    items.forEach(item => {\n                        itemMap[item.name] = item;\n                    });\n                    \n                    const mergedData = bins.map(bin => {\n                        const itemDetails = itemMap[bin.item_code] || {};\n                        return {\n                            item_code: bin.item_code,\n                            actual_qty: bin.actual_qty,\n                            reserved_qty: bin.reserved_qty,\n                            projected_qty: bin.projected_qty,\n                            stock_value: bin.stock_value,\n                            valuation_rate: bin.valuation_rate,\n                            item_name: itemDetails.item_name || bin.item_code,\n                            item_group: itemDetails.item_group || '-',\n                            stock_uom: itemDetails.stock_uom || 'Nos'\n                        };\n                    });\n                    \n                    $(root_element).find('#warehouse-items-loading').hide();\n                    \n                    let totalItems = mergedData.length;\n                    let totalValue = 0;\n                    let totalQty = 0;\n                    \n                    mergedData.forEach(item => {\n                        totalValue += item.stock_value || 0;\n                        totalQty += item.actual_qty || 0;\n                    });\n                    \n                    updateWarehouseStats(totalItems, totalValue, totalQty);\n                    populateWarehouseItemsTable(mergedData);\n                    $(root_element).find('#warehouse-items-table-wrapper').show();\n                },\n                error: function(error) {\n                    console.error('Error loading item details:', error);\n                    handleItemDetailsError(bins);\n                }\n            });\n        },\n        error: function(error) {\n            console.error('Error loading warehouse items:', error);\n            $(root_element).find('#warehouse-items-loading').hide();\n            $(root_element).find('#warehouse-items-empty').show();\n            updateWarehouseStats(0, 0, 0);\n        }\n    });\n}\n\n// Helper function to handle item details error\nfunction handleItemDetailsError(bins) {\n    $(root_element).find('#warehouse-items-loading').hide();\n    \n    const basicData = bins.map(bin => ({\n        item_code: bin.item_code,\n        actual_qty: bin.actual_qty,\n        reserved_qty: bin.reserved_qty,\n        projected_qty: bin.projected_qty,\n        stock_value: bin.stock_value,\n        valuation_rate: bin.valuation_rate,\n        item_name: bin.item_code,\n        item_group: '-',\n        stock_uom: 'Nos'\n    }));\n    \n    let totalItems = basicData.length;\n    let totalValue = 0;\n    let totalQty = 0;\n    \n    basicData.forEach(item => {\n        totalValue += item.stock_value || 0;\n        totalQty += item.actual_qty || 0;\n    });\n    \n    updateWarehouseStats(totalItems, totalValue, totalQty);\n    populateWarehouseItemsTable(basicData);\n    $(root_element).find('#warehouse-items-table-wrapper').show();\n}\n\n// Update warehouse statistics cards\nfunction updateWarehouseStats(totalItems, totalValue, totalQty) {\n    const totalItemsEl = $(root_element).find('#warehouse-total-items');\n    const totalValueEl = $(root_element).find('#warehouse-total-value');\n    const totalQtyEl = $(root_element).find('#warehouse-total-qty');\n    \n    totalItemsEl.text(totalItems.toLocaleString());\n    totalValueEl.text(formatCurrency(totalValue));\n    totalQtyEl.text(totalQty.toLocaleString());\n}\n\n// Populate warehouse items table\nfunction populateWarehouseItemsTable(items) {\n    const tbody = $(root_element).find('#warehouse-items-tbody');\n    tbody.empty();\n    \n    items.forEach(item => {\n        const available = (item.actual_qty || 0) - (item.reserved_qty || 0);\n        const qtyClass = available > 50 ? 'qty-positive' : available > 0 ? 'qty-low' : 'qty-zero';\n        \n        const row = $(`\n            <tr>\n                <td class=\"item-code-cell\">\n                    <a href=\"/app/item/${item.item_code}\" target=\"_blank\">${item.item_code}</a>\n                </td>\n                <td>${item.item_name || '-'}</td>\n                <td>${item.item_group || '-'}</td>\n                <td class=\"text-right\">${(item.actual_qty || 0).toLocaleString()} ${item.stock_uom || ''}</td>\n                <td class=\"text-right\">${(item.reserved_qty || 0).toLocaleString()}</td>\n                <td class=\"text-right ${qtyClass}\">${available.toLocaleString()}</td>\n                <td class=\"text-right\">${formatCurrency(item.stock_value || 0)}</td>\n            </tr>\n        `);\n        \n        tbody.append(row);\n    });\n    \n    console.log('Warehouse items table populated with', items.length, 'items');\n}\n\n// Helper function to format currency\nfunction formatCurrency(value) {\n    if (typeof value !== 'number') return 'GH‚Çµ0.00';\n    return 'GH‚Çµ' + value.toLocaleString('en-GH', { \n        minimumFractionDigits: 2, \n        maximumFractionDigits: 2 \n    });\n}\n\n// ============================================\n// BATCH EXPIRY STATUS FUNCTIONS\n// ============================================\n\n// Configurable expiry thresholds (in days)\nlet expiryThresholds = {\n    expired: 0,           // Less than 0 days (already expired)\n    useImmediately: 180,  // Less than 6 months (180 days)\n    nearExpiry: 365,      // 6 months to 1 year (365 days)\n    healthy: 730          // 2 years and above (730 days)\n};\n\n// Load batch expiry data\nfunction loadBatchExpiryData() {\n    console.log('=== Loading batch expiry data ===');\n    \n    // Show loading state\n    $(root_element).find('#batch-items-loading').show();\n    $(root_element).find('#batch-items-table-wrapper').hide();\n    $(root_element).find('#batch-items-empty').hide();\n    $('#batch-items-loading').show();\n    $('#batch-items-table-wrapper').hide();\n    $('#batch-items-empty').hide();\n    \n    // First, let's check if there are any batches at all\n    console.log('Step 1: Checking for any batches in the system...');\n    frappe.db.get_list('Batch', {\n        filters: {},\n        fields: ['name', 'item', 'expiry_date', 'disabled'],\n        limit: 10\n    }).then(allBatches => {\n        console.log('Total batches found (first 10):', allBatches);\n        \n        // Now get batches with expiry dates\n        console.log('Step 2: Fetching batches with expiry dates...');\n        return frappe.db.get_list('Batch', {\n            filters: {\n                'disabled': 0\n            },\n            fields: ['name', 'item', 'expiry_date'],\n            limit: 0\n        });\n    }).then(allActiveBatches => {\n        console.log('All active batches:', allActiveBatches.length);\n        \n        // Filter batches that have expiry dates\n        const batchesWithExpiry = allActiveBatches.filter(batch => \n            batch.expiry_date && batch.expiry_date !== '' && batch.expiry_date !== null\n        );\n        \n        console.log('Batches with expiry dates:', batchesWithExpiry.length);\n        \n        if (batchesWithExpiry.length === 0) {\n            console.log('No batches with expiry dates found');\n            $(root_element).find('#batch-items-loading').hide();\n            $(root_element).find('#batch-items-empty').show();\n            $('#batch-items-loading').hide();\n            $('#batch-items-empty').show();\n            return;\n        }\n        \n        // Get item details for all batch items\n        const itemCodes = [...new Set(batchesWithExpiry.map(b => b.item))];\n        \n        return frappe.db.get_list('Item', {\n            filters: {\n                'name': ['in', itemCodes]\n            },\n            fields: ['name', 'item_name', 'stock_uom'],\n            limit: 0\n        }).then(items => {\n            console.log('Items loaded:', items.length);\n            \n            // Create item lookup\n            const itemLookup = {};\n            items.forEach(item => {\n                itemLookup[item.name] = item;\n            });\n            \n            // Get stock quantities for batches using Stock Ledger Entry (proper ERPNext way)\n            const batchNames = batchesWithExpiry.map(b => b.name);\n            console.log('Step 3: Fetching stock entries for', batchNames.length, 'batches...');\n            \n            const sleFilters = {\n                'batch_no': ['in', batchNames],\n                'is_cancelled': 0\n            };\n            \n            // Add warehouse filter if selected\n            if (selectedWarehouse) {\n                sleFilters['warehouse'] = selectedWarehouse;\n                console.log('Applying warehouse filter to Stock Ledger Entry:', selectedWarehouse);\n            }\n            \n            return frappe.db.get_list('Stock Ledger Entry', {\n                filters: sleFilters,\n                fields: ['batch_no', 'warehouse', 'actual_qty', 'item_code'],\n                limit: 0\n            }).then(stockEntries => {\n                console.log('Stock entries loaded with warehouse filter:', stockEntries.length);\n                return stockEntries;\n            }).then(finalStockEntries => {\n                console.log('Final stock entries to process:', finalStockEntries.length);\n                \n                // Process and combine all data\n                const processedData = processBatchDataFromLists(batchesWithExpiry, itemLookup, finalStockEntries);\n                \n                console.log('Processed data result:', processedData);\n                \n                if (processedData.items.length > 0) {\n                    console.log('Displaying', processedData.items.length, 'batch items');\n                    updateExpiryStatsCards(processedData.stats);\n                    populateBatchItemsTable(processedData.items);\n                    \n                    $(root_element).find('#batch-items-loading').hide();\n                    $(root_element).find('#batch-items-table-wrapper').show();\n                    $('#batch-items-loading').hide();\n                    $('#batch-items-table-wrapper').show();\n                } else {\n                    console.log('No processed items to display');\n                    $(root_element).find('#batch-items-loading').hide();\n                    $(root_element).find('#batch-items-empty').show();\n                    $('#batch-items-loading').hide();\n                    $('#batch-items-empty').show();\n                }\n            });\n        });\n    }).catch(error => {\n        console.error('Error loading batch expiry data:', error);\n        $('#batch-items-loading').hide();\n        $('#batch-items-empty').show();\n    });\n}\n\n// Process batch data from separate API calls\nfunction processBatchDataFromLists(batches, itemLookup, stockEntries) {\n    const stats = {\n        expired: 0,\n        useImmediately: 0,\n        nearExpiry: 0,\n        healthy: 0\n    };\n    \n    // Group stock entries by batch (or by item if batch_no is null)\n    const stockByBatch = {};\n    const stockByItem = {};\n    \n    stockEntries.forEach(entry => {\n        if (entry.batch_no) {\n            // Regular batch-specific stock entry\n            if (!stockByBatch[entry.batch_no]) {\n                stockByBatch[entry.batch_no] = [];\n            }\n            stockByBatch[entry.batch_no].push(entry);\n        } else if (entry.item_code) {\n            // Fallback: stock entry by item (from Bin)\n            if (!stockByItem[entry.item_code]) {\n                stockByItem[entry.item_code] = [];\n            }\n            stockByItem[entry.item_code].push(entry);\n        }\n    });\n    \n    const items = [];\n    const today = new Date();\n    \n    batches.forEach(batch => {\n        const item = itemLookup[batch.item];\n        if (!item) return;\n        \n        // Calculate days to expiry\n        const expiryDate = new Date(batch.expiry_date);\n        const timeDiff = expiryDate.getTime() - today.getTime();\n        const daysToExpiry = Math.ceil(timeDiff / (1000 * 3600 * 24));\n        \n        // Get stock entries for this batch (try batch-specific first, then item-based fallback)\n        let batchStockEntries = stockByBatch[batch.name] || [];\n        \n        // If no batch-specific entries, use item-based entries as fallback\n        if (batchStockEntries.length === 0) {\n            batchStockEntries = stockByItem[batch.item] || [];\n        }\n        \n        // Group by warehouse and calculate total qty per warehouse\n        const warehouseQty = {};\n        batchStockEntries.forEach(entry => {\n            if (!warehouseQty[entry.warehouse]) {\n                warehouseQty[entry.warehouse] = 0;\n            }\n            warehouseQty[entry.warehouse] += entry.actual_qty || 0;\n        });\n        \n        // If still no stock entries, create a default entry to show the batch exists\n        if (Object.keys(warehouseQty).length === 0) {\n            warehouseQty['Unknown Warehouse'] = 1; // Show batch with minimal qty\n        }\n        \n        // Create entries for each warehouse with positive stock\n        Object.keys(warehouseQty).forEach(warehouse => {\n            const qty = warehouseQty[warehouse];\n            if (qty > 0) {\n                const batchItem = {\n                    batch_no: batch.name,\n                    item_code: batch.item,\n                    item_name: item.item_name,\n                    stock_uom: item.stock_uom,\n                    expiry_date: batch.expiry_date,\n                    days_to_expiry: daysToExpiry,\n                    warehouse: warehouse,\n                    available_qty: qty\n                };\n                \n                // Determine status based on days to expiry\n                if (daysToExpiry < expiryThresholds.expired) {\n                    batchItem.status = 'expired';\n                    batchItem.statusLabel = 'EXPIRED';\n                    batchItem.statusClass = 'status-expired';\n                    stats.expired++;\n                } else if (daysToExpiry < expiryThresholds.useImmediately) {\n                    batchItem.status = 'use-immediately';\n                    batchItem.statusLabel = 'USE IMMEDIATELY';\n                    batchItem.statusClass = 'status-use-immediately';\n                    stats.useImmediately++;\n                } else if (daysToExpiry < expiryThresholds.nearExpiry) {\n                    batchItem.status = 'near-expiry';\n                    batchItem.statusLabel = 'NEAR EXPIRY';\n                    batchItem.statusClass = 'status-near-expiry';\n                    stats.nearExpiry++;\n                } else {\n                    batchItem.status = 'healthy';\n                    batchItem.statusLabel = 'HEALTHY';\n                    batchItem.statusClass = 'status-healthy';\n                    stats.healthy++;\n                }\n                \n                items.push(batchItem);\n            }\n        });\n    });\n    \n    // Sort by days to expiry (most urgent first)\n    items.sort((a, b) => a.days_to_expiry - b.days_to_expiry);\n    \n    console.log('Processed batch data:', { totalItems: items.length, stats });\n    \n    return { items, stats };\n}\n\n// Process batch data and calculate status (legacy function for SQL results)\nfunction processBatchData(rawData) {\n    const stats = {\n        expired: 0,\n        useImmediately: 0,\n        nearExpiry: 0,\n        healthy: 0\n    };\n    \n    const items = rawData.map(row => {\n        const batch = {\n            batch_no: row[0],\n            item_code: row[1],\n            item_name: row[2],\n            stock_uom: row[3],\n            expiry_date: row[4],\n            days_to_expiry: row[5],\n            warehouse: row[6],\n            available_qty: row[7]\n        };\n        \n        // Determine status based on days to expiry\n        if (batch.days_to_expiry < expiryThresholds.expired) {\n            batch.status = 'expired';\n            batch.statusLabel = 'EXPIRED';\n            batch.statusClass = 'status-expired';\n            stats.expired++;\n        } else if (batch.days_to_expiry < expiryThresholds.useImmediately) {\n            batch.status = 'use-immediately';\n            batch.statusLabel = 'USE IMMEDIATELY';\n            batch.statusClass = 'status-use-immediately';\n            stats.useImmediately++;\n        } else if (batch.days_to_expiry < expiryThresholds.nearExpiry) {\n            batch.status = 'near-expiry';\n            batch.statusLabel = 'NEAR EXPIRY';\n            batch.statusClass = 'status-near-expiry';\n            stats.nearExpiry++;\n        } else {\n            batch.status = 'healthy';\n            batch.statusLabel = 'HEALTHY';\n            batch.statusClass = 'status-healthy';\n            stats.healthy++;\n        }\n        \n        return batch;\n    });\n    \n    return { items, stats };\n}\n\n// Update expiry stats cards (for expired-only view in main dashboard)\nfunction updateExpiredOnlyStats(expiredCount) {\n    // Use root_element for custom HTML block context\n    $(root_element).find('#expired-count').text(expiredCount);\n    $(root_element).find('#expired-items-badge').text(expiredCount + ' items');\n    \n    // Also try global selectors as fallback\n    $('#expired-count').text(expiredCount);\n    $('#expired-items-badge').text(expiredCount + ' items');\n    \n    console.log('Expired-only stats updated:', expiredCount);\n}\n\n// Update expiry stats cards (for full detailed view)\nfunction updateExpiryStatsCards(stats) {\n    // Use root_element for custom HTML block context\n    $(root_element).find('#expired-count').text(stats.expired);\n    $(root_element).find('#use-immediately-count').text(stats.useImmediately);\n    $(root_element).find('#near-expiry-count').text(stats.nearExpiry);\n    $(root_element).find('#healthy-count').text(stats.healthy);\n    \n    // Also try global selectors as fallback\n    $('#expired-count').text(stats.expired);\n    $('#use-immediately-count').text(stats.useImmediately);\n    $('#near-expiry-count').text(stats.nearExpiry);\n    $('#healthy-count').text(stats.healthy);\n    \n    console.log('Expiry stats updated:', stats);\n}\n\n// Populate batch items table\nlet allBatchItems = []; // Store all items for filtering\n\nfunction populateBatchItemsTable(items) {\n    allBatchItems = items; // Store for filtering\n    \n    // Use root_element for custom HTML block context\n    const tbody = $(root_element).find('#batch-items-tbody');\n    if (tbody.length === 0) {\n        // Fallback to global selector\n        const tbodyGlobal = $('#batch-items-tbody');\n        tbodyGlobal.empty();\n    } else {\n        tbody.empty();\n    }\n    \n    if (items.length === 0) {\n        $(root_element).find('#batch-items-table-wrapper').hide();\n        $(root_element).find('#batch-items-empty').show();\n        $('#batch-items-table-wrapper').hide();\n        $('#batch-items-empty').show();\n        return;\n    }\n    \n    items.forEach(batch => {\n        // Determine expiry days color class\n        let daysClass = 'safe';\n        if (batch.days_to_expiry < 0) {\n            daysClass = 'negative';\n        } else if (batch.days_to_expiry < 180) {\n            daysClass = 'warning';\n        } else if (batch.days_to_expiry < 365) {\n            daysClass = 'caution';\n        }\n        \n        // Format expiry date\n        const expiryDate = batch.expiry_date ? frappe.datetime.str_to_user(batch.expiry_date) : '-';\n        \n        const row = $(`\n            <tr data-status=\"${batch.status}\">\n                <td>\n                    <a href=\"/app/item/${batch.item_code}\" target=\"_blank\">${batch.item_code}</a>\n                </td>\n                <td>${batch.item_name || '-'}</td>\n                <td>${batch.stock_uom || '-'}</td>\n                <td>\n                    <a href=\"/app/batch/${batch.batch_no}\" target=\"_blank\">${batch.batch_no}</a>\n                </td>\n                <td style=\"text-align: right;\">${(batch.available_qty || 0).toFixed(2)}</td>\n                <td>${batch.warehouse || '-'}</td>\n                <td>${expiryDate}</td>\n                <td class=\"expiry-days ${daysClass}\" style=\"text-align: right;\">\n                    ${batch.days_to_expiry}\n                </td>\n                <td>\n                    <span class=\"status-badge ${batch.statusClass}\">\n                        ${batch.statusLabel}\n                    </span>\n                </td>\n            </tr>\n        `);\n        \n        // Append to both root_element tbody and global tbody\n        if (tbody.length > 0) {\n            tbody.append(row);\n        } else {\n            $('#batch-items-tbody').append(row);\n        }\n    });\n    \n    console.log('Batch items table populated with', items.length, 'items');\n}\n\n// Filter batch items by status\nfunction filterBatchItemsByStatus(status) {\n    if (!status) {\n        // Show all items\n        $('#batch-items-tbody tr').show();\n        console.log('Showing all batch items');\n        return;\n    }\n    \n    // Hide all rows first\n    $('#batch-items-tbody tr').hide();\n    \n    // Show only matching status\n    $(`#batch-items-tbody tr[data-status=\"${status}\"]`).show();\n    \n    const visibleCount = $(`#batch-items-tbody tr[data-status=\"${status}\"]`).length;\n    console.log('Filtered batch items by status:', status, 'Count:', visibleCount);\n}\n\n// Show expiry threshold configuration dialog\nfunction showExpiryThresholdDialog() {\n    const dialog = new frappe.ui.Dialog({\n        title: 'Configure Expiry Thresholds',\n        fields: [\n            {\n                fieldname: 'info',\n                fieldtype: 'HTML',\n                options: '<p style=\"margin-bottom: 15px;\">Configure the number of days for each expiry status category. Days are calculated from today\\'s date.</p>'\n            },\n            {\n                label: 'Use Immediately (Orange)',\n                fieldname: 'use_immediately',\n                fieldtype: 'Int',\n                default: expiryThresholds.useImmediately,\n                description: 'Items expiring in less than this many days'\n            },\n            {\n                label: 'Near Expiry (Yellow)',\n                fieldname: 'near_expiry',\n                fieldtype: 'Int',\n                default: expiryThresholds.nearExpiry,\n                description: 'Items expiring between Use Immediately and this value'\n            },\n            {\n                label: 'Healthy (Green)',\n                fieldname: 'healthy',\n                fieldtype: 'Int',\n                default: expiryThresholds.healthy,\n                description: 'Items expiring in more than this many days'\n            },\n            {\n                fieldname: 'example',\n                fieldtype: 'HTML',\n                options: `\n                    <div style=\"margin-top: 15px; padding: 12px; background: #f0f4f8; border-radius: 6px;\">\n                        <strong>Current Settings:</strong><br>\n                        üî¥ Expired: Less than 0 days<br>\n                        üü† Use Immediately: Less than ${expiryThresholds.useImmediately} days (${Math.round(expiryThresholds.useImmediately/30)} months)<br>\n                        üü° Near Expiry: ${expiryThresholds.useImmediately} to ${expiryThresholds.nearExpiry} days (${Math.round(expiryThresholds.useImmediately/30)}-${Math.round(expiryThresholds.nearExpiry/30)} months)<br>\n                        üü¢ Healthy: More than ${expiryThresholds.healthy} days (${Math.round(expiryThresholds.healthy/365)} years)\n                    </div>\n                `\n            }\n        ],\n        primary_action_label: 'Save & Refresh',\n        primary_action: function(values) {\n            // Update thresholds\n            expiryThresholds.useImmediately = values.use_immediately || 180;\n            expiryThresholds.nearExpiry = values.near_expiry || 365;\n            expiryThresholds.healthy = values.healthy || 730;\n            \n            console.log('Expiry thresholds updated:', expiryThresholds);\n            \n            // Reload data with new thresholds\n            loadBatchExpiryData();\n            \n            dialog.hide();\n            \n            frappe.show_alert({\n                message: 'Expiry thresholds updated successfully',\n                indicator: 'green'\n            });\n        }\n    });\n    \n    dialog.show();\n}\n\n// ============================================\n// EXPIRED ITEMS ONLY FUNCTIONS (Main Dashboard)\n// ============================================\n\n// Load warehouses for filter dropdown\nfunction loadWarehouses() {\n    console.log('Loading warehouses for filter...');\n    \n    frappe.db.get_list('Warehouse', {\n        filters: {\n            'disabled': 0\n        },\n        fields: ['name'],\n        limit: 0,\n        order_by: 'name asc'\n    }).then(warehouses => {\n        console.log('Warehouses loaded:', warehouses.length);\n        \n        // Populate warehouse filter dropdown\n        const warehouseSelect = $(root_element).find('#warehouse-filter');\n        const globalWarehouseSelect = $('#warehouse-filter');\n        \n        // Clear existing options except \"All Warehouses\"\n        warehouseSelect.find('option:not(:first)').remove();\n        globalWarehouseSelect.find('option:not(:first)').remove();\n        \n        // Add warehouse options\n        warehouses.forEach(warehouse => {\n            const option = `<option value=\"${warehouse.name}\">${warehouse.name}</option>`;\n            warehouseSelect.append(option);\n            globalWarehouseSelect.append(option);\n        });\n        \n        console.log('Warehouse filter populated with', warehouses.length, 'warehouses');\n    }).catch(error => {\n        console.error('Error loading warehouses:', error);\n    });\n}\n\n// Load expired items only for main dashboard\nfunction loadExpiredItemsOnly() {\n    console.log('=== Loading expired items only for main dashboard ===');\n    \n    // Get selected warehouse filter\n    const selectedWarehouse = $(root_element).find('#warehouse-filter').val() || $('#warehouse-filter').val() || '';\n    console.log('Selected warehouse filter:', selectedWarehouse);\n    \n    // Show loading state\n    $(root_element).find('#batch-items-loading').show();\n    $(root_element).find('#batch-items-table-wrapper').hide();\n    $(root_element).find('#batch-items-empty').hide();\n    $('#batch-items-loading').show();\n    $('#batch-items-table-wrapper').hide();\n    $('#batch-items-empty').hide();\n    \n    // Get batches with expiry dates\n    frappe.db.get_list('Batch', {\n        filters: {\n            'disabled': 0\n        },\n        fields: ['name', 'item', 'expiry_date'],\n        limit: 0\n    }).then(allActiveBatches => {\n        console.log('All active batches:', allActiveBatches.length);\n        \n        // Filter batches that have expiry dates and are expired\n        const today = new Date();\n        const expiredBatches = allActiveBatches.filter(batch => {\n            if (!batch.expiry_date || batch.expiry_date === '' || batch.expiry_date === null) {\n                return false;\n            }\n            const expiryDate = new Date(batch.expiry_date);\n            return expiryDate < today; // Only expired items\n        });\n        \n        console.log('Expired batches found:', expiredBatches.length);\n        \n        if (expiredBatches.length === 0) {\n            console.log('No expired batches found');\n            $(root_element).find('#batch-items-loading').hide();\n            $(root_element).find('#batch-items-empty').show();\n            $('#batch-items-loading').hide();\n            $('#batch-items-empty').show();\n            updateExpiredOnlyStats(0);\n            return;\n        }\n        \n        // Get item details for expired batch items\n        const itemCodes = [...new Set(expiredBatches.map(b => b.item))];\n        \n        return frappe.db.get_list('Item', {\n            filters: {\n                'name': ['in', itemCodes]\n            },\n            fields: ['name', 'item_name', 'stock_uom'],\n            limit: 0\n        }).then(items => {\n            console.log('Items loaded for expired batches:', items.length);\n            \n            // Create item lookup\n            const itemLookup = {};\n            items.forEach(item => {\n                itemLookup[item.name] = item;\n            });\n            \n            // Use ERPNext's proper batch-warehouse relationship via get_batch_qty\n            console.log('Getting batch quantities using ERPNext get_batch_qty function...');\n            \n            // Process each expired batch to get warehouse-wise quantities\n            const batchPromises = expiredBatches.map(batch => {\n                return frappe.call({\n                    method: 'erpnext.stock.doctype.batch.batch.get_batch_qty',\n                    args: {\n                        batch_no: batch.name,\n                        item_code: batch.item,\n                        for_stock_levels: true, // Include expired batches\n                        consider_negative_batches: false\n                    }\n                }).then(response => {\n                    const batchQtyData = response.message || [];\n                    console.log('Batch qty data for', batch.name, ':', batchQtyData);\n                    \n                    // Filter by warehouse if selected\n                    let filteredData = batchQtyData;\n                    if (selectedWarehouse) {\n                        filteredData = batchQtyData.filter(d => d.warehouse === selectedWarehouse);\n                    }\n                    \n                    // Only include warehouses with positive quantities\n                    filteredData = filteredData.filter(d => d.qty > 0);\n                    \n                    return {\n                        batch: batch,\n                        item: itemLookup[batch.item],\n                        warehouseData: filteredData\n                    };\n                });\n            });\n            \n            return Promise.all(batchPromises).then(batchResults => {\n                console.log('All batch results:', batchResults.length);\n                \n                // Process the batch results into expired items\n                const processedExpiredData = processExpiredBatchDataFromBatchQty(batchResults);\n                \n                console.log('Processed expired data:', processedExpiredData);\n                \n                if (processedExpiredData.length > 0) {\n                    console.log('Displaying', processedExpiredData.length, 'expired items');\n                    updateExpiredOnlyStats(processedExpiredData.length);\n                    populateExpiredItemsTable(processedExpiredData);\n                    \n                    $(root_element).find('#batch-items-loading').hide();\n                    $(root_element).find('#batch-items-table-wrapper').show();\n                    $('#batch-items-loading').hide();\n                    $('#batch-items-table-wrapper').show();\n                } else {\n                    console.log('No expired items to display');\n                    $(root_element).find('#batch-items-loading').hide();\n                    $(root_element).find('#batch-items-empty').show();\n                    $('#batch-items-loading').hide();\n                    $('#batch-items-empty').show();\n                    updateExpiredOnlyStats(0);\n                }\n            });\n        });\n    }).catch(error => {\n        console.error('Error loading expired items:', error);\n        $(root_element).find('#batch-items-loading').hide();\n        $(root_element).find('#batch-items-empty').show();\n        $('#batch-items-loading').hide();\n        $('#batch-items-empty').show();\n        updateExpiredOnlyStats(0);\n    });\n}\n\n// Process expired batch data only\nfunction processExpiredBatchData(expiredBatches, itemLookup, stockEntries, selectedWarehouse) {\n    const stockByBatch = {};\n    \n    // Group stock entries by batch_no (proper ERPNext way)\n    stockEntries.forEach(entry => {\n        if (entry.batch_no) {\n            if (!stockByBatch[entry.batch_no]) {\n                stockByBatch[entry.batch_no] = [];\n            }\n            stockByBatch[entry.batch_no].push(entry);\n        }\n    });\n    \n    const expiredItems = [];\n    const today = new Date();\n    \n    expiredBatches.forEach(batch => {\n        const item = itemLookup[batch.item];\n        if (!item) return;\n        \n        // Calculate days overdue (negative days to expiry)\n        const expiryDate = new Date(batch.expiry_date);\n        const timeDiff = today.getTime() - expiryDate.getTime();\n        const daysOverdue = Math.ceil(timeDiff / (1000 * 3600 * 24));\n        \n        // Get stock entries for this specific batch (proper ERPNext way)\n        const batchStockEntries = stockByBatch[batch.name] || [];\n        \n        // Group by warehouse and calculate total qty per warehouse for this batch\n        const warehouseQty = {};\n        batchStockEntries.forEach(entry => {\n            if (!warehouseQty[entry.warehouse]) {\n                warehouseQty[entry.warehouse] = 0;\n            }\n            warehouseQty[entry.warehouse] += entry.actual_qty || 0;\n        });\n        \n        // Create entries for each warehouse with positive stock for this batch\n        Object.keys(warehouseQty).forEach(warehouse => {\n            const qty = warehouseQty[warehouse];\n            if (qty > 0) {\n                const expiredItem = {\n                    batch_no: batch.name,\n                    item_code: batch.item,\n                    item_name: item.item_name,\n                    stock_uom: item.stock_uom,\n                    expiry_date: batch.expiry_date,\n                    days_overdue: daysOverdue,\n                    warehouse: warehouse,\n                    available_qty: qty\n                };\n                \n                expiredItems.push(expiredItem);\n            }\n        });\n        \n        // Only show batches that have stock entries (no fallback for expired items)\n        // This ensures warehouse filtering works correctly\n    });\n    \n    // Sort by days overdue (most overdue first)\n    expiredItems.sort((a, b) => b.days_overdue - a.days_overdue);\n    \n    console.log('Processed expired items:', expiredItems.length);\n\n    return expiredItems;\n}\n\n// Create fallback expired data when no Stock Ledger Entries found\nfunction createFallbackExpiredData(expiredBatches, itemLookup, selectedWarehouse) {\n    const fallbackItems = [];\n    const today = new Date();\n\n    expiredBatches.forEach(batch => {\n        const item = itemLookup[batch.item];\n        if (!item) return;\n\n        // Skip if warehouse filter is applied (can't determine warehouse without SLE)\n        if (selectedWarehouse) {\n            return; // Don't show fallback data when warehouse filter is active\n        }\n\n        // Calculate days overdue\n        const expiryDate = new Date(batch.expiry_date);\n        const timeDiff = today.getTime() - expiryDate.getTime();\n        const daysOverdue = Math.ceil(timeDiff / (1000 * 3600 * 24));\n\n        const fallbackItem = {\n            batch_no: batch.name,\n            item_code: batch.item,\n            item_name: item.item_name,\n            stock_uom: item.stock_uom,\n            expiry_date: batch.expiry_date,\n            days_overdue: daysOverdue,\n            warehouse: 'Not Available',\n            available_qty: 'N/A'\n        };\n\n        fallbackItems.push(fallbackItem);\n    });\n\n    // Sort by days overdue (most overdue first)\n    fallbackItems.sort((a, b) => b.days_overdue - a.days_overdue);\n\n    console.log('Created fallback expired items:', fallbackItems.length);\n\n    return fallbackItems;\n}\n\n// Process expired batch data from get_batch_qty results (proper ERPNext way)\nfunction processExpiredBatchDataFromBatchQty(batchResults) {\n    const expiredItems = [];\n    const today = new Date();\n            \n    batchResults.forEach(result => {\n        const { batch, item, warehouseData } = result;\n                \n        if (!item || !warehouseData || warehouseData.length === 0) {\n            return;\n        }\n                \n        // Calculate days overdue\n        const expiryDate = new Date(batch.expiry_date);\n        const timeDiff = today.getTime() - expiryDate.getTime();\n        const daysOverdue = Math.ceil(timeDiff / (1000 * 3600 * 24));\n                \n        // Create entries for each warehouse with stock\n        warehouseData.forEach(warehouseEntry => {\n            if (warehouseEntry.qty > 0) {\n                const expiredItem = {\n                    batch_no: batch.name,\n                    item_code: batch.item,\n                    item_name: item.item_name,\n                    stock_uom: item.stock_uom,\n                    expiry_date: batch.expiry_date,\n                    days_overdue: daysOverdue,\n                    warehouse: warehouseEntry.warehouse,\n                    available_qty: warehouseEntry.qty\n                };\n                        \n                expiredItems.push(expiredItem);\n            }\n        });\n    });\n            \n    // Sort by days overdue (most overdue first)\n    expiredItems.sort((a, b) => b.days_overdue - a.days_overdue);\n            \n    console.log('Processed expired items from batch qty:', expiredItems.length);\n            \n    return expiredItems;\n}\n\n// Populate expired items table (simplified for main dashboard)\nfunction populateExpiredItemsTable(expiredItems) {\n    // Use root_element for custom HTML block context\n    const tbody = $(root_element).find('#batch-items-tbody');\n    if (tbody.length === 0) {\n        // Fallback to global selector\n        const tbodyGlobal = $('#batch-items-tbody');\n        tbodyGlobal.empty();\n    } else {\n        tbody.empty();\n    }\n    \n    if (expiredItems.length === 0) {\n        $(root_element).find('#batch-items-table-wrapper').hide();\n        $(root_element).find('#batch-items-empty').show();\n        $('#batch-items-table-wrapper').hide();\n        $('#batch-items-empty').show();\n        return;\n    }\n    \n    expiredItems.forEach(item => {\n        // Format expiry date\n        const expiryDate = item.expiry_date ? frappe.datetime.str_to_user(item.expiry_date) : '-';\n        \n        const row = $(`\n            <tr class=\"expired-row\">\n                <td>\n                    <a href=\"/app/item/${item.item_code}\" target=\"_blank\">${item.item_code}</a>\n                </td>\n                <td>${item.item_name || '-'}</td>\n                <td>${item.stock_uom || '-'}</td>\n                <td>\n                    <a href=\"/app/batch/${item.batch_no}\" target=\"_blank\">${item.batch_no}</a>\n                </td>\n                <td style=\"text-align: right;\">${(item.available_qty || 0).toFixed(2)}</td>\n                <td>${item.warehouse || '-'}</td>\n                <td>${expiryDate}</td>\n                <td class=\"days-overdue\" style=\"text-align: right;\">\n                    ${item.days_overdue} days\n                </td>\n            </tr>\n        `);\n        \n        // Append to both root_element tbody and global tbody\n        if (tbody.length > 0) {\n            tbody.append(row);\n        } else {\n            $('#batch-items-tbody').append(row);\n        }\n    });\n    \n    console.log('Expired items table populated with', expiredItems.length, 'items');\n}\n\nconsole.log('Pharmacy Dashboard JavaScript loaded successfully');\n",
  "style": "/* Complete Executive Dashboard - Fixed Whitelisted Functions */\n.complete-executive-dashboard {\n    max-width: 100%;\n    margin: 0 auto;\n}\n\n.complete-executive-dashboard > div {\n    margin-bottom: 20px;\n}\n\n/* KPI Cards Styles */\n/* Executive Dashboard KPI Cards Styles */\n.executive-dashboard-kpis {\n    padding: 20px;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    border-radius: 12px;\n    margin-bottom: 20px;\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);\n}\n\n.dashboard-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 25px;\n    flex-wrap: wrap;\n    gap: 15px;\n}\n\n.dashboard-title {\n    color: white;\n    margin: 0;\n    font-size: 1.5rem;\n    font-weight: 600;\n    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);\n}\n\n.dashboard-controls {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n#branch-selector {\n    background: rgba(255, 255, 255, 0.9);\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    border-radius: 6px;\n    color: #374151;\n    font-size: 14px;\n}\n\n#refresh-dashboard {\n    background: rgba(255, 255, 255, 0.2);\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    color: white;\n    border-radius: 6px;\n    padding: 8px 16px;\n    font-size: 14px;\n    transition: all 0.3s ease;\n}\n\n#refresh-dashboard:hover {\n    background: rgba(255, 255, 255, 0.3);\n    transform: translateY(-1px);\n}\n\n.kpi-cards-container {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));\n    gap: 15px;\n}\n\n.kpi-card {\n    background: rgba(255, 255, 255, 0.95);\n    backdrop-filter: blur(10px);\n    border-radius: 12px;\n    padding: 24px;\n    display: flex;\n    align-items: center;\n    gap: 20px;\n    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    position: relative;\n    overflow: hidden;\n    min-width: 0;\n}\n\n/* Clickable card styles */\n.clickable-card {\n    cursor: pointer;\n}\n\n.clickable-card:hover {\n    transform: translateY(-4px);\n    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);\n    background: rgba(255, 255, 255, 1);\n}\n\n.clickable-card:hover::before {\n    transform: scaleX(1);\n}\n\n.clickable-card:active {\n    transform: translateY(-2px);\n    transition: transform 0.1s ease;\n}\n\n.kpi-card::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 4px;\n    background: linear-gradient(90deg, #667eea, #764ba2);\n    transform: scaleX(0);\n    transition: transform 0.3s ease;\n}\n\n.kpi-card:hover {\n    transform: translateY(-4px);\n    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);\n}\n\n.kpi-card:hover::before {\n    transform: scaleX(1);\n}\n\n.kpi-icon {\n    font-size: 2.5rem;\n    line-height: 1;\n    opacity: 0.8;\n}\n\n.kpi-content {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 4px;\n}\n\n.kpi-value {\n    font-size: 1.8rem;\n    font-weight: 700;\n    color: #1f2937;\n    line-height: 1.2;\n}\n\n.kpi-label {\n    font-size: 0.9rem;\n    color: #6b7280;\n    font-weight: 500;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.kpi-growth {\n    font-size: 0.85rem;\n    font-weight: 600;\n    margin-top: 4px;\n}\n\n/* Split Card Layout for Item Movement */\n.kpi-content-split {\n    display: flex;\n    align-items: center;\n    width: 100%;\n    gap: 0;\n}\n\n.kpi-section {\n    flex: 1;\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 0 12px;\n}\n\n.kpi-section .kpi-icon {\n    display: none;\n}\n\n.kpi-section .kpi-content {\n    min-width: 0;\n    flex: 1;\n    overflow: hidden;\n}\n\n.kpi-section .kpi-value {\n    font-size: 1rem;\n    line-height: 1.2;\n    word-wrap: break-word;\n    overflow-wrap: break-word;\n    max-width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n    white-space: normal;\n}\n\n.kpi-section .kpi-label {\n    font-size: 0.75rem;\n}\n\n.kpi-section .kpi-growth {\n    font-size: 0.75rem;\n}\n\n.kpi-divider {\n    width: 2px;\n    height: 60px;\n    background: linear-gradient(180deg, transparent, rgba(0, 0, 0, 0.1), transparent);\n    margin: 0 8px;\n    flex-shrink: 0;\n}\n\n.fast-moving-section .kpi-icon {\n    color: #10b981;\n}\n\n.slow-moving-section .kpi-icon {\n    color: #f59e0b;\n}\n\n/* Responsive Design */\n@media (max-width: 768px) {\n    .executive-dashboard-kpis {\n        padding: 15px;\n    }\n    \n    .dashboard-header {\n        flex-direction: column;\n        align-items: stretch;\n    }\n    \n    .dashboard-controls {\n        justify-content: center;\n    }\n    \n    .kpi-cards-container {\n        grid-template-columns: 1fr;\n        gap: 15px;\n    }\n    \n    .kpi-card {\n        padding: 20px;\n    }\n    \n    .kpi-value {\n        font-size: 1.5rem;\n    }\n}\n\n/* Loading Animation */\n.kpi-card.loading {\n    opacity: 0.7;\n}\n\n.kpi-card.loading .kpi-value::after {\n    content: '';\n    display: inline-block;\n    width: 12px;\n    height: 12px;\n    border: 2px solid #e5e7eb;\n    border-top: 2px solid #3b82f6;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin-left: 8px;\n}\n\n@keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\n/* Performance Analytics Charts - EXPLICIT BOXES WITH FIXED FUNCTIONS */\n.executive-dashboard-charts {\n    background: white !important;\n    border-radius: 12px !important;\n    padding: 20px !important;\n    margin-bottom: 20px !important;\n    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08) !important;\n    border: 1px solid #e5e7eb !important;\n}\n\n.charts-header {\n    display: flex !important;\n    justify-content: space-between !important;\n    align-items: center !important;\n    margin-bottom: 20px !important;\n    padding-bottom: 12px !important;\n    border-bottom: 2px solid #f3f4f6 !important;\n}\n\n.charts-title {\n    color: #1f2937 !important;\n    margin: 0 !important;\n    font-size: 1.1rem !important;\n    font-weight: 600 !important;\n}\n\n.charts-controls {\n    display: flex !important;\n    align-items: center !important;\n    gap: 10px !important;\n}\n\n#refresh-charts {\n    border-radius: 6px !important;\n    font-size: 12px !important;\n    padding: 5px 10px !important;\n    transition: all 0.3s ease !important;\n}\n\n/* Charts Grid - FORCE PROPER BOXES */\n.charts-grid {\n    display: grid !important;\n    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)) !important;\n    gap: 20px !important;\n}\n\n.chart-card {\n    background: #ffffff !important;\n    border-radius: 8px !important;\n    border: 2px solid #e5e7eb !important;\n    padding: 20px !important;\n    transition: all 0.3s ease !important;\n    min-height: 300px !important;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;\n    position: relative !important;\n}\n\n.chart-card:hover {\n    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15) !important;\n    transform: translateY(-2px) !important;\n    border-color: #d1d5db !important;\n}\n\n.chart-header {\n    display: flex !important;\n    align-items: center !important;\n    gap: 8px !important;\n    margin-bottom: 15px !important;\n    padding-bottom: 10px !important;\n    border-bottom: 1px solid #f3f4f6 !important;\n}\n\n.chart-icon {\n    font-size: 1.2rem !important;\n}\n\n.chart-title {\n    font-weight: 600 !important;\n    color: #374151 !important;\n    font-size: 0.9rem !important;\n    flex: 1 !important;\n}\n\n.chart-container {\n    height: 240px !important;\n    width: 100% !important;\n    display: flex !important;\n    align-items: center !important;\n    justify-content: center !important;\n    background: #fafafa !important;\n    border-radius: 4px !important;\n    border: 1px solid #f0f0f0 !important;\n}\n\n.chart-loading {\n    color: #6b7280 !important;\n    font-size: 0.85rem !important;\n    text-align: center !important;\n}\n\n.chart-error {\n    color: #ef4444 !important;\n    font-size: 0.85rem !important;\n    text-align: center !important;\n}\n\n/* Chart Specific Styling - STRONG VISUAL DISTINCTION */\n.enquiry-chart {\n    border-left: 5px solid #3b82f6 !important;\n    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%) !important;\n}\n\n.sales-chart {\n    border-left: 5px solid #22c55e !important;\n    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%) !important;\n}\n\n.stock-ageing-chart {\n    border-left: 5px solid #f59e0b !important;\n    background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%) !important;\n}\n\n.refurb-pipeline-chart {\n    border-left: 5px solid #8b5cf6 !important;\n    background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%) !important;\n}\n\n/* Branch Performance Summary Styles */\n/* Branch Performance Summary - Smaller Boxes */\n.branch-performance-summary {\n    background: white;\n    border-radius: 12px;\n    padding: 15px;\n    margin-bottom: 20px;\n    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);\n    border: 1px solid #e5e7eb;\n}\n\n.summary-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 15px;\n    padding-bottom: 10px;\n    border-bottom: 2px solid #f3f4f6;\n}\n\n.summary-title {\n    color: #1f2937;\n    margin: 0;\n    font-size: 1rem;\n    font-weight: 600;\n}\n\n.summary-controls {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n#branch-selector {\n    border-radius: 6px;\n    font-size: 11px;\n    padding: 3px 6px;\n    min-width: 100px;\n}\n\n#refresh-summary {\n    border-radius: 6px;\n    font-size: 11px;\n    padding: 4px 8px;\n    transition: all 0.3s ease;\n}\n\n#refresh-summary:hover {\n    transform: translateY(-1px);\n}\n\n/* Performance Cards Grid - Smaller Boxes */\n.performance-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\n    gap: 10px;\n}\n\n.performance-card {\n    background: #fafbfc;\n    border-radius: 6px;\n    border: 1px solid #e5e7eb;\n    padding: 8px;\n    transition: all 0.3s ease;\n    min-height: 85px;\n}\n\n.performance-card:hover {\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n    transform: translateY(-1px);\n}\n\n.performance-header {\n    display: flex;\n    align-items: center;\n    gap: 6px;\n    margin-bottom: 6px;\n    padding-bottom: 6px;\n    border-bottom: 1px solid #f3f4f6;\n}\n\n.performance-icon {\n    font-size: 1rem;\n}\n\n.performance-title {\n    font-weight: 600;\n    color: #374151;\n    font-size: 0.75rem;\n    flex: 1;\n    line-height: 1.2;\n}\n\n.performance-content {\n    text-align: center;\n}\n\n.performance-value {\n    font-size: 1.1rem;\n    font-weight: 700;\n    color: #1f2937;\n    margin-bottom: 2px;\n    line-height: 1.1;\n}\n\n.performance-label {\n    font-size: 0.65rem;\n    color: #6b7280;\n    font-weight: 500;\n    margin-bottom: 3px;\n}\n\n.performance-growth {\n    font-size: 0.6rem;\n    font-weight: 600;\n    padding: 1px 4px;\n    border-radius: 2px;\n    display: inline-block;\n}\n\n.growth-positive {\n    background: #dcfce7;\n    color: #16a34a;\n}\n\n.growth-negative {\n    background: #fee2e2;\n    color: #dc2626;\n}\n\n.growth-neutral {\n    background: #f3f4f6;\n    color: #6b7280;\n}\n\n/* Card specific colors - 3px borders */\n.enquiry-performance { border-left: 3px solid #3b82f6; }\n.sales-performance { border-left: 3px solid #22c55e; }\n.procurement-performance { border-left: 3px solid #f59e0b; }\n.stock-status { border-left: 3px solid #8b5cf6; }\n\n/* Responsive Design */\n@media (max-width: 768px) {\n    .branch-performance-summary {\n        padding: 10px;\n    }\n    \n    .summary-header {\n        flex-direction: column;\n        gap: 8px;\n        align-items: stretch;\n        margin-bottom: 10px;\n    }\n    \n    .summary-controls {\n        justify-content: center;\n    }\n    \n    .performance-grid {\n        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n        gap: 8px;\n    }\n    \n    .performance-card {\n        min-height: 75px;\n        padding: 6px;\n    }\n    \n    .performance-value {\n        font-size: 1rem;\n    }\n    \n    .performance-title {\n        font-size: 0.7rem;\n    }\n    \n    .summary-title {\n        font-size: 0.9rem;\n    }\n}\n\n@media (max-width: 480px) {\n    .performance-grid {\n        grid-template-columns: 1fr 1fr;\n    }\n    \n    .performance-card {\n        min-height: 70px;\n    }\n}\n\n/* Vehicle Stock Summary Styles */\n/* Vehicle Stock Summary - ALL Compact Design Features */\n.vehicle-stock-status {\n    background: white;\n    border-radius: 12px;\n    padding: 15px;\n    margin-bottom: 20px;\n    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);\n    border: 1px solid #e5e7eb;\n}\n\n.stock-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 20px;\n    padding-bottom: 12px;\n    border-bottom: 2px solid #f3f4f6;\n}\n\n.stock-title {\n    color: #1f2937;\n    margin: 0;\n    font-size: 1.1rem;\n    font-weight: 600;\n}\n\n.section-heading {\n    color: #374151;\n    margin: 20px 0 15px 0;\n    font-size: 1rem;\n    font-weight: 600;\n    padding-bottom: 8px;\n    border-bottom: 1px solid #e5e7eb;\n}\n\n.stock-controls {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n}\n\n#refresh-stock {\n    border-radius: 6px;\n    font-size: 12px;\n    padding: 5px 10px;\n    transition: all 0.3s ease;\n}\n\n#refresh-stock:hover {\n    transform: translateY(-1px);\n}\n\n/* Summary View - Compact Spacing */\n.stock-summary-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n    gap: 12px;\n    margin-bottom: 15px;\n}\n\n.stock-summary-card {\n    background: #fafbfc;\n    border-radius: 8px;\n    border: 1px solid #e5e7eb;\n    padding: 12px;\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    transition: all 0.3s ease;\n    min-height: 70px;\n}\n\n.stock-summary-card:hover {\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n    transform: translateY(-1px);\n}\n\n.summary-icon {\n    font-size: 1.5rem;\n    opacity: 0.8;\n}\n\n.summary-content {\n    flex: 1;\n}\n\n.summary-value {\n    font-size: 1.3rem;\n    font-weight: 700;\n    color: #1f2937;\n    line-height: 1.1;\n}\n\n.summary-label {\n    font-size: 0.8rem;\n    color: #6b7280;\n    font-weight: 500;\n    margin-top: 2px;\n}\n\n.summary-sublabel {\n    font-size: 0.75rem;\n    color: #9ca3af;\n    margin-top: 2px;\n}\n\n/* Card specific colors - 3px borders */\n.total-stock { border-left: 3px solid #3b82f6; }\n.available-stock { border-left: 3px solid #22c55e; }\n.sold-stock { border-left: 3px solid #f59e0b; }\n.refurb-stock { border-left: 3px solid #8b5cf6; }\n\n/* Ageing Analysis - Compact Spacing */\n.ageing-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 12px;\n    margin-bottom: 15px;\n}\n\n.ageing-card {\n    background: #fafbfc;\n    border-radius: 8px;\n    border: 1px solid #e5e7eb;\n    padding: 12px;\n    transition: all 0.3s ease;\n    min-height: 120px;\n}\n\n.ageing-card:hover {\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n    transform: translateY(-1px);\n}\n\n.ageing-header {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    margin-bottom: 10px;\n    padding-bottom: 8px;\n    border-bottom: 1px solid #f3f4f6;\n}\n\n.ageing-icon {\n    font-size: 1.2rem;\n}\n\n.ageing-title {\n    font-weight: 600;\n    color: #374151;\n    flex: 1;\n    font-size: 0.85rem;\n}\n\n.ageing-color {\n    font-size: 0.7rem;\n    font-weight: 500;\n    padding: 1px 6px;\n    border-radius: 3px;\n    background: #f3f4f6;\n    color: #6b7280;\n}\n\n.ageing-content {\n    text-align: center;\n}\n\n.ageing-count {\n    font-size: 1.8rem;\n    font-weight: 700;\n    color: #1f2937;\n    margin-bottom: 4px;\n}\n\n.ageing-value {\n    font-size: 0.8rem;\n    color: #6b7280;\n    font-weight: 500;\n}\n\n/* Ageing card specific colors - 3px borders */\n.gold-stock { border-left: 3px solid #fbbf24; }\n.green-stock { border-left: 3px solid #22c55e; }\n.yellow-stock { border-left: 3px solid #f59e0b; }\n.red-stock { border-left: 3px solid #ef4444; }\n\n/* Refurbishment Ageing - Compact Spacing */\n.refurb-ageing-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));\n    gap: 12px;\n}\n\n.refurb-ageing-card {\n    background: #fafbfc;\n    border-radius: 8px;\n    border: 1px solid #e5e7eb;\n    padding: 15px;\n    transition: all 0.3s ease;\n    min-height: 140px;\n}\n\n.refurb-ageing-card:hover {\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);\n    transform: translateY(-1px);\n}\n\n.refurb-header {\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    margin-bottom: 12px;\n    padding-bottom: 10px;\n    border-bottom: 1px solid #f3f4f6;\n}\n\n.refurb-icon {\n    font-size: 1.4rem;\n}\n\n.refurb-title {\n    font-weight: 600;\n    color: #374151;\n    font-size: 0.95rem;\n    flex: 1;\n}\n\n.refurb-period {\n    font-size: 0.75rem;\n    color: #6b7280;\n    font-style: italic;\n}\n\n.refurb-content {\n    text-align: center;\n}\n\n.refurb-count {\n    font-size: 2rem;\n    font-weight: 700;\n    color: #1f2937;\n    margin-bottom: 6px;\n}\n\n.refurb-percentage {\n    font-size: 1rem;\n    font-weight: 600;\n    color: #6b7280;\n    margin-bottom: 8px;\n}\n\n.refurb-status {\n    font-size: 0.8rem;\n    font-weight: 600;\n    padding: 3px 8px;\n    border-radius: 4px;\n    display: inline-block;\n}\n\n/* Refurb card specific colors - 3px borders */\n.ideal-refurb { border-left: 3px solid #22c55e; }\n.ideal-refurb .refurb-status {\n    background: #dcfce7;\n    color: #16a34a;\n}\n\n.delayed-refurb { border-left: 3px solid #ef4444; }\n.delayed-refurb .refurb-status {\n    background: #fee2e2;\n    color: #dc2626;\n}\n\n/* Section Spacing - 15px margins */\n.stock-view {\n    margin-bottom: 15px;\n}\n\n.stock-view:last-child {\n    margin-bottom: 0;\n}\n\n/* Responsive Design */\n@media (max-width: 768px) {\n    .vehicle-stock-status {\n        padding: 12px;\n    }\n    \n    .stock-header {\n        flex-direction: column;\n        gap: 10px;\n        align-items: stretch;\n    }\n    \n    .stock-controls {\n        justify-content: center;\n    }\n    \n    .stock-summary-grid,\n    .ageing-grid,\n    .refurb-ageing-grid {\n        grid-template-columns: 1fr;\n        gap: 10px;\n    }\n    \n    .ageing-card,\n    .refurb-ageing-card {\n        min-height: auto;\n    }\n    \n    .section-heading {\n        font-size: 0.9rem;\n        margin: 15px 0 10px 0;\n    }\n}\n\n/* Responsive Design */\n@media (max-width: 768px) {\n    .charts-grid {\n        grid-template-columns: 1fr !important;\n        gap: 15px !important;\n    }\n    \n    .chart-card {\n        min-height: 250px !important;\n    }\n    \n    .chart-container {\n        height: 200px !important;\n    }\n}\n\n/* Central Warehouse Items Section */\n.central-warehouse-section {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n    margin: 20px 0;\n    padding: 24px;\n}\n\n.central-warehouse-section .section-header {\n    margin-bottom: 20px;\n}\n\n.central-warehouse-section .section-title {\n    font-size: 1.5rem;\n    font-weight: 600;\n    color: #1f2937;\n    margin: 0 0 8px 0;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.central-warehouse-section .section-subtitle {\n    color: #6b7280;\n    font-size: 0.9rem;\n    margin: 0;\n}\n\n.central-items-container {\n    min-height: 120px;\n}\n\n.central-items-loading {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 12px;\n    padding: 40px;\n    color: #6b7280;\n}\n\n.central-items-list {\n    margin-top: 16px;\n    max-height: 400px;\n    overflow-y: auto;\n    border: 1px solid #e2e8f0;\n    border-radius: 8px;\n    background: #ffffff;\n}\n\n.central-item-row {\n    display: flex;\n    align-items: center;\n    padding: 12px 16px;\n    border-bottom: 1px solid #f1f5f9;\n    transition: background-color 0.2s ease;\n    cursor: pointer;\n}\n\n.central-item-row:last-child {\n    border-bottom: none;\n}\n\n.central-item-row:hover {\n    background-color: #f8fafc;\n}\n\n.central-item-link {\n    flex: 1;\n    text-decoration: none;\n    color: #1f2937;\n    display: flex;\n    align-items: center;\n    gap: 12px;\n}\n\n.central-item-link:hover {\n    color: #3b82f6;\n}\n\n.central-item-name {\n    font-weight: 500;\n    font-size: 0.9rem;\n    flex: 1;\n}\n\n.central-item-code {\n    color: #6b7280;\n    font-size: 0.8rem;\n    font-family: 'Courier New', monospace;\n    background: #f1f5f9;\n    padding: 2px 6px;\n    border-radius: 3px;\n    min-width: 120px;\n    text-align: center;\n}\n\n.central-item-stock {\n    color: #059669;\n    font-size: 0.8rem;\n    font-weight: 500;\n    min-width: 80px;\n    text-align: right;\n}\n\n.central-item-icon {\n    color: #3b82f6;\n    font-size: 0.8rem;\n}\n\n.empty-state {\n    text-align: center;\n    padding: 40px;\n    color: #6b7280;\n}\n\n.empty-icon {\n    font-size: 3rem;\n    margin-bottom: 12px;\n}\n\n.empty-text {\n    font-size: 1.1rem;\n}\n\n/* Batch Expiry Status Section - Expired Items Only */\n.batch-expiry-section {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n    margin: 20px 0;\n    padding: 24px;\n    border-left: 4px solid #dc2626; /* Red border for expired alert */\n}\n\n/* Warehouse Items Section */\n.warehouse-items-section {\n    background: white;\n    border-radius: 12px;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n    margin: 20px 0;\n    padding: 24px;\n}\n\n.warehouse-items-section .section-header {\n    margin-bottom: 20px;\n}\n\n.warehouse-items-section .section-title-row {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-bottom: 8px;\n}\n\n.warehouse-items-section .section-title {\n    font-size: 1.5rem;\n    font-weight: 600;\n    color: #1f2937;\n    margin: 0;\n}\n\n.warehouse-badge {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    padding: 6px 14px;\n    border-radius: 20px;\n    font-size: 0.85rem;\n    font-weight: 500;\n}\n\n.warehouse-items-section .section-subtitle {\n    color: #6b7280;\n    font-size: 0.95rem;\n}\n\n/* Warehouse Stats Row */\n.warehouse-stats-row {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 16px;\n    margin-bottom: 24px;\n}\n\n.warehouse-stat-card {\n    background: linear-gradient(135deg, #f6f8fb 0%, #ffffff 100%);\n    border: 1px solid #e5e7eb;\n    border-radius: 10px;\n    padding: 16px;\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    transition: all 0.3s ease;\n}\n\n.warehouse-stat-card:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n.warehouse-stat-card .stat-icon {\n    font-size: 2rem;\n    opacity: 0.8;\n}\n\n.warehouse-stat-card .stat-content {\n    flex: 1;\n}\n\n.warehouse-stat-card .stat-value {\n    font-size: 1.5rem;\n    font-weight: 700;\n    color: #1f2937;\n    margin-bottom: 4px;\n}\n\n.warehouse-stat-card .stat-label {\n    font-size: 0.85rem;\n    color: #6b7280;\n    font-weight: 500;\n}\n\n/* Warehouse Items Container */\n.warehouse-items-container {\n    position: relative;\n    min-height: 200px;\n}\n\n.warehouse-items-loading {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 40px;\n    gap: 12px;\n}\n\n.warehouse-items-loading .loading-spinner {\n    width: 40px;\n    height: 40px;\n    border: 4px solid #f3f4f6;\n    border-top-color: #667eea;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n}\n\n/* Warehouse Items Table */\n.warehouse-items-table-wrapper {\n    overflow-x: auto;\n    border-radius: 8px;\n    border: 1px solid #e5e7eb;\n}\n\n.warehouse-items-table {\n    width: 100%;\n    border-collapse: collapse;\n    font-size: 0.9rem;\n}\n\n.warehouse-items-table thead {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n}\n\n.warehouse-items-table thead th {\n    padding: 14px 16px;\n    text-align: left;\n    font-weight: 600;\n    font-size: 0.85rem;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.warehouse-items-table thead th.text-right {\n    text-align: right;\n}\n\n.warehouse-items-table tbody tr {\n    border-bottom: 1px solid #e5e7eb;\n    transition: background-color 0.2s ease;\n}\n\n.warehouse-items-table tbody tr:hover {\n    background-color: #f9fafb;\n}\n\n.warehouse-items-table tbody tr:last-child {\n    border-bottom: none;\n}\n\n.warehouse-items-table tbody td {\n    padding: 12px 16px;\n    color: #374151;\n}\n\n.warehouse-items-table tbody td.text-right {\n    text-align: right;\n    font-weight: 500;\n}\n\n.warehouse-items-table tbody td a {\n    color: #667eea;\n    text-decoration: none;\n    font-weight: 500;\n    transition: color 0.2s ease;\n}\n\n.warehouse-items-table tbody td a:hover {\n    color: #764ba2;\n    text-decoration: underline;\n}\n\n.warehouse-items-table .item-code-cell {\n    font-family: 'Courier New', monospace;\n    font-weight: 600;\n}\n\n.warehouse-items-table .qty-positive {\n    color: #10b981;\n}\n\n.warehouse-items-table .qty-low {\n    color: #f59e0b;\n}\n\n.warehouse-items-table .qty-zero {\n    color: #6b7280;\n}\n\n.warehouse-items-empty {\n    padding: 60px 20px;\n}\n\n/* Responsive Design for Warehouse Section */\n@media (max-width: 768px) {\n    .warehouse-stats-row {\n        grid-template-columns: 1fr;\n    }\n    \n    .warehouse-items-table {\n        font-size: 0.8rem;\n    }\n    \n    .warehouse-items-table thead th,\n    .warehouse-items-table tbody td {\n        padding: 10px 12px;\n    }\n}\n\n/* ============================================\n   BATCH EXPIRY STATUS SECTION\n   ============================================ */\n\n.batch-expiry-section {\n    background: white;\n    border-radius: 12px;\n    padding: 24px;\n    margin-bottom: 24px;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);\n}\n\n/* Expiry Stats Row */\n.expiry-stats-row {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 16px;\n    margin-bottom: 24px;\n}\n\n.expiry-stat-card {\n    background: white;\n    border-radius: 10px;\n    padding: 20px;\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    border: 2px solid #e5e7eb;\n    transition: all 0.3s ease;\n}\n\n.expiry-stat-card:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n.expiry-stat-card .stat-icon {\n    font-size: 32px;\n    line-height: 1;\n}\n\n.expiry-stat-card .stat-content {\n    flex: 1;\n}\n\n.expiry-stat-card .stat-value {\n    font-size: 28px;\n    font-weight: 700;\n    margin-bottom: 4px;\n}\n\n.expiry-stat-card .stat-label {\n    font-size: 13px;\n    color: #6b7280;\n    font-weight: 500;\n}\n\n/* Color-coded stat cards */\n.expired-card {\n    border-color: #ef4444;\n    background: linear-gradient(135deg, #fef2f2 0%, white 100%);\n}\n\n.expired-card .stat-value {\n    color: #dc2626;\n}\n\n.use-immediately-card {\n    border-color: #f97316;\n    background: linear-gradient(135deg, #fff7ed 0%, white 100%);\n}\n\n.use-immediately-card .stat-value {\n    color: #ea580c;\n}\n\n.near-expiry-card {\n    border-color: #eab308;\n    background: linear-gradient(135deg, #fefce8 0%, white 100%);\n}\n\n.near-expiry-card .stat-value {\n    color: #ca8a04;\n}\n\n.healthy-card {\n    border-color: #22c55e;\n    background: linear-gradient(135deg, #f0fdf4 0%, white 100%);\n}\n\n.healthy-card .stat-value {\n    color: #16a34a;\n}\n\n/* Batch Items Container */\n.batch-items-container {\n    background: #f9fafb;\n    border-radius: 8px;\n    padding: 20px;\n}\n\n.batch-items-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n}\n\n.batch-items-header h4 {\n    margin: 0;\n    font-size: 18px;\n    font-weight: 600;\n    color: #1f2937;\n}\n\n.batch-filters {\n    display: flex;\n    gap: 10px;\n    align-items: center;\n}\n\n/* Batch Items Table */\n.batch-items-table-wrapper {\n    background: white;\n    border-radius: 8px;\n    overflow: hidden;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.batch-items-table {\n    width: 100%;\n    margin: 0;\n    border-collapse: collapse;\n}\n\n.batch-items-table thead {\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n}\n\n.batch-items-table thead th {\n    color: white;\n    font-weight: 600;\n    font-size: 13px;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n    padding: 14px 16px;\n    text-align: left;\n    border: none;\n}\n\n.batch-items-table tbody tr {\n    border-bottom: 1px solid #e5e7eb;\n    transition: background-color 0.2s ease;\n}\n\n.batch-items-table tbody tr:hover {\n    background-color: #f9fafb;\n}\n\n.batch-items-table tbody tr:last-child {\n    border-bottom: none;\n}\n\n.batch-items-table tbody td {\n    padding: 14px 16px;\n    font-size: 14px;\n    color: #374151;\n}\n\n.batch-items-table tbody td:first-child {\n    font-weight: 600;\n    color: #1f2937;\n}\n\n/* Status Badges */\n.status-badge {\n    display: inline-block;\n    padding: 6px 12px;\n    border-radius: 20px;\n    font-size: 12px;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.status-expired {\n    background: #fee2e2;\n    color: #dc2626;\n    border: 1px solid #fecaca;\n}\n\n.status-use-immediately {\n    background: #ffedd5;\n    color: #ea580c;\n    border: 1px solid #fed7aa;\n}\n\n.status-near-expiry {\n    background: #fef9c3;\n    color: #ca8a04;\n    border: 1px solid #fef08a;\n}\n\n.status-healthy {\n    background: #dcfce7;\n    color: #16a34a;\n    border: 1px solid #bbf7d0;\n}\n\n/* Expiry Days Column */\n.expiry-days {\n    font-weight: 600;\n}\n\n.expiry-days.negative {\n    color: #dc2626;\n}\n\n.expiry-days.warning {\n    color: #ea580c;\n}\n\n.expiry-days.caution {\n    color: #ca8a04;\n}\n\n.expiry-days.safe {\n    color: #16a34a;\n}\n\n/* Loading and Empty States */\n.batch-items-loading {\n    text-align: center;\n    padding: 60px 20px;\n}\n\n.batch-items-empty {\n    text-align: center;\n    padding: 60px 20px;\n}\n\n/* Responsive Design */\n@media (max-width: 1200px) {\n    .expiry-stats-row {\n        grid-template-columns: repeat(2, 1fr);\n    }\n}\n\n@media (max-width: 768px) {\n    .batch-expiry-section {\n        padding: 16px;\n    }\n    \n    .expiry-stats-row {\n        grid-template-columns: 1fr;\n    }\n    \n    .batch-items-header {\n        flex-direction: column;\n        align-items: flex-start;\n        gap: 12px;\n    }\n    \n    .batch-filters {\n        width: 100%;\n        flex-direction: column;\n    }\n    \n    .batch-filters select,\n    .batch-filters button {\n        width: 100%;\n    }\n    \n    .batch-items-table-wrapper {\n        overflow-x: auto;\n    }\n    \n    .batch-items-table {\n        min-width: 900px;\n    }\n    \n    .batch-items-table thead th,\n    .batch-items-table tbody td {\n        padding: 10px 12px;\n        font-size: 12px;\n    }\n}\n\n/* ============================================\n   EXPIRED ITEMS ONLY STYLING (Main Dashboard)\n   ============================================ */\n\n/* Header Actions */\n.header-actions {\n    display: flex;\n    gap: 8px;\n    align-items: center;\n}\n\n/* Expired Only Stats */\n.expired-only-stats {\n    margin-bottom: 24px;\n}\n\n.expired-alert-card {\n    background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);\n    border: 1px solid #fca5a5;\n    border-radius: 12px;\n    padding: 20px;\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    box-shadow: 0 2px 4px rgba(220, 38, 38, 0.1);\n}\n\n.alert-icon {\n    font-size: 2.5rem;\n    flex-shrink: 0;\n}\n\n.alert-content {\n    flex: 1;\n}\n\n.alert-value {\n    font-size: 2rem;\n    font-weight: 700;\n    color: #dc2626;\n    margin-bottom: 4px;\n}\n\n.alert-label {\n    font-size: 1.1rem;\n    font-weight: 600;\n    color: #991b1b;\n    margin-bottom: 4px;\n}\n\n.alert-description {\n    font-size: 0.9rem;\n    color: #7f1d1d;\n}\n\n/* Expired Items Container */\n.expired-items-container {\n    margin-top: 20px;\n}\n\n.expired-items-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n    padding-bottom: 12px;\n    border-bottom: 2px solid #f3f4f6;\n}\n\n.expired-items-header h4 {\n    margin: 0;\n    color: #dc2626;\n    font-weight: 600;\n}\n\n.expired-count-badge {\n    background: #dc2626;\n    color: white;\n    padding: 4px 12px;\n    border-radius: 20px;\n    font-size: 0.85rem;\n    font-weight: 600;\n}\n\n/* Override batch table for scrollable expired items */\n.expired-items-container .batch-items-table-wrapper {\n    max-height: 350px;\n    overflow-y: auto;\n    border: 1px solid #e5e7eb;\n    border-radius: 8px;\n    background: white;\n}\n\n.expired-items-container .batch-items-table thead th {\n    position: sticky;\n    top: 0;\n    background: #f9fafb;\n    z-index: 10;\n    border-bottom: 2px solid #e5e7eb;\n    font-weight: 600;\n    color: #374151;\n    padding: 12px 8px;\n}\n\n.expired-items-container .batch-items-table tbody tr:hover {\n    background: #fef2f2;\n}\n\n.expired-items-container .batch-items-table tbody td {\n    padding: 10px 8px;\n    border-bottom: 1px solid #f3f4f6;\n    vertical-align: middle;\n}\n\n/* Expired row styling */\n.expired-items-container .batch-items-table tbody tr {\n    border-left: 3px solid #dc2626;\n}\n\n.expired-items-container .batch-items-table .days-overdue {\n    font-weight: 600;\n    color: #dc2626;\n}"
 },
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div class=\"ucl-container\">\r\n\r\n    <div class=\"ucl-grid\">\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Employee')\">\r\n        <div><div class=\"ucl-icon\">üßë</div><div class=\"ucl-title\">Employee</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Employee Onboarding')\">\r\n        <div><div class=\"ucl-icon\">üíº</div><div class=\"ucl-title\">Recruitment</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Training Program')\">\r\n        <div><div class=\"ucl-icon\">üéì</div><div class=\"ucl-title\">Training Program</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Payroll Entry')\">\r\n        <div><div class=\"ucl-icon\">üßæ</div><div class=\"ucl-title\">Payroll Entry</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Employee Performance Feedback')\">\r\n        <div><div class=\"ucl-icon\">‚úçÔ∏è</div><div class=\"ucl-title\">Employee Performance Feedback</div></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n <div class=\"ucl-title\"> Reports</div>\r\n<div class=\"ucl-container\">\r\n\r\n    <div class=\"ucl-grid\">\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','Monthly Attendance Sheet')\">\r\n        <div><div class=\"ucl-icon\">üóìÔ∏è</div><div class=\"ucl-title\">Monthly Attendance Sheet</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','Employee Leave Balance')\">\r\n        <div><div class=\"ucl-icon\">üì¶</div><div class=\"ucl-title\">Employee Leave Balance</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','Employee Exits')\">\r\n        <div><div class=\"ucl-icon\">ü™™</div><div class=\"ucl-title\"> Employee Exits</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','Appraisal Overview')\">\r\n        <div><div class=\"ucl-icon\">üéØ</div><div class=\"ucl-title\">Appraisal Overview</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('query-report','Salary Register')\">\r\n        <div><div class=\"ucl-icon\">üìã</div><div class=\"ucl-title\">Salary Register</div></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n        ",
  "modified": "2026-01-20 10:34:30.338253",
  "name": "UCL HR Dashboard",
  "private": 0,
  "roles": [],
  "script": "",
  "style": "\r\n.ucl-container {\r\n  padding: 10px;\r\n}\r\n\r\n.ucl-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\r\n  gap: 18px;\r\n}\r\n\r\n.ucl-card {\r\n  aspect-ratio: 1 / 1;\r\n  background:#FFFFFF;\r\n  border-radius: 14px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  text-align: center;\r\n  cursor: pointer;\r\n  transition: all 0.25s ease;\r\n  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.08);\r\n}\r\n\r\n.ucl-card:hover {\r\n  transform: translateY(-6px);\r\n  box-shadow: 0 12px 26px rgba(0, 0, 0, 0.14);\r\n  background: linear-gradient(90deg, #667eea, #764ba2);\r\n}\r\n\r\n.ucl-title {\r\n  font-size: 15px;\r\n  font-weight: 600;\r\n  color:linear-gradient(90deg, #667eea, #764ba2) ;\r\n}\r\n.ucl-title:hover {\r\n  \r\n  color:#FFFFFF ;\r\n}\r\n\r\n.ucl-icon {\r\n  font-size: 28px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.ucl-section-title {\r\n  margin: 20px 0 12px;\r\n  font-size: 18px;\r\n  font-weight: 700;\r\n  color: linear-gradient(90deg, #667eea, #764ba2);\r\n}\r\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom HTML Block",
  "html": "<div class=\"ucl-container\">\r\n\r\n\r\n  <!-- Masters Tab -->\r\n  <div class=\"ucl-tab-content\">\r\n    <div class=\"ucl-grid\">\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Item')\">\r\n        <div><div class=\"ucl-icon\">ñ£ò</div><div class=\"ucl-title\">Item</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Supplier')\">\r\n        <div><div class=\"ucl-icon\">üë•</div><div class=\"ucl-title\">Supplier</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Customer')\">\r\n        <div><div class=\"ucl-icon\">üë§</div><div class=\"ucl-title\">Customer</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Branch')\">\r\n        <div><div class=\"ucl-icon\">üåê</div><div class=\"ucl-title\">Branch</div></div>\r\n      </div>\r\n\r\n      <div class=\"ucl-card\" onclick=\"frappe.set_route('List','Warehouse')\">\r\n        <div><div class=\"ucl-icon\">ñ†ø</div><div class=\"ucl-title\">Warehouse</div></div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n\r\n\r\n</div>\r\n",
  "modified": "2026-01-29 17:22:08.538487",
  "name": "UCL Masters",
  "private": 0,
  "roles": [],
  "script": "",
  "style": "\r\n.ucl-container {\r\n  padding: 10px;\r\n}\r\n\r\n.ucl-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));\r\n  gap: 18px;\r\n}\r\n\r\n.ucl-card {\r\n  aspect-ratio: 1 / 1;\r\n  background:#FFFFFF; /* baby pink */\r\n  border-radius: 14px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  text-align: center;\r\n  cursor: pointer;\r\n  transition: all 0.25s ease;\r\n  box-shadow: 0 6px 14px rgba(0, 0, 0, 0.08);\r\n}\r\n\r\n.ucl-card:hover {\r\n  transform: translateY(-6px);\r\n  box-shadow: 0 12px 26px rgba(0, 0, 0, 0.14);\r\n  background: linear-gradient(90deg, #667eea, #764ba2);\r\n  color: #FFFFFF;\r\n}\r\n\r\n.ucl-title {\r\n  font-size: 15px;\r\n  font-weight: 600;\r\n  color: #831843;\r\n}\r\n.ucl-title:hover {\r\n \r\n  color: #FFFFFF;\r\n}\r\n\r\n.ucl-icon {\r\n  font-size: 28px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.ucl-section-title {\r\n  margin: 20px 0 12px;\r\n  font-size: 18px;\r\n  font-weight: 700;\r\n  color: #FFFFFF;\r\n}\r\n/* Hide radio buttons */\r\ninput[name=\"ucl-tabs\"] {\r\n  display: none;\r\n}\r\n\r\n.ucl-tabs {\r\n  display: flex;\r\n  gap: 12px;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.ucl-tab {\r\n  padding: 10px 18px;\r\n  border-radius: 20px;\r\n  background: #FFFFFF;\r\n  cursor: pointer;\r\n  font-weight: 600;\r\n}\r\n\r\n\r\n#tab-procurement:checked ~ .procurement {\r\n  display: block;\r\n}\r\n\r\n#tab-masters:checked ~ .masters {\r\n  display: block;\r\n}\r\n#tab-crm:checked ~ .crm {\r\n  display: block;\r\n}\r\n"
 }
]