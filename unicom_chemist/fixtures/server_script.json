[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-11-21 18:33:18.068665",
  "module": null,
  "name": "Item Barcode Auto Generate",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Item",
  "script": "# Auto-generate EAN-8 barcode after item is created\nimport random\n\ndef generate_ean8():\n    base = str(random.randint(1000000, 9999999))\n\n    # checksum calculator\n    total = 0\n    for i in range(7):\n        digit = int(base[i])\n        if i % 2 == 0:\n            total += digit * 3\n        else:\n            total += digit\n    checksum = (10 - (total % 10)) % 10\n    return base + str(checksum)\n\nif not doc.barcodes:\n    code = generate_ean8()\n    doc.append(\"barcodes\", {\n        \"barcode\": code,\n        \"barcode_type\": \"EAN-8\"\n    })\n    doc.save()   # important to update after insert\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-11-28 20:22:05.376179",
  "module": "Stock",
  "name": "Auto Generate MR Identification",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Material Request",
  "script": "# Automatically tick custom_auto_generated when Material Request\n# is created by the Reorder Level job\n\nauto_reorder_flag = False\n\n# Method 1: ERPNext internal flag (best method)\nif hasattr(doc.flags, \"from_reorder\") and doc.flags.from_reorder:\n    auto_reorder_flag = True\n\n# Method 2: Reorder fields in child table (fallback for all versions)\nif not auto_reorder_flag:\n    if any([d.warehouse_reorder_level for d in doc.items]):\n        auto_reorder_flag = True\n\n# Set checkbox\nif auto_reorder_flag:\n    doc.custom_auto_generated = 1\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "Hourly",
  "modified": "2026-01-06 16:45:58.944596",
  "module": null,
  "name": "Stock Alert",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": null,
  "script": "# Get Central Warehouse dynamically\r\ncentral_warehouse = \"Centralized Warehouse - UCL\"\r\n\r\n# Get users with Central Warehouse Stock Manager role\r\nrole_users = frappe.get_all(\r\n    \"Has Role\",\r\n    filters={\"role\": \"Central Warehouse Stock Manager\"},\r\n    pluck=\"parent\"\r\n)\r\n\r\n# Keep only enabled users\r\nusers = frappe.get_all(\r\n    \"User\",\r\n    filters={\r\n        \"name\": [\"in\", role_users],\r\n        \"enabled\": 1\r\n    },\r\n    pluck=\"name\"\r\n)\r\n\r\nif  users:\r\n    items = frappe.get_all(\r\n    \"Item\",\r\n    filters={\"is_stock_item\": 1, \"disabled\": 0},\r\n    pluck=\"name\"\r\n)\r\n\r\nfor item_code in items:\r\n    central_qty = frappe.db.sql(\"\"\"\r\n        SELECT IFNULL(SUM(actual_qty), 0)\r\n        FROM `tabBin`\r\n        WHERE item_code=%s AND warehouse=%s\r\n    \"\"\", (item_code, central_warehouse))[0][0]\r\n\r\n    other_qty = frappe.db.sql(\"\"\"\r\n        SELECT IFNULL(SUM(actual_qty), 0)\r\n        FROM `tabBin`\r\n        WHERE item_code=%s AND warehouse != %s\r\n    \"\"\", (item_code, central_warehouse))[0][0]\r\n\r\n    if central_qty > 0 and other_qty <= 0:\r\n        subject = f\"Central Warehouse Stock Alert â€“ {item_code}\"\r\n\r\n        message = f\"\"\"\r\n        Item <b>{item_code}</b> is currently available only in the\r\n        <b>{central_warehouse}</b>.\r\n\r\n        <br><br>\r\n        <b>Central Stock:</b> {central_qty}<br>\r\n        <b>Other Warehouses Stock:</b> 0\r\n\r\n        <br><br>\r\n        Please review redistribution or inter-warehouse transfer.\r\n        \"\"\"\r\n\r\n        # ðŸ”” Notify only Central Warehouse Stock Managers\r\n        for user in users:\r\n            frappe.get_doc({\r\n                \"doctype\": \"Notification Log\",\r\n                \"subject\": subject,\r\n                \"email_content\": message,\r\n                \"for_user\": user,\r\n                \"type\": \"Alert\"\r\n            }).insert(ignore_permissions=True)\r\n",
  "script_type": "Scheduler Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-01-14 11:24:54.767771",
  "module": "Unicom Chemist",
  "name": "Sales Order Naming Series",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Sales Order",
  "script": "branch = doc.branch\r\n\r\n\r\nif not branch:\r\n    frappe.throw(\"Branch is mandatory for Sales Invoice\")\r\n\r\nbranch_abbr = frappe.db.get_value(\r\n    \"Branch\",\r\n    branch,\r\n    \"custom_abbr\"\r\n)\r\n\r\nif not branch_abbr:\r\n    frappe.throw(\r\n        f\"Branch abbreviation (custom_abbr) is missing for Branch: {branch}. \"\r\n        \"Please configure it before creating Sales Invoice.\"\r\n    )\r\n\r\n# Branch-wise Sales Invoice naming series\r\ndoc.naming_series = f\"SO-{branch_abbr}-.YY.-.##\"\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-01-17 14:04:52.363379",
  "module": "Unicom Chemist",
  "name": "Item Barcode",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Item",
  "script": "# Check if the barcodes child table is empty\r\nif not doc.barcodes:\r\n    \r\n    # Add a new row to the 'barcodes' child table \r\n    # using the Item Code as the barcode value\r\n    doc.append(\"barcodes\", {\r\n        \"barcode\": doc.item_code,\r\n        \"uom\": doc.stock_uom\r\n    })\r\n    \r\n    # Optional: Notify the user so they know it happened\r\n    frappe.msgprint(\"Item Code has been added to the Barcode table.\")",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-01-03 13:50:19.573074",
  "module": null,
  "name": "Purchase Receipt Naming Series",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Purchase Receipt",
  "script": "# Created By Garima on 1-1-26\r\n# Naming Series for Purchase Receipt using branch abbreviation\r\n\r\nbranch = doc.branch\r\n\r\nif not branch:\r\n    frappe.throw(\"Branch is mandatory for Purchase Receipt\")\r\n\r\nbranch_abbr = frappe.db.get_value(\r\n    \"Branch\",\r\n    branch,\r\n    \"custom_abbr\"\r\n)\r\n\r\nif not branch_abbr:\r\n    frappe.throw(\r\n        f\"Branch abbreviation (custom_abbr) is missing for Branch: {branch}. \"\r\n        \"Please configure it before creating Purchase Receipt.\"\r\n    )\r\n\r\n# Branch-wise Purchase Receipt naming series\r\ndoc.naming_series = f\"PU-{branch_abbr}-.DD.-.MM.-.YY.-.##\"\r\n\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-01-03 13:37:51.967472",
  "module": null,
  "name": "Purchase Order Naming Series",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Purchase Order",
  "script": "# Created By Garima on 1-1-26\r\n# Naming Series for Purchase Order using branch abbreviation\r\n\r\nbranch = doc.branch\r\n\r\nif not branch:\r\n    frappe.throw(\"Branch is mandatory for Purchase Receipt\")\r\n\r\nbranch_abbr = frappe.db.get_value(\r\n    \"Branch\",\r\n    branch,\r\n    \"custom_abbr\"\r\n)\r\n\r\nif not branch_abbr:\r\n    frappe.throw(\r\n        f\"Branch abbreviation (custom_abbr) is missing for Branch: {branch}. \"\r\n        \"Please configure it before creating Purchase Receipt.\"\r\n    )\r\n\r\n# Branch-wise Purchase Receipt naming series\r\ndoc.naming_series = f\"PO-{branch_abbr}-.DD.-.MM.-.YY.-.##\"\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-01-03 14:03:22.050477",
  "module": null,
  "name": "Quotation Naming Series",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Quotation",
  "script": "branch = doc.custom_branch\r\n\r\n\r\nif not branch:\r\n    frappe.throw(\"Branch is mandatory for Quotation\")\r\n\r\nbranch_abbr = frappe.db.get_value(\r\n    \"Branch\",\r\n    branch,\r\n    \"custom_abbr\"\r\n)\r\n\r\nif not branch_abbr:\r\n    frappe.throw(\r\n        f\"Branch abbreviation (custom_abbr) is missing for Branch: {branch}. \"\r\n        \"Please configure it before creating Sales Invoice.\"\r\n    )\r\n\r\n# Branch-wise Sales Invoice naming series\r\ndoc.naming_series = f\"QU-{branch_abbr}-.DD.-.MM.-.YY.-.##\"\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-01-03 10:20:12.098114",
  "module": "Unicom Chemist",
  "name": "POS Naming series",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "POS Invoice",
  "script": "branch = doc.branch\r\n\r\n# If branch is coming from POS Profile\r\nif not branch and doc.pos_profile:\r\n    branch = frappe.db.get_value(\r\n        \"POS Profile\",\r\n        doc.pos_profile,\r\n        \"branch\"\r\n    )\r\n\r\nif not branch:\r\n    frappe.throw(\"Branch is mandatory for POS Invoice\")\r\n\r\nbranch_abbr = frappe.db.get_value(\r\n    \"Branch\",\r\n    branch,\r\n    \"custom_abbr\"\r\n)\r\n\r\nif not branch_abbr:\r\n    frappe.throw(\r\n        f\"Branch abbreviation (custom_abbr) is missing for Branch: {branch}. \"\r\n        \"Please configure it before creating POS Invoice.\"\r\n    )\r\n\r\ndoc.naming_series = f\"POS-{branch_abbr}-.YY.-.##\"\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-01-03 10:20:12.107780",
  "module": "Unicom Chemist",
  "name": "Material Request Branch wise",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Material Request",
  "script": "branches = set()\r\n\r\n# Collect branch from each item row\r\nfor item in doc.items:\r\n    if item.branch:\r\n        branches.add(item.branch)\r\n\r\nif not branches:\r\n    frappe.throw(\r\n        \"Branch is mandatory in Material Request Items \"\r\n        \"(Accounting Dimension).\"\r\n    )\r\n\r\n# âŒ Do not allow multiple branches\r\nif len(branches) > 1:\r\n    frappe.throw(\r\n        \"All items in a Material Request must belong to the same Branch.\"\r\n    )\r\n\r\nbranch = branches.pop()\r\n\r\n# Get branch abbreviation\r\nbranch_abbr = frappe.db.get_value(\r\n    \"Branch\",\r\n    branch,\r\n    \"custom_abbr\"\r\n)\r\n\r\nif not branch_abbr:\r\n    frappe.throw(\r\n        f\"Branch abbreviation (custom_abbr) is missing for Branch: {branch}\"\r\n    )\r\n\r\n# Set naming series\r\ndoc.naming_series = f\"MR-{branch_abbr}-.YY.-.##\"\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-01-03 10:20:12.128615",
  "module": "Unicom Chemist",
  "name": "Item naming series",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Item",
  "script": "# Server Script for Item Auto-Naming\n# Event: Before Insert\n\nif doc.is_new():\n    if not doc.item_group:\n        frappe.throw('Item Group is required')\n    \n    item_group_name = frappe.db.get_value('Item Group', doc.item_group, 'item_group_name')\n    \n    if not item_group_name:\n        frappe.throw('Item Group not found')\n    \n    parts = item_group_name.split('-')\n    \n    if len(parts) >= 2:\n        part1 = parts[0].strip()[:3].upper()\n        part2 = parts[1].strip()[:3].upper()\n        prefix = f'{part1}-{part2}'\n    else:\n        prefix = item_group_name[:6].upper().replace(' ', '').replace('-', '')\n    \n    series_pattern = f'{prefix}-.####'\n    \n    doc.naming_series =series_pattern",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-01-03 10:20:12.118232",
  "module": "Unicom Chemist",
  "name": "Sales Invoice Naming Series",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Sales Invoice",
  "script": "branch = doc.branch\r\n\r\n\r\nif not branch:\r\n    frappe.throw(\"Branch is mandatory for Sales Invoice\")\r\n\r\nbranch_abbr = frappe.db.get_value(\r\n    \"Branch\",\r\n    branch,\r\n    \"custom_abbr\"\r\n)\r\n\r\nif not branch_abbr:\r\n    frappe.throw(\r\n        f\"Branch abbreviation (custom_abbr) is missing for Branch: {branch}. \"\r\n        \"Please configure it before creating Sales Invoice.\"\r\n    )\r\n\r\n# Branch-wise Sales Invoice naming series\r\ndoc.naming_series = f\"SI-{branch_abbr}-.YY.-.##\"\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-01-03 10:20:12.086775",
  "module": "Unicom Chemist",
  "name": "Purchase Invoice Naming Script",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Purchase Invoice",
  "script": "#Created By Garima on 1-1-26 \r\n#Naming Series for Purchase Invoice using branch abbreviation\r\n\r\nbranch = doc.branch\r\n\r\nif not branch:\r\n    frappe.throw(\"Branch is mandatory for Purchase Invoice\")\r\n\r\nbranch_abbr = frappe.db.get_value(\r\n    \"Branch\",\r\n    branch,\r\n    \"custom_abbr\"\r\n)\r\n\r\nif not branch_abbr:\r\n    frappe.throw(\r\n        f\"Branch abbreviation (custom_abbr) is missing for Branch: {branch}. \"\r\n        \"Please configure it before creating Purchase Invoice.\"\r\n    )\r\n\r\n# Branch-wise Purchase Invoice naming series\r\ndoc.naming_series = f\"PINV-{branch_abbr}-.YY.-.##\"\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2026-01-03 10:20:12.068245",
  "module": "Unicom Chemist",
  "name": "Material Transfer Naming Script",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Stock Entry",
  "script": "# Run only for Material Transfer\r\nif doc.stock_entry_type == \"Material Transfer\":\r\n\r\n    branches = set()\r\n\r\n    # Collect branch from item rows\r\n    for item in doc.items:\r\n        if item.branch:\r\n            branches.add(item.branch)\r\n\r\n    if not branches:\r\n        frappe.throw(\r\n            \"Branch is mandatory in Material Transfer Items \"\r\n            \"(Accounting Dimension).\"\r\n        )\r\n\r\n    # Do not allow multiple branches\r\n    if len(branches) > 1:\r\n        frappe.throw(\r\n            \"All items in a Material Transfer must belong to the same Branch.\"\r\n        )\r\n\r\n    branch = branches.pop()\r\n\r\n    # Optional but recommended\r\n    doc.branch = branch\r\n\r\n    # Get branch abbreviation\r\n    branch_abbr = frappe.db.get_value(\r\n        \"Branch\",\r\n        branch,\r\n        \"custom_abbr\"\r\n    )\r\n\r\n    if not branch_abbr:\r\n        frappe.throw(\r\n            f\"Branch abbreviation (custom_abbr) is missing for Branch: {branch}\"\r\n        )\r\n\r\n    # Branch-wise Material Transfer naming series\r\n    doc.naming_series = f\"MT-{branch_abbr}-.YY.-.##\"\r\n",
  "script_type": "DocType Event"
 }
]